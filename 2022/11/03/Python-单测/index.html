<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  <meta name="baidu-site-verification" content="code-w6zMFQOLpu" />
  <meta name="referrer" content="strict-origin-when-cross-origin">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=yes,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Python-单测 | 予乐</title>
  <meta name="description" content="单测系列-Python总结在Python中如何做单测，本文介绍了Python常用的单测框架和工具">
<meta property="og:type" content="article">
<meta property="og:title" content="Python-单测">
<meta property="og:url" content="http://vwin.github.io/2022/11/03/Python-%E5%8D%95%E6%B5%8B/index.html">
<meta property="og:site_name" content="V&#39;s BLOG">
<meta property="og:description" content="单测系列-Python总结在Python中如何做单测，本文介绍了Python常用的单测框架和工具">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img.png">
<meta property="og:image" content="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img_1.png">
<meta property="og:image" content="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img_2.png">
<meta property="og:image" content="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img_3.png">
<meta property="og:image" content="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img_4.png">
<meta property="og:image" content="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img_5.png">
<meta property="article:published_time" content="2022-11-03T11:48:27.000Z">
<meta property="article:modified_time" content="2022-11-20T05:25:55.643Z">
<meta property="article:author" content="V">
<meta property="article:tag" content="单测">
<meta property="article:tag" content="python">
<meta property="article:tag" content="pytest">
<meta property="article:tag" content="unittest">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://vwin.github.io/2022/11/03/Python-%E5%8D%95%E6%B5%8B/index.html">
  
    <link rel="alternate" href="/atom.xml" title="V&#39;s BLOG" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
    <link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet">
  
  
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8082412711ea4c547c7fdf0e87eb19fb";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>  
<meta name="generator" content="Hexo 6.0.0"></head>


<body class="main-center theme-purple" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/vwin" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">will</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Software Development Engineer in Test &amp; Devops Engineer</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Beijing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-bookmark">
          <a href="/bookmark">
            
            <i class="icon icon-book"></i>
            
            <span class="menu-title">书签</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/vwin" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://yuleweici.com/yuleweici/" target="_blank" title="Link" data-toggle=tooltip data-placement=top><i class="icon icon-link"></i></a></li>
        
        <li><a href="mailto:crazyboyspecial@qq.com" target="_blank" title="Email" data-toggle=tooltip data-placement=top><i class="icon icon-email"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验.<br><a style='color:red' target="_blank" href="https://yuleweici.com/yuleweici-vuepress/">博客-Vuepress</a><br><a style='color:green' target="_blank" href="http://yuleweici.com/yuleweici-docsify/#/">博客-Docsify</a> </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E4%BD%9C/">工作</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a><span class="category-list-count">60</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AI%E8%AF%84%E6%B5%8B/" rel="tag">AI评测</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CI/" rel="tag">CI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Conan/" rel="tag">Conan</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Derrick/" rel="tag">Derrick</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Devops/" rel="tag">Devops</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/" rel="tag">Go</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Grafana/" rel="tag">Grafana</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IaaS/" rel="tag">IaaS</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Iaas/" rel="tag">Iaas</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Prometheus/" rel="tag">Prometheus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/QPS/" rel="tag">QPS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TPS/" rel="tag">TPS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI%E8%87%AA%E5%8A%A8%E5%8C%96/" rel="tag">UI自动化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aio/" rel="tag">aio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/airtest/" rel="tag">airtest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bio/" rel="tag">bio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bootstrap/" rel="tag">bootstrap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/broker/" rel="tag">broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/buffer/" rel="tag">buffer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/" rel="tag">c++</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cached/" rel="tag">cached</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/celery/" rel="tag">celery</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmake/" rel="tag">cmake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cnpm/" rel="tag">cnpm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/consumer/" rel="tag">consumer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/date/" rel="tag">date</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/datetime/" rel="tag">datetime</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/describe/" rel="tag">describe</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dict/" rel="tag">dict</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/element-ui/" rel="tag">element ui</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/" rel="tag">flask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fn/" rel="tag">fn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fp/" rel="tag">fp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/free/" rel="tag">free</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/geojson/" rel="tag">geojson</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github-pages/" rel="tag">github pages</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gunicorn/" rel="tag">gunicorn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/" rel="tag">hadoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/" rel="tag">ios</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdk/" rel="tag">jdk</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jmeter/" rel="tag">jmeter</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jre/" rel="tag">jre</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/json/" rel="tag">json</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jupyter-notebook/" rel="tag">jupyter notebook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k6/" rel="tag">k6</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/" rel="tag">kafka</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka-topic-sh/" rel="tag">kafka-topic.sh</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda/" rel="tag">lambda</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/laravel/" rel="tag">laravel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/list/" rel="tag">list</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/locust/" rel="tag">locust</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/makefile/" rel="tag">makefile</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/metaclass/" rel="tag">metaclass</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mfs/" rel="tag">mfs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/next/" rel="tag">next</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nio/" rel="tag">nio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nmake/" rel="tag">nmake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/paramiko/" rel="tag">paramiko</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/partition/" rel="tag">partition</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pdf/" rel="tag">pdf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/perf/" rel="tag">perf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php5-fpm/" rel="tag">php5-fpm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php7-fpm/" rel="tag">php7-fpm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pip/" rel="tag">pip</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pytest/" rel="tag">pytest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pythonic/" rel="tag">pythonic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qgis/" rel="tag">qgis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/re/" rel="tag">re</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/replica/" rel="tag">replica</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/roc/" rel="tag">roc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/samba/" rel="tag">samba</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scp/" rel="tag">scp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/seaweedfs/" rel="tag">seaweedfs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sorted/" rel="tag">sorted</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/" rel="tag">spark</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sudo/" rel="tag">sudo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/supervisor/" rel="tag">supervisor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/systemtap/" rel="tag">systemtap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/time/" rel="tag">time</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/timeout/" rel="tag">timeout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tmux/" rel="tag">tmux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tn/" rel="tag">tn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tp/" rel="tag">tp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unittest/" rel="tag">unittest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/websocket/" rel="tag">websocket</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zip/" rel="tag">zip</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91/" rel="tag">云</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BF%9D%E9%99%A9/" rel="tag">保险</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A8%E9%93%BE%E8%B7%AF/" rel="tag">全链路</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BD%E6%95%B0/" rel="tag">函数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E6%94%AF%E7%AD%96%E7%95%A5/" rel="tag">分支策略</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="tag">单例模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E6%B5%8B/" rel="tag">单测</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%8B%E6%B5%8B/" rel="tag">压测</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E5%8F%B0/" rel="tag">后台</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E5%8F%B0%E5%85%B3%E7%B3%BB/" rel="tag">后台关系</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/" rel="tag">域名解析</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%B4%E6%96%87%E4%BB%B6/" rel="tag">头文件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%98%E5%82%A8/" rel="tag">存储</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" rel="tag">性能分析</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag">性能测试</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" rel="tag">持续集成</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">排序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%92%E4%BB%B6/" rel="tag">插件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%99%E7%A8%8B/" rel="tag">教程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/" rel="tag">斐波那契数列</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E6%9C%9F/" rel="tag">日期</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%B6%E9%97%B4/" rel="tag">时间</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%81%AB%E7%84%B0%E5%9B%BE/" rel="tag">火焰图</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%B5%E5%BD%B1/" rel="tag">电影</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/" rel="tag">百度网盘</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%91%E6%8E%A7/" rel="tag">监控</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%A9%E9%98%B5/" rel="tag">矩阵</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83/" rel="tag">网络环境</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" rel="tag">自动驾驶</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A1%8C%E6%94%BF%E5%8C%BA/" rel="tag">行政区</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%8D%E4%BA%91/" rel="tag">词云</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%AD%E6%B3%95%E7%B3%96/" rel="tag">语法糖</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B1%86%E7%93%A3/" rel="tag">豆瓣</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" rel="tag">责任链模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%92%E5%BD%92/" rel="tag">递归</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%81%93%E6%A0%BC%E6%8B%89%E6%96%AF/" rel="tag">道格拉斯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%97%AD%E5%8C%85/" rel="tag">闭包</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/AI%E8%AF%84%E6%B5%8B/" style="font-size: 13px;">AI评测</a> <a href="/tags/C/" style="font-size: 13.29px;">C++</a> <a href="/tags/CI/" style="font-size: 13px;">CI</a> <a href="/tags/Conan/" style="font-size: 13px;">Conan</a> <a href="/tags/Derrick/" style="font-size: 13px;">Derrick</a> <a href="/tags/Devops/" style="font-size: 13px;">Devops</a> <a href="/tags/Go/" style="font-size: 13px;">Go</a> <a href="/tags/Grafana/" style="font-size: 13px;">Grafana</a> <a href="/tags/HTML/" style="font-size: 13px;">HTML</a> <a href="/tags/IaaS/" style="font-size: 13.29px;">IaaS</a> <a href="/tags/Iaas/" style="font-size: 13.14px;">Iaas</a> <a href="/tags/Jenkins/" style="font-size: 13.14px;">Jenkins</a> <a href="/tags/Prometheus/" style="font-size: 13px;">Prometheus</a> <a href="/tags/Python/" style="font-size: 13.14px;">Python</a> <a href="/tags/QPS/" style="font-size: 13px;">QPS</a> <a href="/tags/TPS/" style="font-size: 13px;">TPS</a> <a href="/tags/UI%E8%87%AA%E5%8A%A8%E5%8C%96/" style="font-size: 13px;">UI自动化</a> <a href="/tags/Ubuntu/" style="font-size: 13px;">Ubuntu</a> <a href="/tags/aio/" style="font-size: 13px;">aio</a> <a href="/tags/airtest/" style="font-size: 13px;">airtest</a> <a href="/tags/bio/" style="font-size: 13px;">bio</a> <a href="/tags/bootstrap/" style="font-size: 13px;">bootstrap</a> <a href="/tags/broker/" style="font-size: 13px;">broker</a> <a href="/tags/buffer/" style="font-size: 13px;">buffer</a> <a href="/tags/c/" style="font-size: 13.14px;">c++</a> <a href="/tags/cached/" style="font-size: 13px;">cached</a> <a href="/tags/celery/" style="font-size: 13px;">celery</a> <a href="/tags/cmake/" style="font-size: 13px;">cmake</a> <a href="/tags/cnpm/" style="font-size: 13px;">cnpm</a> <a href="/tags/consumer/" style="font-size: 13px;">consumer</a> <a href="/tags/date/" style="font-size: 13px;">date</a> <a href="/tags/datetime/" style="font-size: 13px;">datetime</a> <a href="/tags/describe/" style="font-size: 13px;">describe</a> <a href="/tags/dict/" style="font-size: 13px;">dict</a> <a href="/tags/docker/" style="font-size: 13px;">docker</a> <a href="/tags/element-ui/" style="font-size: 13px;">element ui</a> <a href="/tags/flask/" style="font-size: 13px;">flask</a> <a href="/tags/fn/" style="font-size: 13px;">fn</a> <a href="/tags/fp/" style="font-size: 13px;">fp</a> <a href="/tags/free/" style="font-size: 13px;">free</a> <a href="/tags/geojson/" style="font-size: 13px;">geojson</a> <a href="/tags/git/" style="font-size: 13px;">git</a> <a href="/tags/github/" style="font-size: 13px;">github</a> <a href="/tags/github-pages/" style="font-size: 13px;">github pages</a> <a href="/tags/go/" style="font-size: 13px;">go</a> <a href="/tags/gunicorn/" style="font-size: 13px;">gunicorn</a> <a href="/tags/hadoop/" style="font-size: 13px;">hadoop</a> <a href="/tags/hexo/" style="font-size: 13.29px;">hexo</a> <a href="/tags/http/" style="font-size: 13px;">http</a> <a href="/tags/ios/" style="font-size: 13px;">ios</a> <a href="/tags/jdk/" style="font-size: 13px;">jdk</a> <a href="/tags/jmeter/" style="font-size: 13.29px;">jmeter</a> <a href="/tags/jre/" style="font-size: 13px;">jre</a> <a href="/tags/json/" style="font-size: 13px;">json</a> <a href="/tags/jupyter-notebook/" style="font-size: 13px;">jupyter notebook</a> <a href="/tags/k6/" style="font-size: 13px;">k6</a> <a href="/tags/kafka/" style="font-size: 13.14px;">kafka</a> <a href="/tags/kafka-topic-sh/" style="font-size: 13px;">kafka-topic.sh</a> <a href="/tags/lambda/" style="font-size: 13.14px;">lambda</a> <a href="/tags/laravel/" style="font-size: 13px;">laravel</a> <a href="/tags/linux/" style="font-size: 13.86px;">linux</a> <a href="/tags/list/" style="font-size: 13px;">list</a> <a href="/tags/locust/" style="font-size: 13.14px;">locust</a> <a href="/tags/makefile/" style="font-size: 13px;">makefile</a> <a href="/tags/metaclass/" style="font-size: 13px;">metaclass</a> <a href="/tags/mfs/" style="font-size: 13px;">mfs</a> <a href="/tags/mysql/" style="font-size: 13px;">mysql</a> <a href="/tags/next/" style="font-size: 13.14px;">next</a> <a href="/tags/nio/" style="font-size: 13px;">nio</a> <a href="/tags/nmake/" style="font-size: 13px;">nmake</a> <a href="/tags/npm/" style="font-size: 13px;">npm</a> <a href="/tags/paramiko/" style="font-size: 13px;">paramiko</a> <a href="/tags/partition/" style="font-size: 13.14px;">partition</a> <a href="/tags/pdf/" style="font-size: 13px;">pdf</a> <a href="/tags/perf/" style="font-size: 13px;">perf</a> <a href="/tags/php/" style="font-size: 13px;">php</a> <a href="/tags/php5-fpm/" style="font-size: 13px;">php5-fpm</a> <a href="/tags/php7-fpm/" style="font-size: 13px;">php7-fpm</a> <a href="/tags/pip/" style="font-size: 13px;">pip</a> <a href="/tags/pytest/" style="font-size: 13px;">pytest</a> <a href="/tags/python/" style="font-size: 14px;">python</a> <a href="/tags/pythonic/" style="font-size: 13px;">pythonic</a> <a href="/tags/qgis/" style="font-size: 13px;">qgis</a> <a href="/tags/re/" style="font-size: 13px;">re</a> <a href="/tags/replica/" style="font-size: 13.14px;">replica</a> <a href="/tags/roc/" style="font-size: 13px;">roc</a> <a href="/tags/samba/" style="font-size: 13px;">samba</a> <a href="/tags/scp/" style="font-size: 13px;">scp</a> <a href="/tags/seaweedfs/" style="font-size: 13px;">seaweedfs</a> <a href="/tags/sorted/" style="font-size: 13px;">sorted</a> <a href="/tags/spark/" style="font-size: 13.57px;">spark</a> <a href="/tags/ssh/" style="font-size: 13.14px;">ssh</a> <a href="/tags/sudo/" style="font-size: 13px;">sudo</a> <a href="/tags/supervisor/" style="font-size: 13px;">supervisor</a> <a href="/tags/systemtap/" style="font-size: 13px;">systemtap</a> <a href="/tags/time/" style="font-size: 13px;">time</a> <a href="/tags/timeout/" style="font-size: 13px;">timeout</a> <a href="/tags/tmux/" style="font-size: 13px;">tmux</a> <a href="/tags/tn/" style="font-size: 13px;">tn</a> <a href="/tags/tp/" style="font-size: 13px;">tp</a> <a href="/tags/ubuntu/" style="font-size: 13.29px;">ubuntu</a> <a href="/tags/unittest/" style="font-size: 13px;">unittest</a> <a href="/tags/vue/" style="font-size: 13px;">vue</a> <a href="/tags/websocket/" style="font-size: 13px;">websocket</a> <a href="/tags/zip/" style="font-size: 13px;">zip</a> <a href="/tags/%E4%BA%91/" style="font-size: 13px;">云</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 13px;">人工智能</a> <a href="/tags/%E4%BF%9D%E9%99%A9/" style="font-size: 13px;">保险</a> <a href="/tags/%E5%85%A8%E9%93%BE%E8%B7%AF/" style="font-size: 13px;">全链路</a> <a href="/tags/%E5%87%BD%E6%95%B0/" style="font-size: 13px;">函数</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 13.29px;">分布式</a> <a href="/tags/%E5%88%86%E6%94%AF%E7%AD%96%E7%95%A5/" style="font-size: 13px;">分支策略</a> <a href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" style="font-size: 13px;">单例模式</a> <a href="/tags/%E5%8D%95%E6%B5%8B/" style="font-size: 13.29px;">单测</a> <a href="/tags/%E5%8E%8B%E6%B5%8B/" style="font-size: 13.14px;">压测</a> <a href="/tags/%E5%90%8E%E5%8F%B0/" style="font-size: 13px;">后台</a> <a href="/tags/%E5%90%8E%E5%8F%B0%E5%85%B3%E7%B3%BB/" style="font-size: 13px;">后台关系</a> <a href="/tags/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/" style="font-size: 13px;">域名解析</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 13.71px;">大数据</a> <a href="/tags/%E5%A4%B4%E6%96%87%E4%BB%B6/" style="font-size: 13px;">头文件</a> <a href="/tags/%E5%AD%98%E5%82%A8/" style="font-size: 13px;">存储</a> <a href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" style="font-size: 13px;">性能分析</a> <a href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" style="font-size: 13.86px;">性能测试</a> <a href="/tags/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" style="font-size: 13.14px;">持续集成</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 13px;">排序</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 13px;">插件</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 13px;">教程</a> <a href="/tags/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/" style="font-size: 13px;">斐波那契数列</a> <a href="/tags/%E6%97%A5%E6%9C%9F/" style="font-size: 13px;">日期</a> <a href="/tags/%E6%97%B6%E9%97%B4/" style="font-size: 13px;">时间</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 13.43px;">测试</a> <a href="/tags/%E7%81%AB%E7%84%B0%E5%9B%BE/" style="font-size: 13px;">火焰图</a> <a href="/tags/%E7%94%B5%E5%BD%B1/" style="font-size: 13px;">电影</a> <a href="/tags/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/" style="font-size: 13px;">百度网盘</a> <a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 13px;">监控</a> <a href="/tags/%E7%9F%A9%E9%98%B5/" style="font-size: 13px;">矩阵</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13px;">算法</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83/" style="font-size: 13px;">网络环境</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" style="font-size: 13.29px;">自动驾驶</a> <a href="/tags/%E8%A1%8C%E6%94%BF%E5%8C%BA/" style="font-size: 13px;">行政区</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 13.14px;">设计模式</a> <a href="/tags/%E8%AF%8D%E4%BA%91/" style="font-size: 13px;">词云</a> <a href="/tags/%E8%AF%AD%E6%B3%95%E7%B3%96/" style="font-size: 13px;">语法糖</a> <a href="/tags/%E8%B1%86%E7%93%A3/" style="font-size: 13px;">豆瓣</a> <a href="/tags/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" style="font-size: 13px;">责任链模式</a> <a href="/tags/%E9%80%92%E5%BD%92/" style="font-size: 13px;">递归</a> <a href="/tags/%E9%81%93%E6%A0%BC%E6%8B%89%E6%96%AF/" style="font-size: 13px;">道格拉斯</a> <a href="/tags/%E9%97%AD%E5%8C%85/" style="font-size: 13px;">闭包</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">22</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/11/19/ToB%E4%B8%9A%E5%8A%A1%E7%90%86%E8%A7%A3/" class="title">ToB业务理解</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-19T06:16:47.000Z" itemprop="datePublished">2022-11-19</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/15/%E5%8E%8B%E6%B5%8B-%E5%9F%BA%E4%BA%8EK6%E7%9A%84web%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%92%8C%E5%AE%9E%E6%97%B6%E7%9B%91%E6%8E%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="title">压测-基于K6的web性能测试和实时监控解决方案</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-15T08:38:42.000Z" itemprop="datePublished">2022-11-15</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/14/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6-GeoJson%E5%AD%A6%E4%B9%A0/" class="title">自动驾驶-GeoJson学习</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-14T08:50:42.000Z" itemprop="datePublished">2022-11-14</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/14/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6-QGIS%E4%BD%BF%E7%94%A8/" class="title">自动驾驶-QGIS使用</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-14T08:49:11.000Z" itemprop="datePublished">2022-11-14</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/14/%E5%90%8E%E5%8F%B0%E6%B5%8B%E8%AF%95%E5%85%A5%E9%97%A8-%E5%A6%82%E4%BD%95%E5%81%9A%E5%90%8E%E5%8F%B0%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" class="title">后台测试入门-如何做后台性能测试</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-14T05:31:58.000Z" itemprop="datePublished">2022-11-14</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
  <aside class="sidebar sidebar-toc collapse   in  " id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8Python%E5%8D%95%E6%B5%8B%E6%A1%86%E6%9E%B6"><span class="toc-number">1.</span> <span class="toc-text">常用Python单测框架</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#unittest"><span class="toc-number">2.</span> <span class="toc-text">unittest</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">2.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E8%A7%84%E5%88%99"><span class="toc-number">2.2.</span> <span class="toc-text">编写规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.3.</span> <span class="toc-text">简单示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">2.3.1.</span> <span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%99%A8%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">2.3.2.</span> <span class="toc-text">计算器实现代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%99%A8%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="toc-number">2.3.3.</span> <span class="toc-text">计算器测试代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="toc-number">2.3.4.</span> <span class="toc-text">执行结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E4%BE%8B%E5%89%8D%E7%BD%AE%E5%92%8C%E5%90%8E%E7%BD%AE"><span class="toc-number">2.4.</span> <span class="toc-text">用例前置和后置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96"><span class="toc-number">2.5.</span> <span class="toc-text">参数化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#parameterized"><span class="toc-number">2.5.1.</span> <span class="toc-text">parameterized</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ddt"><span class="toc-number">2.5.2.</span> <span class="toc-text">ddt</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%AD%E8%A8%80"><span class="toc-number">2.6.</span> <span class="toc-text">断言</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nose"><span class="toc-number">3.</span> <span class="toc-text">nose</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E8%A7%84%E5%88%99-1"><span class="toc-number">3.1.</span> <span class="toc-text">编写规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">3.2.</span> <span class="toc-text">简单示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%99%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">3.2.1.</span> <span class="toc-text">计算器代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%99%A8%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81-1"><span class="toc-number">3.2.2.</span> <span class="toc-text">计算器测试代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96-1"><span class="toc-number">3.3.</span> <span class="toc-text">参数化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest"><span class="toc-number">4.</span> <span class="toc-text">pytest</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E8%A7%84%E5%88%99-2"><span class="toc-number">4.1.</span> <span class="toc-text">编写规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B-2"><span class="toc-number">4.2.</span> <span class="toc-text">简单示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%99%A8%E4%BB%A3%E7%A0%81-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">计算器代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%99%A8%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">计算器实现代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E4%BE%8B%E5%89%8D%E7%BD%AE%E5%92%8C%E5%90%8E%E7%BD%AE-1"><span class="toc-number">4.3.</span> <span class="toc-text">用例前置和后置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96-2"><span class="toc-number">4.4.</span> <span class="toc-text">参数化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">4.4.1.</span> <span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-number">4.4.2.</span> <span class="toc-text">参数化测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96%E6%A0%87%E8%AE%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">4.4.3.</span> <span class="toc-text">参数化标记数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%AD%E8%A8%80-1"><span class="toc-number">4.5.</span> <span class="toc-text">断言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E8%B7%91"><span class="toc-number">4.6.</span> <span class="toc-text">重跑</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mock"><span class="toc-number">5.</span> <span class="toc-text">Mock</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mock"><span class="toc-number">5.1.</span> <span class="toc-text">mock</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mock%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95"><span class="toc-number">5.1.1.</span> <span class="toc-text">Mock一个方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mock%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E9%87%8C%E9%9D%A2%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">5.1.2.</span> <span class="toc-text">Mock一个对象里面的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mock%E6%AF%8F%E6%AC%A1%E8%B0%83%E7%94%A8%E8%BF%94%E5%9B%9E%E4%B8%8D%E5%90%8C%E7%9A%84%E5%80%BC"><span class="toc-number">5.1.3.</span> <span class="toc-text">Mock每次调用返回不同的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mock%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">5.1.4.</span> <span class="toc-text">Mock抛出异常的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mock%E5%A4%9A%E4%B8%AA%E6%96%B9%E6%B3%95"><span class="toc-number">5.1.5.</span> <span class="toc-text">Mock多个方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pytest-mock"><span class="toc-number">5.2.</span> <span class="toc-text">pytest-mock</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B-3"><span class="toc-number">5.2.1.</span> <span class="toc-text">简单示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mock%E6%96%B9%E6%B3%95%E5%92%8C%E5%9F%9F"><span class="toc-number">5.2.2.</span> <span class="toc-text">mock方法和域</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#monkeypatch"><span class="toc-number">5.3.</span> <span class="toc-text">monkeypatch</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87%E6%8A%A5%E5%91%8A"><span class="toc-number">6.</span> <span class="toc-text">单元测试覆盖率报告</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#coverage"><span class="toc-number">6.1.</span> <span class="toc-text">coverage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">6.1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C"><span class="toc-number">6.1.2.</span> <span class="toc-text">运行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C"><span class="toc-number">6.1.3.</span> <span class="toc-text">结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#report"><span class="toc-number">6.1.3.1.</span> <span class="toc-text">report</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#html"><span class="toc-number">6.1.3.2.</span> <span class="toc-text">html</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#html-testRunner"><span class="toc-number">6.2.</span> <span class="toc-text">html-testRunner</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">6.2.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-1"><span class="toc-number">6.2.2.</span> <span class="toc-text">运行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C-1"><span class="toc-number">6.2.3.</span> <span class="toc-text">结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pytest-cov"><span class="toc-number">6.3.</span> <span class="toc-text">pytest-cov</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-2"><span class="toc-number">6.3.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-2"><span class="toc-number">6.3.2.</span> <span class="toc-text">运行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C-2"><span class="toc-number">6.3.3.</span> <span class="toc-text">结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E8%83%BD%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">6.4.</span> <span class="toc-text">可能的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E5%91%8A%E6%B2%A1%E7%94%9F%E6%88%90"><span class="toc-number">6.4.1.</span> <span class="toc-text">报告没生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8Pycharm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%A6%86%E7%9B%96%E7%8E%87%E5%B1%95%E7%A4%BA"><span class="toc-number">6.4.2.</span> <span class="toc-text">在Pycharm中配置覆盖率展示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%83%85%E6%99%AF%E7%A4%BA%E4%BE%8B"><span class="toc-number">7.</span> <span class="toc-text">情景示例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%A7%88"><span class="toc-number">7.1.</span> <span class="toc-text">概览</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="toc-number">7.1.1.</span> <span class="toc-text">项目介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">7.1.2.</span> <span class="toc-text">项目结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF"><span class="toc-number">7.1.3.</span> <span class="toc-text">关键技术</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Service%E6%B5%8B%E8%AF%95"><span class="toc-number">7.2.</span> <span class="toc-text">Service测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E7%AB%A0"><span class="toc-number">7.2.1.</span> <span class="toc-text">创建文章</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="toc-number">7.2.2.</span> <span class="toc-text">获取文章列表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-number">7.3.</span> <span class="toc-text">其他功能测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">8.</span> <span class="toc-text">结语</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">8.1.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E9%98%85%E8%AF%BB"><span class="toc-number">8.2.</span> <span class="toc-text">相关阅读</span></a></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Python-单测" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Python-单测
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2022/11/03/Python-%E5%8D%95%E6%B5%8B/" class="article-date">
	  <time datetime="2022-11-03T11:48:27.000Z" itemprop="datePublished">2022-11-03</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/pytest/" rel="tag">pytest</a>, <a class="article-tag-link-link" href="/tags/python/" rel="tag">python</a>, <a class="article-tag-link-link" href="/tags/unittest/" rel="tag">unittest</a>, <a class="article-tag-link-link" href="/tags/%E5%8D%95%E6%B5%8B/" rel="tag">单测</a>
  </span>


        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2022/11/03/Python-%E5%8D%95%E6%B5%8B/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 6.1k(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 30(分)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>单测系列-Python<br>总结在Python中如何做单测，本文介绍了Python常用的单测框架和工具</p>
<span id="more"></span>

<h1 id="常用Python单测框架"><a href="#常用Python单测框架" class="headerlink" title="常用Python单测框架"></a>常用Python单测框架</h1><table>
<thead>
<tr>
<th></th>
<th>Unittest</th>
<th>Nose</th>
<th>Pytest</th>
</tr>
</thead>
<tbody><tr>
<td>特点</td>
<td>Python标准库中自带的单元测试框架。</td>
<td>Python的一个第三方单元测试框架，带插件的unittest。nose停止维护了，nose2并不支持nose的全部功能。</td>
<td>Python的一个第三方单元测试框架，丰富的插件生态，兼容unittest和nose测试集， 社区繁荣</td>
</tr>
<tr>
<td>Mock框架</td>
<td>unittest.mock</td>
<td>unittest.mock</td>
<td>pytest-mock</td>
</tr>
<tr>
<td>推荐指数</td>
<td>★★★★☆</td>
<td>★★☆☆☆</td>
<td>★★★★★</td>
</tr>
</tbody></table>
<p>若你不想安装或不允许第三方库，那么 unittest 是最好也是唯一的选择。反之，pytest 无疑是最佳选择，众多 Python 开源项目（如大名鼎鼎的 requests）都是使用 pytest 作为单元测试框架。甚至，连 nose2 在官方文档上都建议大家使用 pytest。我们知道，nose已经进入了维护模式，取代者是nose2。相比nose2，pytest的生态无疑更具优势，社区的活跃度也更高。</p>
<p>总体来说，unittest用例格式复杂，兼容性无，插件少，二次开发方便。pytest更加方便快捷，用例格式简单，可以执行unittest风格的测试用例，较好的兼容性，插件丰富。</p>
<h1 id="unittest"><a href="#unittest" class="headerlink" title="unittest"></a>unittest</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>unittest中最核心的四个概念是：test fixture、test case、test suite、test runner 。</p>
<ul>
<li>test fixture：表示执行一个或多个测试所需的准备，以及任何关联的清理操作。例如这可能涉及创建临时或代理数据库、目录或启动服务器进程。</li>
<li>test case：测试用例是最小的测试单元。它检查特定的输入集的响应。单元测试提供了一个基类测试用例，可用于创建新的测试用例。</li>
<li>test suite：测试套件是测试用例、测试套件或两者的集合，用于归档需要一起执行的测试。</li>
<li>test runner：是一个用于执行和输出结果的组件。这个运行器可能使用图形接口、文本接口，或返回一个特定的值表示运行测试的结果。</li>
</ul>
<h2 id="编写规则"><a href="#编写规则" class="headerlink" title="编写规则"></a>编写规则</h2><p>编写单元测试时，我们需要编写一个测试类，从unittest.TestCase继承。<br>以test开头的方法就是测试方法，不以test开头的方法不被认为是测试方法，测试的时候不会被执行。<br>对每一类测试都需要编写一个test_xxx()方法。</p>
<h2 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h2><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ tree .</span><br><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── requirements.txt</span><br><span class="line">└── src</span><br><span class="line">├── demo</span><br><span class="line">│   └── calculator.py</span><br><span class="line">└── tests</span><br><span class="line">└── demo</span><br><span class="line">├── __init__.py</span><br><span class="line">├── test_calculator_unittest.py</span><br><span class="line">└── test_calculator_unittest_with_fixture.py</span><br></pre></td></tr></table></figure>
<h3 id="计算器实现代码"><a href="#计算器实现代码" class="headerlink" title="计算器实现代码"></a>计算器实现代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Calculator</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sub</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="keyword">return</span> a - b</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">div</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="keyword">return</span> a / b</span><br></pre></td></tr></table></figure>


<h3 id="计算器测试代码"><a href="#计算器测试代码" class="headerlink" title="计算器测试代码"></a>计算器测试代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>(unittest.TestCase):</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add</span>(<span class="params">self</span>):</span><br><span class="line">c = Calculator()</span><br><span class="line">result = c.add(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">self.assertEqual(result, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_sub</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.sub(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">        self.assertEqual(result, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_mul</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.mul(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">        self.assertEqual(result, <span class="number">35</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_div</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.div(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">        self.assertEqual(result, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">unittest.main()</span><br></pre></td></tr></table></figure>

<h3 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Ran 4 tests in 0.002s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<h2 id="用例前置和后置"><a href="#用例前置和后置" class="headerlink" title="用例前置和后置"></a>用例前置和后置</h2><p>基于unittest的四个概念的理解，上述简单用例，可以修改为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculatorWithFixture</span>(unittest.TestCase):</span><br><span class="line"><span class="comment"># 测试用例前置动作</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setUp</span>(<span class="params">self</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;test start&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试用例后置动作</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tearDown</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;test end&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_add</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.add(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">        self.assertEqual(result, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_sub</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.sub(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">        self.assertEqual(result, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_mul</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.mul(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">        self.assertEqual(result, <span class="number">35</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_div</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.div(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">        self.assertEqual(result, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"><span class="comment"># 创建测试套件</span></span><br><span class="line">suit = unittest.TestSuite()</span><br><span class="line">suit.addTest(TestCalculatorWithFixture(<span class="string">&quot;test_add&quot;</span>))</span><br><span class="line">suit.addTest(TestCalculatorWithFixture(<span class="string">&quot;test_sub&quot;</span>))</span><br><span class="line">suit.addTest(TestCalculatorWithFixture(<span class="string">&quot;test_mul&quot;</span>))</span><br><span class="line">suit.addTest(TestCalculatorWithFixture(<span class="string">&quot;test_div&quot;</span>))</span><br><span class="line"><span class="comment"># 创建测试运行器</span></span><br><span class="line">runner = unittest.TestRunner()</span><br><span class="line">runner.run(suit)</span><br></pre></td></tr></table></figure>

<h2 id="参数化"><a href="#参数化" class="headerlink" title="参数化"></a>参数化</h2><p>标准库的unittest自身不支持参数化测试，可以通过第三方库来支持：parameterized和ddt。</p>
<p>其中parameterized只需要一个装饰器@parameterized.expand，ddt需要三个装饰器@ddt、@data、@unpack，它们生成的test分别有一个名字，ddt会携带具体的参数信息。</p>
<h3 id="parameterized"><a href="#parameterized" class="headerlink" title="parameterized"></a>parameterized</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> parameterized <span class="keyword">import</span> parameterized, param</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>(unittest.TestCase):</span><br><span class="line"><span class="meta">@parameterized.expand(<span class="params">[</span></span></span><br><span class="line"><span class="params"><span class="meta">param(<span class="params"><span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">param(<span class="params"><span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">param(<span class="params"><span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span></span>)</span></span></span><br><span class="line"><span class="params"><span class="meta">]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add</span>(<span class="params">self, num1, num2, total</span>):</span><br><span class="line">c = Calculator()</span><br><span class="line">result = c.add(num1, num2)</span><br><span class="line">self.assertEqual(result, total)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">unittest.main()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line"></span><br><span class="line">test_add_0 (__main__.TestCalculator) ... ok</span><br><span class="line">test_add_1 (__main__.TestCalculator) ... ok</span><br><span class="line">test_add_2 (__main__.TestCalculator) ... ok</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran <span class="number">3</span> tests <span class="keyword">in</span> <span class="number">0.000</span>s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<h3 id="ddt"><a href="#ddt" class="headerlink" title="ddt"></a>ddt</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ddt <span class="keyword">import</span> data, unpack, ddt</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"><span class="meta">@ddt</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>(unittest.TestCase):</span><br><span class="line"><span class="meta">@data(<span class="params">(<span class="params"><span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span></span>),(<span class="params"><span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></span>),(<span class="params"><span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span></span>)</span>)</span></span><br><span class="line"><span class="meta">@unpack</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add</span>(<span class="params">self, num1, num2, total</span>):</span><br><span class="line">c = Calculator()</span><br><span class="line">result = c.add(num1, num2)</span><br><span class="line">self.assertEqual(result, total)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">unittest.main()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line"></span><br><span class="line">test_add_1__3__5__8_ (__main__.TestCalculator) ... ok</span><br><span class="line">test_add_2__1__2__3_ (__main__.TestCalculator) ... ok</span><br><span class="line">test_add_3__2__2__4_ (__main__.TestCalculator) ... ok</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran <span class="number">3</span> tests <span class="keyword">in</span> <span class="number">0.000</span>s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<h2 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h2><p>unittest提供了丰富的断言，常用的包括：</p>
<p>assertEqual、assertNotEqual、assertTrue、assertFalse、assertIn、assertNotIn等。</p>
<p>具体可以直接看源码提供的方法：<br><img src="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img.png"></p>
<h1 id="nose"><a href="#nose" class="headerlink" title="nose"></a>nose</h1><p>nose已经进入维护模式，从github nose上可以看到，nose最近的一次代码提交还是在2016年5月4日。</p>
<p>继承nose的是nose2，但要注意的是，nose2并不支持nose的全部功能，它们的区别可以看这里。nose2的主要目的是扩展Python的标准单元测试库unittest，因此它的定位是“带插件的unittest”。nose2提供的插件，例如测试用例加载器，覆盖度报告生成器，并行测试等内置插件和第三方插件，让单元测试变得更加完善。</p>
<p>nose2的社区没有pytest的活跃，要使用高级框架，推荐使用pytest，因此下文不做过多详述。</p>
<h2 id="编写规则-1"><a href="#编写规则-1" class="headerlink" title="编写规则"></a>编写规则</h2><p>nose2的测试用例并不限制于类，也可以直接使用函数。<br>任何函数和类，只要名称匹配一定的条件(例如，以test开头或以test结尾等)，都会被自动识别为测试用例；<br>为了兼容unittest, 所有的基于unitest编写的测试用例，也会被nose自动识别为。</p>
<h2 id="简单示例-1"><a href="#简单示例-1" class="headerlink" title="简单示例"></a>简单示例</h2><h3 id="计算器代码"><a href="#计算器代码" class="headerlink" title="计算器代码"></a>计算器代码</h3><p>参考unittest的计算器代码部分。</p>
<h3 id="计算器测试代码-1"><a href="#计算器测试代码-1" class="headerlink" title="计算器测试代码"></a>计算器测试代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nose2</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add</span>():</span><br><span class="line">c = Calculator()</span><br><span class="line">result = c.add(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">assert</span> result == <span class="number">8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_sub</span>():</span><br><span class="line">c = Calculator()</span><br><span class="line">result = c.sub(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">assert</span> result == <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_mul</span>():</span><br><span class="line">c = Calculator()</span><br><span class="line">result = c.mul(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line"><span class="keyword">assert</span> result == <span class="number">35</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_div</span>():</span><br><span class="line">c = Calculator()</span><br><span class="line">result = c.div(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">assert</span> result == <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">nose2.main()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">....</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran <span class="number">4</span> tests <span class="keyword">in</span> <span class="number">0.000</span>s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<h2 id="参数化-1"><a href="#参数化-1" class="headerlink" title="参数化"></a>参数化</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nose2</span><br><span class="line"><span class="keyword">from</span> nose2.tools <span class="keyword">import</span> params</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line">test_data = [</span><br><span class="line">&#123;<span class="string">&quot;nums&quot;</span>: (<span class="number">3</span>, <span class="number">5</span>), <span class="string">&quot;total&quot;</span>: <span class="number">8</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;nums&quot;</span>: (<span class="number">1</span>, <span class="number">2</span>), <span class="string">&quot;total&quot;</span>: <span class="number">3</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;nums&quot;</span>: (<span class="number">2</span>, <span class="number">2</span>), <span class="string">&quot;total&quot;</span>: <span class="number">4</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@params(<span class="params">*test_data</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add</span>(<span class="params">data</span>):</span><br><span class="line">c = Calculator()</span><br><span class="line">result = c.add(*data[<span class="string">&#x27;nums&#x27;</span>])</span><br><span class="line"><span class="keyword">assert</span> result == data[<span class="string">&#x27;total&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">nose2.main()</span><br></pre></td></tr></table></figure>

<h1 id="pytest"><a href="#pytest" class="headerlink" title="pytest"></a>pytest</h1><h2 id="编写规则-2"><a href="#编写规则-2" class="headerlink" title="编写规则"></a>编写规则</h2><ul>
<li>测试文件以test_开头（以test结尾也可以） </li>
<li>测试类以Test开头，并且不能带有 init 方法 </li>
<li>测试函数以test_开头 </li>
<li>断言使用基本的assert即可 </li>
<li>可以通过下面的命令，查看 Pytest 收集到哪些测试用例：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">py.test --collect-only</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="简单示例-2"><a href="#简单示例-2" class="headerlink" title="简单示例"></a>简单示例</h2><h3 id="计算器代码-1"><a href="#计算器代码-1" class="headerlink" title="计算器代码"></a>计算器代码</h3><p>参考unittest的计算器代码部分。</p>
<h3 id="计算器实现代码-1"><a href="#计算器实现代码-1" class="headerlink" title="计算器实现代码"></a>计算器实现代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>():</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add</span>(<span class="params">self</span>):</span><br><span class="line">c = Calculator()</span><br><span class="line">result = c.add(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">assert</span> result == <span class="number">8</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_sub</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.sub(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">assert</span> result == <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_mul</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.mul(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">        <span class="keyword">assert</span> result == <span class="number">35</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_div</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.div(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">assert</span> result == <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">pytest.main([<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;test_calculator_pytest.py&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">============================= test session starts ==============================</span><br><span class="line">platform darwin -- Python <span class="number">3.8</span><span class="number">.3</span>, pytest-<span class="number">6.2</span><span class="number">.2</span>, py-<span class="number">1.10</span><span class="number">.0</span>, pluggy-<span class="number">0.13</span><span class="number">.1</span></span><br><span class="line">rootdir: python-ut/src/tests/demo</span><br><span class="line">plugins: metadata-<span class="number">1.11</span><span class="number">.0</span>, html-<span class="number">3.1</span><span class="number">.1</span></span><br><span class="line">collected <span class="number">4</span> items</span><br><span class="line"></span><br><span class="line">test_calculator_pytest.py ....</span><br><span class="line"></span><br><span class="line">============================== <span class="number">4</span> passed <span class="keyword">in</span> <span class="number">0.01</span>s ===============================</span><br></pre></td></tr></table></figure>

<h2 id="用例前置和后置-1"><a href="#用例前置和后置-1" class="headerlink" title="用例前置和后置"></a>用例前置和后置</h2><p>加上fixture夹具，有几种方式：</p>
<p>将夹具函数名称作为参数传递到测试用例函数当中</p>
<ul>
<li>@pytest.mark.usefixtures(“夹具函数名称”)</li>
<li>@pytest.fixture(autouse&#x3D;True)，设置了autouse，就可以不用上述两种手动方式，默认就会使用夹具<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_up</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[pytest with fixture] start&quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[pytest with fixture] end&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_add</span>(<span class="params">self, set_up</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.add(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">assert</span> result == <span class="number">8</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_sub</span>(<span class="params">self, set_up</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.sub(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">assert</span> result == <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @pytest.mark.usefixtures(<span class="params"><span class="string">&quot;set_up&quot;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_mul</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.mul(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">        <span class="keyword">assert</span> result == <span class="number">35</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @pytest.mark.usefixtures(<span class="params"><span class="string">&quot;set_up&quot;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_div</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.div(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">assert</span> result == <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main([<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;test_calculator_pytest_with_fixture.py&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 执行结果：</span></span><br><span class="line"></span><br><span class="line">============================= test session starts ==============================</span><br><span class="line">platform darwin -- Python <span class="number">3.8</span><span class="number">.3</span>, pytest-<span class="number">6.2</span><span class="number">.2</span>, py-<span class="number">1.10</span><span class="number">.0</span>, pluggy-<span class="number">0.13</span><span class="number">.1</span></span><br><span class="line">rootdir: python-ut/src/tests/demo</span><br><span class="line">plugins: metadata-<span class="number">1.11</span><span class="number">.0</span>, html-<span class="number">3.1</span><span class="number">.1</span></span><br><span class="line">collected <span class="number">4</span> items</span><br><span class="line"></span><br><span class="line">test_calculator_pytest_with_fixture.py [pytest <span class="keyword">with</span> fixture] start</span><br><span class="line">.[pytest <span class="keyword">with</span> fixture] end</span><br><span class="line">[pytest <span class="keyword">with</span> fixture] start</span><br><span class="line">.[pytest <span class="keyword">with</span> fixture] end</span><br><span class="line">[pytest <span class="keyword">with</span> fixture] start</span><br><span class="line">.[pytest <span class="keyword">with</span> fixture] end</span><br><span class="line">[pytest <span class="keyword">with</span> fixture] start</span><br><span class="line">.[pytest <span class="keyword">with</span> fixture] end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">============================== <span class="number">4</span> passed <span class="keyword">in</span> <span class="number">0.01</span>s ===============================</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="参数化-2"><a href="#参数化-2" class="headerlink" title="参数化"></a>参数化</h2><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><p>如果只有一个参数，里面则是值的列表，比如@pytest.mark.parametrize(“num1”, [3, 5, 8])<br>如果有多个参数，则需要用元祖来存放值，一个元祖对应一组参数的值，比如@pytest.mark.parametrize(“num1, num2, total”, [(3, 5, 8), (1, 2, 3), (2, 2, 4)])<br>当装饰器 @pytest.mark.parametrize 装饰测试类时，会将数据集合传递给类的所有测试用例方法<br>一个函数或一个类可以装饰多个 @pytest.mark.parametrize，当参数化有多个装饰器时，用例数是N*M…</p>
<h3 id="参数化测试"><a href="#参数化测试" class="headerlink" title="参数化测试"></a>参数化测试</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>():</span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(<span class="params"><span class="string">&quot;num1, num2, total&quot;</span>, [(<span class="params"><span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span></span>), (<span class="params"><span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></span>), (<span class="params"><span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span></span>)]</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_add</span>(<span class="params">self, num1, num2, total</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.add(num1, num2)</span><br><span class="line">        <span class="keyword">assert</span> result == total</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main([<span class="string">&#x27;test_calculator_pytest_with_parameterize.py&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果：</span></span><br><span class="line"></span><br><span class="line">============================= test session starts ==============================</span><br><span class="line">platform darwin -- Python <span class="number">3.8</span><span class="number">.3</span>, pytest-<span class="number">6.2</span><span class="number">.2</span>, py-<span class="number">1.10</span><span class="number">.0</span>, pluggy-<span class="number">0.13</span><span class="number">.1</span></span><br><span class="line">rootdir: python-ut/src/tests/demo</span><br><span class="line">plugins: metadata-<span class="number">1.11</span><span class="number">.0</span>, html-<span class="number">3.1</span><span class="number">.1</span></span><br><span class="line">collected <span class="number">3</span> items</span><br><span class="line"></span><br><span class="line">test_calculator_pytest_with_paramtrize.py ...</span><br><span class="line"></span><br><span class="line">============================== <span class="number">3</span> passed <span class="keyword">in</span> <span class="number">0.01</span>s ===============================</span><br></pre></td></tr></table></figure>

<h3 id="参数化标记数据"><a href="#参数化标记数据" class="headerlink" title="参数化标记数据"></a>参数化标记数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>():</span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;num1, num2, total&quot;</span>, [</span></span></span><br><span class="line"><span class="params"><span class="meta">pytest.param(<span class="params"><span class="number">5</span>, <span class="number">1</span>, <span class="number">4</span>, marks=pytest.mark.passed</span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">pytest.param(<span class="params"><span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, marks=pytest.mark.fail</span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">(<span class="params"><span class="number">5</span>, <span class="number">4</span>, <span class="number">1</span></span>)</span></span></span><br><span class="line"><span class="params"><span class="meta">]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_sub</span>(<span class="params">self, num1, num2, total</span>):</span><br><span class="line">c = Calculator()</span><br><span class="line">result = c.sub(num1, num2)</span><br><span class="line"><span class="keyword">assert</span> result == total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">pytest.main([<span class="string">&#x27;test_calculator_pytest_with_parameterize.py&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果：</span></span><br><span class="line"></span><br><span class="line">============================= test session starts ==============================</span><br><span class="line">platform darwin -- Python <span class="number">3.8</span><span class="number">.3</span>, pytest-<span class="number">6.2</span><span class="number">.2</span>, py-<span class="number">1.10</span><span class="number">.0</span>, pluggy-<span class="number">0.13</span><span class="number">.1</span></span><br><span class="line">rootdir: python-ut/src/tests/demo</span><br><span class="line">plugins: metadata-<span class="number">1.11</span><span class="number">.0</span>, html-<span class="number">3.1</span><span class="number">.1</span></span><br><span class="line">collected <span class="number">3</span> items</span><br><span class="line"></span><br><span class="line">test_calculator_pytest_with_paramtrize.py .F.                            [<span class="number">100</span>%]</span><br><span class="line"></span><br><span class="line">=================================== FAILURES ===================================</span><br><span class="line">________________________ TestCalculator.test_sub[<span class="number">5</span>-<span class="number">2</span>-<span class="number">4</span>] ________________________</span><br><span class="line"></span><br><span class="line">self = &lt;demo.test_calculator_pytest_with_paramtrize.TestCalculator <span class="built_in">object</span> at <span class="number">0x110813d00</span>&gt;</span><br><span class="line">num1 = <span class="number">5</span>, num2 = <span class="number">2</span>, total = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(<span class="params"><span class="string">&quot;num1, num2, total&quot;</span>, [</span></span></span><br><span class="line"><span class="params"><span class="meta">        pytest.param(<span class="params"><span class="number">5</span>, <span class="number">1</span>, <span class="number">4</span>, marks=pytest.mark.passed</span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">        pytest.param(<span class="params"><span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, marks=pytest.mark.fail</span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">        (<span class="params"><span class="number">5</span>, <span class="number">4</span>, <span class="number">1</span></span>)</span></span></span><br><span class="line"><span class="params"><span class="meta">    ]</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_sub</span>(<span class="params">self, num1, num2, total</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        result = c.sub(num1, num2)</span><br><span class="line">&gt;       <span class="keyword">assert</span> result == total</span><br><span class="line">E       <span class="keyword">assert</span> <span class="number">3</span> == <span class="number">4</span></span><br><span class="line"></span><br><span class="line">test_calculator_pytest_with_paramtrize.py:<span class="number">21</span>: AssertionError</span><br><span class="line">=========================== short test summary info ============================</span><br><span class="line">FAILED test_calculator_pytest_with_paramtrize.py::TestCalculator::test_sub[<span class="number">5</span>-<span class="number">2</span>-<span class="number">4</span>]</span><br><span class="line">=================== <span class="number">1</span> failed, <span class="number">2</span> passed, <span class="number">2</span> warnings <span class="keyword">in</span> <span class="number">0.04</span>s ====================</span><br></pre></td></tr></table></figure>

<h2 id="断言-1"><a href="#断言-1" class="headerlink" title="断言"></a>断言</h2><p>在unittest单元测试框架中提供了丰富的断言方法，例如assertEqual()、assertIn()、assertTrue()、assertIs()等，而pytest单元测试框架中并没提供特殊的断言方法，而是直接使用python的assert进行断言。</p>
<ul>
<li>assert可以使用&#x3D;&#x3D;、!&#x3D;、&lt;、&gt;、&gt;&#x3D;、&lt;&#x3D;等符号来比较相等、不相等、小于、大于、大于等于和小于等于。</li>
<li>断言包含和不包含，使用assert a in b和assert a not in b</li>
<li>断言真假，使用assert condition和assert not condition</li>
<li>断言异常，使用pytest.raise获取信息<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 详细断言异常</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_zero_division_long</span>():</span><br><span class="line"><span class="keyword">with</span> pytest.raises(ZeroDivisionError) <span class="keyword">as</span> excinfo:</span><br><span class="line"><span class="number">1</span> / <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 断言异常类型 type</span></span><br><span class="line">    <span class="keyword">assert</span> excinfo.<span class="built_in">type</span> == ZeroDivisionError</span><br><span class="line">    <span class="comment"># 断言异常 value 值</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&quot;division by zero&quot;</span> <span class="keyword">in</span> <span class="built_in">str</span>(excinfo.value)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="重跑"><a href="#重跑" class="headerlink" title="重跑"></a>重跑</h2><p>需要安装额外的插件pytest-rerunfailures</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.mark.flaky(<span class="params">reruns=<span class="number">5</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_example</span>():</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">assert</span> random.choice([<span class="literal">True</span>, <span class="literal">False</span>, <span class="literal">False</span>])</span><br><span class="line">执行结果:</span><br><span class="line"></span><br><span class="line">collecting ... collected <span class="number">1</span> item</span><br><span class="line"></span><br><span class="line">11_reruns.py::test_example RERUN                                         [<span class="number">100</span>%]</span><br><span class="line">11_reruns.py::test_example PASSED                                        [<span class="number">100</span>%]</span><br><span class="line"></span><br><span class="line">========================= <span class="number">1</span> passed, <span class="number">1</span> rerun <span class="keyword">in</span> <span class="number">0.05</span>s ==========================</span><br></pre></td></tr></table></figure>


<h1 id="Mock"><a href="#Mock" class="headerlink" title="Mock"></a>Mock</h1><h2 id="mock"><a href="#mock" class="headerlink" title="mock"></a>mock</h2><p>mock原是python的第三方库，python3以后mock模块已经整合到了unittest测试框架中。</p>
<p>如果使用的是python3.3以后版本，那么不用单独安装，使用的时候在文件开头引入from unittest import mock即可。</p>
<p>如果使用的是python2，需要先pip install mock安装后再import mock即可。</p>
<h3 id="Mock一个方法"><a href="#Mock一个方法" class="headerlink" title="Mock一个方法"></a>Mock一个方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> mock</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiple</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>(unittest.TestCase):</span><br><span class="line"><span class="meta">    @mock.patch(<span class="params"><span class="string">&#x27;test_calculator_mock.multiple&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_function_multiple</span>(<span class="params">self, mock_multiple</span>):</span><br><span class="line">        mock_return = <span class="number">1</span></span><br><span class="line">        mock_multiple.return_value = mock_return</span><br><span class="line"></span><br><span class="line">        result = multiple(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        self.assertEqual(result, mock_return)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Mock一个对象里面的方法"><a href="#Mock一个对象里面的方法" class="headerlink" title="Mock一个对象里面的方法"></a>Mock一个对象里面的方法</h3><p>分别给出了普通写法和注解写法，以及side_effect关键参数的效果案例。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> mock</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>(unittest.TestCase):</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add</span>(<span class="params">self</span>):</span><br><span class="line">c = Calculator()</span><br><span class="line">mock_return = <span class="number">10</span></span><br><span class="line">c.add = mock.Mock(return_value=mock_return)</span><br><span class="line"></span><br><span class="line">        result = c.add(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        self.assertEqual(result, mock_return)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_add_with_side_effect</span>(<span class="params">self</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        mock_return = <span class="number">10</span></span><br><span class="line">        <span class="comment"># 传递side_effect关键字参数, 会覆盖return_value参数值, 使用真实的add方法测试</span></span><br><span class="line">        c.add = mock.Mock(return_value=mock_return, side_effect=c.add)</span><br><span class="line"></span><br><span class="line">        result = c.add(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        self.assertEqual(result, <span class="number">8</span>)</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @mock.patch.object(<span class="params">Calculator, <span class="string">&#x27;add&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_add_with_annotation</span>(<span class="params">self, mock_add</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        mock_return = <span class="number">10</span></span><br><span class="line">        mock_add.return_value = mock_return</span><br><span class="line"></span><br><span class="line">        result = c.add(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        self.assertEqual(result, mock_return)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">unittest.main()</span><br></pre></td></tr></table></figure>


<h3 id="Mock每次调用返回不同的值"><a href="#Mock每次调用返回不同的值" class="headerlink" title="Mock每次调用返回不同的值"></a>Mock每次调用返回不同的值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> mock</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>(unittest.TestCase):</span><br><span class="line"><span class="meta">@mock.patch.object(<span class="params">Calculator, <span class="string">&#x27;add&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add_with_different_return</span>(<span class="params">self, mock_add</span>):</span><br><span class="line">c = Calculator()</span><br><span class="line">mock_return = [<span class="number">10</span>, <span class="number">8</span>]</span><br><span class="line">mock_add.side_effect = mock_return</span><br><span class="line"></span><br><span class="line">        result1 = c.add(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">        result2 = c.add(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        self.assertEqual(result1, mock_return[<span class="number">0</span>])</span><br><span class="line">        self.assertEqual(result2, mock_return[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">unittest.main()</span><br></pre></td></tr></table></figure>

<h3 id="Mock抛出异常的方法"><a href="#Mock抛出异常的方法" class="headerlink" title="Mock抛出异常的方法"></a>Mock抛出异常的方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> mock</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"><span class="comment"># 被调用函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiple</span>(<span class="params">a, b</span>):</span><br><span class="line"><span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实际调用函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_error</span>(<span class="params">a, b</span>):</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">return</span> multiple(a, b)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>(unittest.TestCase):</span><br><span class="line"><span class="meta">@mock.patch(<span class="params"><span class="string">&#x27;test_calculator_mock.multiple&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_function_multiple_exception</span>(<span class="params">self, mock_multiple</span>):</span><br><span class="line">mock_multiple.side_effect = Exception</span><br><span class="line"></span><br><span class="line">        result = is_error(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        self.assertEqual(result, -<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">unittest.main()</span><br></pre></td></tr></table></figure>


<h3 id="Mock多个方法"><a href="#Mock多个方法" class="headerlink" title="Mock多个方法"></a>Mock多个方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> mock</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiple</span>(<span class="params">a, b</span>):</span><br><span class="line"><span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>(unittest.TestCase):</span><br><span class="line"><span class="meta">@mock.patch.object(<span class="params">Calculator, <span class="string">&#x27;add&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@mock.patch(<span class="params"><span class="string">&#x27;test_calculator_mock.multiple&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_both</span>(<span class="params">self, mock_multiple, mock_add</span>):</span><br><span class="line">c = Calculator()</span><br><span class="line">mock_add.return_value = <span class="number">1</span></span><br><span class="line">mock_multiple.return_value = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        self.assertEqual(c.add(<span class="number">3</span>, <span class="number">5</span>), <span class="number">1</span>)</span><br><span class="line">        self.assertEqual(multiple(<span class="number">3</span>, <span class="number">5</span>), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">unittest.main()</span><br></pre></td></tr></table></figure>

<h2 id="pytest-mock"><a href="#pytest-mock" class="headerlink" title="pytest-mock"></a>pytest-mock</h2><p>如果项目本身使用的框架是 pytest，则 Mock 更建议使用 pytest-mock 这个插件，它提供了一个名为mocker的fixture，仅在当前测试funciton或method生效，而不用自行包装。</p>
<p>mocker和mock.patch有相同的api，支持相同的参数。</p>
<h3 id="简单示例-3"><a href="#简单示例-3" class="headerlink" title="简单示例"></a>简单示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.demo.calculator <span class="keyword">import</span> Calculator</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCalculator</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_add</span>(<span class="params">self, mocker</span>):</span><br><span class="line">        c = Calculator()</span><br><span class="line">        mock_return = <span class="number">10</span></span><br><span class="line">        mocker.patch.<span class="built_in">object</span>(c, <span class="string">&#x27;add&#x27;</span>, return_value=mock_return)</span><br><span class="line"></span><br><span class="line">        result = c.add(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> result == mock_return</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">pytest.main([<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;test_calculator_pytest_mock.py&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="mock方法和域"><a href="#mock方法和域" class="headerlink" title="mock方法和域"></a>mock方法和域</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ForTest</span>:</span><br><span class="line">field = <span class="string">&#x27;origin&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">method</span>():</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_for_test</span>(<span class="params">mocker</span>):</span><br><span class="line">test = ForTest()</span><br><span class="line"><span class="comment"># 方法</span></span><br><span class="line">mock_method = mocker.patch.<span class="built_in">object</span>(test, <span class="string">&#x27;method&#x27;</span>)</span><br><span class="line">test.method()</span><br><span class="line"><span class="comment"># 检查行为</span></span><br><span class="line"><span class="keyword">assert</span> mock_method.called</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 域</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;origin&#x27;</span> == test.field</span><br><span class="line">    mocker.patch.<span class="built_in">object</span>(test, <span class="string">&#x27;field&#x27;</span>, <span class="string">&#x27;mocked&#x27;</span>)</span><br><span class="line">    <span class="comment"># 检查结果</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;mocked&#x27;</span> == test.field</span><br></pre></td></tr></table></figure>

<h2 id="monkeypatch"><a href="#monkeypatch" class="headerlink" title="monkeypatch"></a>monkeypatch</h2><p>monkeypatch是pytest框架内置的固件，有时候，测试用例需要调用某些依赖于全局配置的功能，或者这些功能本身又调用了某些不容易测试的代码（例如：网络接入）。monkeypatch提供了一些方法，用于安全地修补和模拟测试中的功能：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">monkeypatch.<span class="built_in">setattr</span>(obj, name, value, raising=<span class="literal">True</span>)</span><br><span class="line">monkeypatch.<span class="built_in">delattr</span>(obj, name, raising=<span class="literal">True</span>)</span><br><span class="line">monkeypatch.setitem(mapping, name, value)</span><br><span class="line">monkeypatch.delitem(obj, name, raising=<span class="literal">True</span>)</span><br><span class="line">monkeypatch.setenv(name, value, prepend=<span class="literal">False</span>)</span><br><span class="line">monkeypatch.delenv(name, raising=<span class="literal">True</span>)</span><br><span class="line">monkeypatch.syspath_prepend(path)</span><br><span class="line">monkeypatch.chdir(path)</span><br></pre></td></tr></table></figure>

<p>主要考虑以下情形：</p>
<ul>
<li>修改测试的函数行为或类的属性</li>
<li>修改字典的值</li>
<li>修改测试环境的环境变量</li>
<li>在测试期间，用于修改和 更改当前工作目录的上下文。</li>
</ul>
<h1 id="单元测试覆盖率报告"><a href="#单元测试覆盖率报告" class="headerlink" title="单元测试覆盖率报告"></a>单元测试覆盖率报告</h1><ul>
<li>coverage 是 Python 推荐使用的覆盖率统计工具。</li>
<li>pytest-cov 是 pytest 的插件，它可以让你在 pytest 中使用 cpverage.py。</li>
<li>HtmlTestRunner，需要在代码里面写入一点配置，但是报告生成比较美观。</li>
<li>coverage和pytest-cov只需要配置，就可直接使用，不需要测试代码配合。</li>
</ul>
<h2 id="coverage"><a href="#coverage" class="headerlink" title="coverage"></a>coverage</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install coverage</span><br></pre></td></tr></table></figure>
<p>详情可参考：<a href="https://coverage.readthedocs.io/en/coverage-5.5/">https://coverage.readthedocs.io/en/coverage-5.5/</a></p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">coverage run -m unittest discover</span><br></pre></td></tr></table></figure>
<p>运行结束之后，会生成一个覆盖率统计结果文件（data file）.coverage文件，在pycharm里可识别为一个数据库：</p>
<p><img src="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img_1.png"></p>
<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><h4 id="report"><a href="#report" class="headerlink" title="report"></a>report</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">coverage report -m</span><br></pre></td></tr></table></figure>
<p>执行结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">coverage report -m</span></span><br><span class="line">Name                                                            Stmts   Miss  Cover   Missing</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">src/tests/demo/test_calculator_pytest_with_fixture.py              28     16    43%   8-10, 15-17, 20-22, 26-28, 32-34, 38</span><br><span class="line">src/tests/demo/test_calculator_pytest_with_parameterize.py         15      7    53%   9-11, 19-21, 25</span><br><span class="line">src/tests/demo/test_calculator_unittest.py                         22      1    95%   31</span><br><span class="line">src/tests/demo/test_calculator_unittest_with_ddt.py                13      1    92%   18</span><br></pre></td></tr></table></figure>

<h4 id="html"><a href="#html" class="headerlink" title="html"></a>html</h4><p>会生成htmlcov&#x2F;index.html文件，在浏览器查看：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">coverage html</span><br></pre></td></tr></table></figure>
<p>点击各个py文件，可以查看详细情况。</p>
<h2 id="html-testRunner"><a href="#html-testRunner" class="headerlink" title="html-testRunner"></a>html-testRunner</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install html-testRunner </span><br></pre></td></tr></table></figure>
<p>详细说明可参考HtmlTestRunner: <a href="https://github.com/oldani/HtmlTestRunner">https://github.com/oldani/HtmlTestRunner</a></p>
<h3 id="运行-1"><a href="#运行-1" class="headerlink" title="运行"></a>运行</h3><p>在代码中加上HTMLTestRunner，如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> HtmlTestRunner</span><br><span class="line"></span><br><span class="line"><span class="comment"># some tests here</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">unittest.main(testRunner=HtmlTestRunner.HTMLTestRunner())</span><br><span class="line">如果是在测试套件中运行，换成HTMLTestRunner即可：</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建测试运行器</span></span><br><span class="line"><span class="comment"># runner = unittest.TestRunner()</span></span><br><span class="line">runner = HTMLTestRunner()</span><br><span class="line">runner.run(suit)</span><br></pre></td></tr></table></figure>


<h3 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h3><p>默认会生成reports&#x2F; 文件夹，按照时间显示报告：<br><img src="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img_2.png"></p>
<h2 id="pytest-cov"><a href="#pytest-cov" class="headerlink" title="pytest-cov"></a>pytest-cov</h2><h3 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pytest-cov</span><br></pre></td></tr></table></figure>
<p>详细可参考pytest-cov: <a href="https://github.com/pytest-dev/pytest-cov">https://github.com/pytest-dev/pytest-cov</a></p>
<h3 id="运行-2"><a href="#运行-2" class="headerlink" title="运行"></a>运行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest --cov --cov-report=html   </span><br></pre></td></tr></table></figure>
<p>或者指定目录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest --cov=src --cov-report=html   </span><br></pre></td></tr></table></figure>
<h3 id="结果-2"><a href="#结果-2" class="headerlink" title="结果"></a>结果</h3><p>会生成htmlcov&#x2F;index.html文件，在浏览器查看，类似于coverage的报告。</p>
<h2 id="可能的问题"><a href="#可能的问题" class="headerlink" title="可能的问题"></a>可能的问题</h2><h3 id="报告没生成"><a href="#报告没生成" class="headerlink" title="报告没生成"></a>报告没生成</h3><p>如果出现不了报告，pycharm运行的时候，记得选择python，而不是Python tests<br><img src="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img_3.png"></p>
<h3 id="在Pycharm中配置覆盖率展示"><a href="#在Pycharm中配置覆盖率展示" class="headerlink" title="在Pycharm中配置覆盖率展示"></a>在Pycharm中配置覆盖率展示</h3><p>可选择unittest和pytest为默认runner<br><img src="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img_4.png"></p>
<p>可显示覆盖率窗口：<br><img src="http://cdn.yuleweici.com/Python-%E5%8D%95%E6%B5%8B/img_5.png"></p>
<h1 id="情景示例"><a href="#情景示例" class="headerlink" title="情景示例"></a>情景示例</h1><h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><h3 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h3><p>一个简单的博客系统，包含：</p>
<ul>
<li>创建文章</li>
<li>获取文章</li>
<li>获取文章列表</li>
</ul>
<h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">├── README.md</span><br><span class="line">├── requirements.txt</span><br><span class="line">└── src</span><br><span class="line">├── blog</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── app.py</span><br><span class="line">│   ├── commands.py</span><br><span class="line">│   ├── database.db</span><br><span class="line">│   ├── init_db.py</span><br><span class="line">│   ├── models.py</span><br><span class="line">│   └── queries.py</span><br><span class="line">└── tests</span><br><span class="line">└── blog</span><br><span class="line">├── __init__.py</span><br><span class="line">├── conftest.py</span><br><span class="line">├── schemas</span><br><span class="line">│   ├── Article.json</span><br><span class="line">│   ├── ArticleList.json</span><br><span class="line">│   └── __init__.py</span><br><span class="line">├── test_app.py</span><br><span class="line">├── test_commands.py</span><br><span class="line">└── test_queries.py</span><br></pre></td></tr></table></figure>

<h3 id="关键技术"><a href="#关键技术" class="headerlink" title="关键技术"></a>关键技术</h3><ul>
<li>Flask，web框架</li>
<li>SQLite，轻量级数据库，文件格式</li>
<li>pytest，单元测试框架</li>
<li>Pydantic，数据校验</li>
</ul>
<h2 id="Service测试"><a href="#Service测试" class="headerlink" title="Service测试"></a>Service测试</h2><h3 id="创建文章"><a href="#创建文章" class="headerlink" title="创建文章"></a>创建文章</h3><p>models.py如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, EmailStr, Field</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotFound</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Article</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line"><span class="built_in">id</span>: <span class="built_in">str</span> = Field(default_factory=<span class="keyword">lambda</span>: <span class="built_in">str</span>(uuid.uuid4()))</span><br><span class="line">author: EmailStr</span><br><span class="line">title: <span class="built_in">str</span></span><br><span class="line">content: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_by_id</span>(<span class="params">cls, article_id: <span class="built_in">str</span></span>):</span><br><span class="line">        con = sqlite3.connect(os.getenv(<span class="string">&#x27;DATABASE_NAME&#x27;</span>, <span class="string">&#x27;database.db&#x27;</span>))</span><br><span class="line">        con.row_factory = sqlite3.Row</span><br><span class="line"></span><br><span class="line">        cur = con.cursor()</span><br><span class="line">        cur.execute(<span class="string">&quot;SELECT * FROM articles WHERE id=?&quot;</span>, (article_id,))</span><br><span class="line"></span><br><span class="line">        record = cur.fetchone()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> record <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> NotFound</span><br><span class="line"></span><br><span class="line">        article = cls(**record)  <span class="comment"># Row can be unpacked as dict</span></span><br><span class="line">        con.close()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> article</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_by_title</span>(<span class="params">cls, title: <span class="built_in">str</span></span>):</span><br><span class="line">        con = sqlite3.connect(os.getenv(<span class="string">&#x27;DATABASE_NAME&#x27;</span>, <span class="string">&#x27;database.db&#x27;</span>))</span><br><span class="line">        con.row_factory = sqlite3.Row</span><br><span class="line"></span><br><span class="line">        cur = con.cursor()</span><br><span class="line">        cur.execute(<span class="string">&quot;SELECT * FROM articles WHERE title = ?&quot;</span>, (title,))</span><br><span class="line"></span><br><span class="line">        record = cur.fetchone()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> record <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> NotFound</span><br><span class="line"></span><br><span class="line">        article = cls(**record)  <span class="comment"># Row can be unpacked as dict</span></span><br><span class="line">        con.close()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> article</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list</span>(<span class="params">cls</span>) -&gt; <span class="type">List</span>[<span class="string">&#x27;Article&#x27;</span>]:</span><br><span class="line">        con = sqlite3.connect(os.getenv(<span class="string">&#x27;DATABASE_NAME&#x27;</span>, <span class="string">&#x27;database.db&#x27;</span>))</span><br><span class="line">        con.row_factory = sqlite3.Row</span><br><span class="line"></span><br><span class="line">        cur = con.cursor()</span><br><span class="line">        cur.execute(<span class="string">&quot;SELECT * FROM articles&quot;</span>)</span><br><span class="line"></span><br><span class="line">        records = cur.fetchall()</span><br><span class="line">        articles = [cls(**record) <span class="keyword">for</span> record <span class="keyword">in</span> records]</span><br><span class="line">        con.close()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> articles</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self</span>) -&gt; <span class="string">&#x27;Article&#x27;</span>:</span><br><span class="line">        <span class="keyword">with</span> sqlite3.connect(os.getenv(<span class="string">&#x27;DATABASE_NAME&#x27;</span>, <span class="string">&#x27;database.db&#x27;</span>)) <span class="keyword">as</span> con:</span><br><span class="line">            cur = con.cursor()</span><br><span class="line">            cur.execute(</span><br><span class="line">                <span class="string">&quot;INSERT INTO articles (id,author,title,content) VALUES(?, ?, ?, ?)&quot;</span>,</span><br><span class="line">                (self.<span class="built_in">id</span>, self.author, self.title, self.content)</span><br><span class="line">            )</span><br><span class="line">            con.commit()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_table</span>(<span class="params">cls, database_name=<span class="string">&#x27;database.db&#x27;</span></span>):</span><br><span class="line">        conn = sqlite3.connect(database_name)</span><br><span class="line"></span><br><span class="line">        conn.execute(</span><br><span class="line">            <span class="string">&#x27;CREATE TABLE IF NOT EXISTS articles (id TEXT, author TEXT, title TEXT, content TEXT)&#x27;</span></span><br><span class="line">        )</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>commands.py如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, EmailStr</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.blog.models <span class="keyword">import</span> Article, NotFound</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AlreadyExists</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreateArticleCommand</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">author: EmailStr</span><br><span class="line">title: <span class="built_in">str</span></span><br><span class="line">content: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>) -&gt; Article:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            Article.get_by_title(self.title)</span><br><span class="line">            <span class="keyword">raise</span> AlreadyExists</span><br><span class="line">        <span class="keyword">except</span> NotFound:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        article = Article(</span><br><span class="line">            author=self.author,</span><br><span class="line">            title=self.title,</span><br><span class="line">            content=self.title</span><br><span class="line">        ).save()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> article</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>单元测试test_commands.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.blog.commands <span class="keyword">import</span> CreateArticleCommand, AlreadyExists</span><br><span class="line"><span class="keyword">from</span> src.blog.models <span class="keyword">import</span> Article</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_create_article</span>():</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">GIVEN CreateArticleCommand with a valid properties author, title and content</span></span><br><span class="line"><span class="string">WHEN the execute method is called</span></span><br><span class="line"><span class="string">THEN a new Article must exist in the database with the same attributes</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">cmd = CreateArticleCommand(</span><br><span class="line">author=<span class="string">&#x27;john@doe.com&#x27;</span>,</span><br><span class="line">title=<span class="string">&#x27;New Article&#x27;</span>,</span><br><span class="line">content=<span class="string">&#x27;Super awesome article&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">    article = cmd.execute()</span><br><span class="line"></span><br><span class="line">    db_article = Article.get_by_id(article.<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> db_article.<span class="built_in">id</span> == article.<span class="built_in">id</span></span><br><span class="line">    <span class="keyword">assert</span> db_article.author == article.author</span><br><span class="line">    <span class="keyword">assert</span> db_article.title == article.title</span><br><span class="line">    <span class="keyword">assert</span> db_article.content == article.content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_create_article_with_mock</span>(<span class="params">monkeypatch</span>):</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">GIVEN CreateArticleCommand with valid properties author, title and content</span></span><br><span class="line"><span class="string">WHEN the execute method is called</span></span><br><span class="line"><span class="string">THEN a new Article must exist in the database with same attributes</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">article = Article(</span><br><span class="line">author=<span class="string">&#x27;john@doe.com&#x27;</span>,</span><br><span class="line">title=<span class="string">&#x27;New Article&#x27;</span>,</span><br><span class="line">content=<span class="string">&#x27;Super awesome article&#x27;</span></span><br><span class="line">)</span><br><span class="line">monkeypatch.<span class="built_in">setattr</span>(</span><br><span class="line">Article,</span><br><span class="line"><span class="string">&#x27;save&#x27;</span>,</span><br><span class="line"><span class="keyword">lambda</span> self: article</span><br><span class="line">)</span><br><span class="line">cmd = CreateArticleCommand(</span><br><span class="line">author=<span class="string">&#x27;john@doe.com&#x27;</span>,</span><br><span class="line">title=<span class="string">&#x27;New Article&#x27;</span>,</span><br><span class="line">content=<span class="string">&#x27;Super awesome article&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">    db_article = cmd.execute()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> db_article.<span class="built_in">id</span> == article.<span class="built_in">id</span></span><br><span class="line">    <span class="keyword">assert</span> db_article.author == article.author</span><br><span class="line">    <span class="keyword">assert</span> db_article.title == article.title</span><br><span class="line">    <span class="keyword">assert</span> db_article.content == article.content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_create_article_already_exists</span>():</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">GIVEN CreateArticleCommand with a title of some article in database</span></span><br><span class="line"><span class="string">WHEN the execute method is called</span></span><br><span class="line"><span class="string">THEN the AlreadyExists exception must be raised</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    Article(</span><br><span class="line">        author=<span class="string">&#x27;jane@doe.com&#x27;</span>,</span><br><span class="line">        title=<span class="string">&#x27;New Article&#x27;</span>,</span><br><span class="line">        content=<span class="string">&#x27;Super extra awesome article&#x27;</span></span><br><span class="line">    ).save()</span><br><span class="line"></span><br><span class="line">    cmd = CreateArticleCommand(</span><br><span class="line">        author=<span class="string">&#x27;john@doe.com&#x27;</span>,</span><br><span class="line">        title=<span class="string">&#x27;New Article&#x27;</span>,</span><br><span class="line">        content=<span class="string">&#x27;Super awesome article&#x27;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> pytest.raises(AlreadyExists):</span><br><span class="line">        cmd.execute()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>当多次运行时候，需要清理数据库，那么需要使用到用例前置和后置：</p>
<p>confest.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.blog.models <span class="keyword">import</span> Article</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">autouse=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">database</span>():</span><br><span class="line">_, file_name = tempfile.mkstemp()</span><br><span class="line">os.environ[<span class="string">&#x27;DATABASE_NAME&#x27;</span>] = file_name</span><br><span class="line">Article.create_table(database_name=file_name)</span><br><span class="line"><span class="keyword">yield</span></span><br><span class="line">os.unlink(file_name)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再次运行，执行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python3 -m pytest src/tests/blog/test_commands.py</span></span><br><span class="line">=================== test session starts ======================</span><br><span class="line">platform darwin -- Python 3.8.3, pytest-6.2.2, py-1.10.0, pluggy-0.13.1</span><br><span class="line">rootdir: python-ut</span><br><span class="line">plugins: metadata-1.11.0, html-3.1.1, mock-3.5.1</span><br><span class="line">collected 3 items</span><br><span class="line"></span><br><span class="line">src/tests/blog/test_commands.py ...                                                                                                                                                                                                                                                                              [100%]</span><br><span class="line"></span><br><span class="line">===================== 3 passed in 0.02s =======================</span><br></pre></td></tr></table></figure>


<h3 id="获取文章列表"><a href="#获取文章列表" class="headerlink" title="获取文章列表"></a>获取文章列表</h3><p>queries.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.blog.models <span class="keyword">import</span> Article</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ListArticlesQuery</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>) -&gt; <span class="type">List</span>[Article]:</span><br><span class="line">        articles = Article.<span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> articles</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>单元测试test_queries.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.blog.models <span class="keyword">import</span> Article</span><br><span class="line"><span class="keyword">from</span> src.blog.queries <span class="keyword">import</span> ListArticlesQuery, GetArticleByIDQuery</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_list_articles</span>():</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">GIVEN 2 articles stored in the database</span></span><br><span class="line"><span class="string">WHEN the execute method is called</span></span><br><span class="line"><span class="string">THEN it should return 2 articles</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">Article(</span><br><span class="line">author=<span class="string">&#x27;jane@doe.com&#x27;</span>,</span><br><span class="line">title=<span class="string">&#x27;New Article&#x27;</span>,</span><br><span class="line">content=<span class="string">&#x27;Super extra awesome article&#x27;</span></span><br><span class="line">).save()</span><br><span class="line">Article(</span><br><span class="line">author=<span class="string">&#x27;jane@doe.com&#x27;</span>,</span><br><span class="line">title=<span class="string">&#x27;Another Article&#x27;</span>,</span><br><span class="line">content=<span class="string">&#x27;Super awesome article&#x27;</span></span><br><span class="line">).save()</span><br><span class="line"></span><br><span class="line">    query = ListArticlesQuery()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(query.execute()) == <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h2 id="其他功能测试"><a href="#其他功能测试" class="headerlink" title="其他功能测试"></a>其他功能测试</h2><p>应用入口app.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, request</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.blog.commands <span class="keyword">import</span> CreateArticleCommand</span><br><span class="line"><span class="keyword">from</span> src.blog.queries <span class="keyword">import</span> GetArticleByIDQuery, ListArticlesQuery</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> ValidationError</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/articles/&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_article</span>():</span><br><span class="line">cmd = CreateArticleCommand(</span><br><span class="line">**request.json</span><br><span class="line">)</span><br><span class="line"><span class="keyword">return</span> jsonify(cmd.execute().<span class="built_in">dict</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/articles/&lt;article_id&gt;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_article</span>(<span class="params">article_id</span>):</span><br><span class="line">query = GetArticleByIDQuery(</span><br><span class="line"><span class="built_in">id</span>=article_id</span><br><span class="line">)</span><br><span class="line"><span class="keyword">return</span> jsonify(query.execute().<span class="built_in">dict</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/articles/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_articles</span>():</span><br><span class="line">query = ListArticlesQuery()</span><br><span class="line">records = [record.<span class="built_in">dict</span>() <span class="keyword">for</span> record <span class="keyword">in</span> query.execute()]</span><br><span class="line"><span class="keyword">return</span> jsonify(records)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params">ValidationError</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_validation_exception</span>(<span class="params">error</span>):</span><br><span class="line">response = jsonify(error.errors())</span><br><span class="line">response.status_code = <span class="number">400</span></span><br><span class="line"><span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure>

<p>暴露json schema，校验响应payload：</p>
<p>Article.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://json-schema.org/draft-07/schema#&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Article&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;object&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;id&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;author&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;title&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;content&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ArticleList.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://json-schema.org/draft-07/schema#&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ArticleList&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;array&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;$ref&quot;</span><span class="punctuation">:</span> <span class="string">&quot;file:Article.json&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>从应用本身，串起来整个流程的测试，测试test_app.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">from</span> jsonschema <span class="keyword">import</span> validate, RefResolver</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.blog.app <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">from</span> src.blog.models <span class="keyword">import</span> Article</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client</span>():</span><br><span class="line">app.config[<span class="string">&#x27;TESTING&#x27;</span>] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> app.test_client() <span class="keyword">as</span> client:</span><br><span class="line">        <span class="keyword">yield</span> client</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_payload</span>(<span class="params">payload, schema_name</span>):</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Validate payload with selected schema</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">schemas_dir = <span class="built_in">str</span>(</span><br><span class="line"><span class="string">f&#x27;<span class="subst">&#123;pathlib.Path(__file__).parent.absolute()&#125;</span>/schemas&#x27;</span></span><br><span class="line">)</span><br><span class="line">schema = json.loads(pathlib.Path(<span class="string">f&#x27;<span class="subst">&#123;schemas_dir&#125;</span>/<span class="subst">&#123;schema_name&#125;</span>&#x27;</span>).read_text())</span><br><span class="line">validate(</span><br><span class="line">payload,</span><br><span class="line">schema,</span><br><span class="line">resolver=RefResolver(</span><br><span class="line"><span class="string">&#x27;file://&#x27;</span> + <span class="built_in">str</span>(pathlib.Path(<span class="string">f&#x27;<span class="subst">&#123;schemas_dir&#125;</span>/<span class="subst">&#123;schema_name&#125;</span>&#x27;</span>).absolute()),</span><br><span class="line">schema  <span class="comment"># it&#x27;s used to resolve file: inside schemas correctly</span></span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_create_article</span>(<span class="params">client</span>):</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">GIVEN request data for new article</span></span><br><span class="line"><span class="string">WHEN endpoint /articles/ is called</span></span><br><span class="line"><span class="string">THEN it should return Article in json format matching schema</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line"><span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;john@doe.com&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;New Article&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;Some extra awesome content&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = client.post(</span><br><span class="line"><span class="string">&#x27;/articles/&#x27;</span>,</span><br><span class="line">data=json.dumps(</span><br><span class="line">data</span><br><span class="line">),</span><br><span class="line">content_type=<span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">    validate_payload(response.json, <span class="string">&#x27;Article.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_get_article</span>(<span class="params">client</span>):</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">GIVEN ID of article stored in the database</span></span><br><span class="line"><span class="string">WHEN endpoint /articles/&lt;id-of-article&gt;/ is called</span></span><br><span class="line"><span class="string">THEN it should return Article in json format matching schema</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">article = Article(</span><br><span class="line">author=<span class="string">&#x27;jane@doe.com&#x27;</span>,</span><br><span class="line">title=<span class="string">&#x27;New Article&#x27;</span>,</span><br><span class="line">content=<span class="string">&#x27;Super extra awesome article&#x27;</span></span><br><span class="line">).save()</span><br><span class="line">response = client.get(</span><br><span class="line"><span class="string">f&#x27;/articles/<span class="subst">&#123;article.<span class="built_in">id</span>&#125;</span>/&#x27;</span>,</span><br><span class="line">content_type=<span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">    validate_payload(response.json, <span class="string">&#x27;Article.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_list_articles</span>(<span class="params">client</span>):</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">GIVEN articles stored in the database</span></span><br><span class="line"><span class="string">WHEN endpoint /articles/ is called</span></span><br><span class="line"><span class="string">THEN it should return list of Article in json format matching schema</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">Article(</span><br><span class="line">author=<span class="string">&#x27;jane@doe.com&#x27;</span>,</span><br><span class="line">title=<span class="string">&#x27;New Article&#x27;</span>,</span><br><span class="line">content=<span class="string">&#x27;Super extra awesome article&#x27;</span></span><br><span class="line">).save()</span><br><span class="line">response = client.get(</span><br><span class="line"><span class="string">&#x27;/articles/&#x27;</span>,</span><br><span class="line">content_type=<span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">    validate_payload(response.json, <span class="string">&#x27;ArticleList.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta"><span class="string">&#x27;data&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">[</span></span></span><br><span class="line"><span class="params"><span class="meta">&#123;</span></span></span><br><span class="line"><span class="params"><span class="meta"><span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;John Doe&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta"><span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;New Article&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta"><span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;Some extra awesome content&#x27;</span></span></span></span><br><span class="line"><span class="params"><span class="meta">&#125;,</span></span></span><br><span class="line"><span class="params"><span class="meta">&#123;</span></span></span><br><span class="line"><span class="params"><span class="meta"><span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;John Doe&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta"><span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;New Article&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">&#125;,</span></span></span><br><span class="line"><span class="params"><span class="meta">&#123;</span></span></span><br><span class="line"><span class="params"><span class="meta"><span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;John Doe&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta"><span class="string">&#x27;title&#x27;</span>: <span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta"><span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;Some extra awesome content&#x27;</span></span></span></span><br><span class="line"><span class="params"><span class="meta">&#125;</span></span></span><br><span class="line"><span class="params"><span class="meta">]</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_create_article_bad_request</span>(<span class="params">client, data</span>):</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">GIVEN request data with invalid values or missing attributes</span></span><br><span class="line"><span class="string">WHEN endpoint /create-article/ is called</span></span><br><span class="line"><span class="string">THEN it should return status 400 and JSON body</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">response = client.post(</span><br><span class="line"><span class="string">&#x27;/articles/&#x27;</span>,</span><br><span class="line">data=json.dumps(</span><br><span class="line">data</span><br><span class="line">),</span><br><span class="line">content_type=<span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> response.status_code == <span class="number">400</span></span><br><span class="line">    <span class="keyword">assert</span> response.json <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>小结<br>自此，上面的web小应用基本可以完成，包含了基本的服务层单元测试、数据库模拟、mock创建文章以及参数化请求验证。<br>代码示例：Python情景示例代码: <a href="https://github.com/vwin/python-ut">https://github.com/vwin/python-ut</a></p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>Python的单元测试框架中，Python库本身提供了unittest，也有第三方框架进行了封装。原生的库插件少，二次开发非常方便。第三方框架融合了不少插件，上手简单。<br>Python属于脚本语言，不像编译型语言那样先将程序编译成二进制再运行，而是动态地逐行解释运行，虽然其本身的结构灵活多变，但是仍然不妨碍我们用单元测试保证其质量、权衡其设计、设置其有形和无形的约束，为开发保驾护航。</p>
<h2 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h2><p><a href="https://wiki.python.org/moin/PythonTestingToolsTaxonomy">Python Testing Tools Taxonomy</a><br><a href="https://testdriven.io/blog/modern-tdd/#when-should-you-use-mocks">Modern Test-Driven Development in Python</a></p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://vwin.github.io/2022/11/03/Python-%E5%8D%95%E6%B5%8B/" title="Python-单测" target="_blank" rel="external">http://vwin.github.io/2022/11/03/Python-单测/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/vwin" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/vwin" target="_blank"><span class="text-dark">will</span><small class="ml-1x">Software Development Engineer in Test &amp; Devops Engineer</small></a></h3>
        <div>测试开发架构师 &amp;&amp; 工程效能专家</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2022/11/04/Go-%E5%8D%95%E6%B5%8B/" title="Go-单测"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2022/11/01/CPP-%E5%8D%95%E6%B5%8B/" title="CPP-单测"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn " data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">    <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/vwin" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://yuleweici.com/yuleweici/" target="_blank" title="Link" data-toggle=tooltip data-placement=top><i class="icon icon-link"></i></a></li>
        
        <li><a href="mailto:crazyboyspecial@qq.com" target="_blank" title="Email" data-toggle=tooltip data-placement=top><i class="icon icon-email"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        &copy; 2022 V
        
        <!-- <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div> -->
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   
    
  <!-- <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script> -->
  <script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: 'kYGZ6VfUgySmlSPFebJoXAD5-MdYXbMMI',
    appKey: 'EkbmuElfV0UIfgK2uCGwvUiU',
    placeholder: '有任何问题可以留言哦~',
    avatar: 'monsterid',
    meta: meta,
    pageSize: '10' || 10,
    serverURLs: 'https://kYGZ6VfU.api.lncldglobal.com',
    visitor: false
  });
  </script>

     



  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script>
  <script>
  //利用 FancyBox 实现点击图片放大
  $(document).ready(function() {
    $('article img').not('[hidden]').not('.panel-body img').each(function() {
      var $image = $(this);
      var imageCaption = $image.attr('alt');
      var $imageWrapLink = $image.parent('a');
      if ($imageWrapLink.length < 1) {
        var src = this.getAttribute('src');
        var idx = src.lastIndexOf('?');
        if (idx != -1) {
          src = src.substring(0, idx);
        }
        $imageWrapLink = $image.wrap('<a href="' + src + '"></a>').parent('a');
      }
      $imageWrapLink.attr('data-fancybox', 'images');
      if (imageCaption) {
        $imageWrapLink.attr('data-caption', imageCaption);
      }
    });
    $().fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
    });
  });
  </script>





</body>
</html>