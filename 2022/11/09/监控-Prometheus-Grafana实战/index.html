<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  <meta name="baidu-site-verification" content="code-w6zMFQOLpu" />
  <meta name="referrer" content="strict-origin-when-cross-origin">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=yes,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>监控-Prometheus+Grafana实战 | 予乐</title>
  <meta name="description" content="使用Prometheus+grafana搭建监控系统">
<meta property="og:type" content="article">
<meta property="og:title" content="监控-Prometheus+Grafana实战">
<meta property="og:url" content="http://vwin.github.io/2022/11/09/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/index.html">
<meta property="og:site_name" content="V&#39;s BLOG">
<meta property="og:description" content="使用Prometheus+grafana搭建监控系统">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_1.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_2.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_3.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_4.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_5.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_6.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_7.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_8.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_9.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_10.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_11.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_12.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_13.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_14.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_15.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_16.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_17.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_18.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_19.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_20.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_21.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_22.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_23.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_24.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_25.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_26.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_27.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_28.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_29.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_30.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_31.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_32.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_33.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_34.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_35.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_36.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_37.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_38.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_39.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_40.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_41.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_42.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_43.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_44.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_45.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_46.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_47.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_48.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_49.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_50.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_51.png">
<meta property="og:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_52.png">
<meta property="article:published_time" content="2022-11-09T03:46:47.000Z">
<meta property="article:modified_time" content="2022-11-20T16:41:44.901Z">
<meta property="article:author" content="V">
<meta property="article:tag" content="Prometheus">
<meta property="article:tag" content="Grafana">
<meta property="article:tag" content="监控">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://vwin.github.io/2022/11/09/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/index.html">
  
    <link rel="alternate" href="/atom.xml" title="V&#39;s BLOG" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
    <link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet">
  
  
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8082412711ea4c547c7fdf0e87eb19fb";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>  
<meta name="generator" content="Hexo 6.0.0"></head>


<body class="main-center theme-purple" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/vwin" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">will</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Software Development Engineer in Test &amp; Devops Engineer</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Beijing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-bookmark">
          <a href="/bookmark">
            
            <i class="icon icon-book"></i>
            
            <span class="menu-title">书签</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/vwin" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://yuleweici.com/yuleweici/" target="_blank" title="Link" data-toggle=tooltip data-placement=top><i class="icon icon-link"></i></a></li>
        
        <li><a href="mailto:crazyboyspecial@qq.com" target="_blank" title="Email" data-toggle=tooltip data-placement=top><i class="icon icon-email"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验.<br><a style='color:red' target="_blank" href="https://yuleweici.com/yuleweici-vuepress/">博客-Vuepress</a><br><a style='color:green' target="_blank" href="http://yuleweici.com/yuleweici-docsify/#/">博客-Docsify</a> </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E4%BD%9C/">工作</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a><span class="category-list-count">60</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AI%E8%AF%84%E6%B5%8B/" rel="tag">AI评测</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CI/" rel="tag">CI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Conan/" rel="tag">Conan</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Derrick/" rel="tag">Derrick</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Devops/" rel="tag">Devops</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/" rel="tag">Go</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Grafana/" rel="tag">Grafana</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IaaS/" rel="tag">IaaS</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Iaas/" rel="tag">Iaas</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Prometheus/" rel="tag">Prometheus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/QPS/" rel="tag">QPS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TPS/" rel="tag">TPS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI%E8%87%AA%E5%8A%A8%E5%8C%96/" rel="tag">UI自动化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aio/" rel="tag">aio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/airtest/" rel="tag">airtest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bio/" rel="tag">bio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bootstrap/" rel="tag">bootstrap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/broker/" rel="tag">broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/buffer/" rel="tag">buffer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/" rel="tag">c++</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cached/" rel="tag">cached</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/celery/" rel="tag">celery</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmake/" rel="tag">cmake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cnpm/" rel="tag">cnpm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/consumer/" rel="tag">consumer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/date/" rel="tag">date</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/datetime/" rel="tag">datetime</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/describe/" rel="tag">describe</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dict/" rel="tag">dict</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/element-ui/" rel="tag">element ui</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/" rel="tag">flask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fn/" rel="tag">fn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fp/" rel="tag">fp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/free/" rel="tag">free</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/geojson/" rel="tag">geojson</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github-pages/" rel="tag">github pages</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gunicorn/" rel="tag">gunicorn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/" rel="tag">hadoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/" rel="tag">ios</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdk/" rel="tag">jdk</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jmeter/" rel="tag">jmeter</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jre/" rel="tag">jre</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/json/" rel="tag">json</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jupyter-notebook/" rel="tag">jupyter notebook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k6/" rel="tag">k6</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/" rel="tag">kafka</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka-topic-sh/" rel="tag">kafka-topic.sh</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda/" rel="tag">lambda</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/laravel/" rel="tag">laravel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/list/" rel="tag">list</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/locust/" rel="tag">locust</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/makefile/" rel="tag">makefile</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/metaclass/" rel="tag">metaclass</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mfs/" rel="tag">mfs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/next/" rel="tag">next</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nio/" rel="tag">nio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nmake/" rel="tag">nmake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/paramiko/" rel="tag">paramiko</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/partition/" rel="tag">partition</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pdf/" rel="tag">pdf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/perf/" rel="tag">perf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php5-fpm/" rel="tag">php5-fpm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php7-fpm/" rel="tag">php7-fpm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pip/" rel="tag">pip</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pytest/" rel="tag">pytest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pythonic/" rel="tag">pythonic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qgis/" rel="tag">qgis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/re/" rel="tag">re</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/replica/" rel="tag">replica</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/roc/" rel="tag">roc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/samba/" rel="tag">samba</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scp/" rel="tag">scp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/seaweedfs/" rel="tag">seaweedfs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sorted/" rel="tag">sorted</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/" rel="tag">spark</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sudo/" rel="tag">sudo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/supervisor/" rel="tag">supervisor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/systemtap/" rel="tag">systemtap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/time/" rel="tag">time</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/timeout/" rel="tag">timeout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tmux/" rel="tag">tmux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tn/" rel="tag">tn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tp/" rel="tag">tp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unittest/" rel="tag">unittest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/valine/" rel="tag">valine</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/waline/" rel="tag">waline</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/websocket/" rel="tag">websocket</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zip/" rel="tag">zip</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91/" rel="tag">云</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BF%9D%E9%99%A9/" rel="tag">保险</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A8%E9%93%BE%E8%B7%AF/" rel="tag">全链路</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BD%E6%95%B0/" rel="tag">函数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E6%94%AF%E7%AD%96%E7%95%A5/" rel="tag">分支策略</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="tag">单例模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E6%B5%8B/" rel="tag">单测</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%8B%E6%B5%8B/" rel="tag">压测</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E5%8F%B0/" rel="tag">后台</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E5%8F%B0%E5%85%B3%E7%B3%BB/" rel="tag">后台关系</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/" rel="tag">域名解析</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%B4%E6%96%87%E4%BB%B6/" rel="tag">头文件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%98%E5%82%A8/" rel="tag">存储</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" rel="tag">性能分析</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag">性能测试</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" rel="tag">持续集成</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">排序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%92%E4%BB%B6/" rel="tag">插件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%99%E7%A8%8B/" rel="tag">教程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/" rel="tag">斐波那契数列</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E6%9C%9F/" rel="tag">日期</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%B6%E9%97%B4/" rel="tag">时间</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%81%AB%E7%84%B0%E5%9B%BE/" rel="tag">火焰图</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%B5%E5%BD%B1/" rel="tag">电影</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/" rel="tag">百度网盘</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%91%E6%8E%A7/" rel="tag">监控</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%A9%E9%98%B5/" rel="tag">矩阵</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83/" rel="tag">网络环境</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" rel="tag">自动驾驶</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A1%8C%E6%94%BF%E5%8C%BA/" rel="tag">行政区</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%8D%E4%BA%91/" rel="tag">词云</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%AD%E6%B3%95%E7%B3%96/" rel="tag">语法糖</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B1%86%E7%93%A3/" rel="tag">豆瓣</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" rel="tag">责任链模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%92%E5%BD%92/" rel="tag">递归</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%81%93%E6%A0%BC%E6%8B%89%E6%96%AF/" rel="tag">道格拉斯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%97%AD%E5%8C%85/" rel="tag">闭包</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/AI%E8%AF%84%E6%B5%8B/" style="font-size: 13px;">AI评测</a> <a href="/tags/C/" style="font-size: 13.29px;">C++</a> <a href="/tags/CI/" style="font-size: 13px;">CI</a> <a href="/tags/Conan/" style="font-size: 13px;">Conan</a> <a href="/tags/Derrick/" style="font-size: 13px;">Derrick</a> <a href="/tags/Devops/" style="font-size: 13px;">Devops</a> <a href="/tags/Go/" style="font-size: 13px;">Go</a> <a href="/tags/Grafana/" style="font-size: 13px;">Grafana</a> <a href="/tags/HTML/" style="font-size: 13px;">HTML</a> <a href="/tags/Hexo/" style="font-size: 13px;">Hexo</a> <a href="/tags/IaaS/" style="font-size: 13.29px;">IaaS</a> <a href="/tags/Iaas/" style="font-size: 13.14px;">Iaas</a> <a href="/tags/Jenkins/" style="font-size: 13.14px;">Jenkins</a> <a href="/tags/Prometheus/" style="font-size: 13px;">Prometheus</a> <a href="/tags/Python/" style="font-size: 13.14px;">Python</a> <a href="/tags/QPS/" style="font-size: 13px;">QPS</a> <a href="/tags/TPS/" style="font-size: 13px;">TPS</a> <a href="/tags/UI%E8%87%AA%E5%8A%A8%E5%8C%96/" style="font-size: 13px;">UI自动化</a> <a href="/tags/Ubuntu/" style="font-size: 13px;">Ubuntu</a> <a href="/tags/aio/" style="font-size: 13px;">aio</a> <a href="/tags/airtest/" style="font-size: 13px;">airtest</a> <a href="/tags/bio/" style="font-size: 13px;">bio</a> <a href="/tags/bootstrap/" style="font-size: 13px;">bootstrap</a> <a href="/tags/broker/" style="font-size: 13px;">broker</a> <a href="/tags/buffer/" style="font-size: 13px;">buffer</a> <a href="/tags/c/" style="font-size: 13.14px;">c++</a> <a href="/tags/cached/" style="font-size: 13px;">cached</a> <a href="/tags/celery/" style="font-size: 13px;">celery</a> <a href="/tags/cmake/" style="font-size: 13px;">cmake</a> <a href="/tags/cnpm/" style="font-size: 13px;">cnpm</a> <a href="/tags/consumer/" style="font-size: 13px;">consumer</a> <a href="/tags/date/" style="font-size: 13px;">date</a> <a href="/tags/datetime/" style="font-size: 13px;">datetime</a> <a href="/tags/describe/" style="font-size: 13px;">describe</a> <a href="/tags/dict/" style="font-size: 13px;">dict</a> <a href="/tags/docker/" style="font-size: 13px;">docker</a> <a href="/tags/element-ui/" style="font-size: 13px;">element ui</a> <a href="/tags/flask/" style="font-size: 13px;">flask</a> <a href="/tags/fn/" style="font-size: 13px;">fn</a> <a href="/tags/fp/" style="font-size: 13px;">fp</a> <a href="/tags/free/" style="font-size: 13px;">free</a> <a href="/tags/geojson/" style="font-size: 13px;">geojson</a> <a href="/tags/git/" style="font-size: 13px;">git</a> <a href="/tags/github/" style="font-size: 13px;">github</a> <a href="/tags/github-pages/" style="font-size: 13px;">github pages</a> <a href="/tags/go/" style="font-size: 13px;">go</a> <a href="/tags/gunicorn/" style="font-size: 13px;">gunicorn</a> <a href="/tags/hadoop/" style="font-size: 13px;">hadoop</a> <a href="/tags/hexo/" style="font-size: 13.43px;">hexo</a> <a href="/tags/http/" style="font-size: 13px;">http</a> <a href="/tags/ios/" style="font-size: 13px;">ios</a> <a href="/tags/jdk/" style="font-size: 13px;">jdk</a> <a href="/tags/jmeter/" style="font-size: 13.29px;">jmeter</a> <a href="/tags/jre/" style="font-size: 13px;">jre</a> <a href="/tags/json/" style="font-size: 13px;">json</a> <a href="/tags/jupyter-notebook/" style="font-size: 13px;">jupyter notebook</a> <a href="/tags/k6/" style="font-size: 13px;">k6</a> <a href="/tags/kafka/" style="font-size: 13.14px;">kafka</a> <a href="/tags/kafka-topic-sh/" style="font-size: 13px;">kafka-topic.sh</a> <a href="/tags/lambda/" style="font-size: 13.14px;">lambda</a> <a href="/tags/laravel/" style="font-size: 13px;">laravel</a> <a href="/tags/linux/" style="font-size: 13.86px;">linux</a> <a href="/tags/list/" style="font-size: 13px;">list</a> <a href="/tags/locust/" style="font-size: 13.14px;">locust</a> <a href="/tags/makefile/" style="font-size: 13px;">makefile</a> <a href="/tags/metaclass/" style="font-size: 13px;">metaclass</a> <a href="/tags/mfs/" style="font-size: 13px;">mfs</a> <a href="/tags/mysql/" style="font-size: 13px;">mysql</a> <a href="/tags/next/" style="font-size: 13.14px;">next</a> <a href="/tags/nio/" style="font-size: 13px;">nio</a> <a href="/tags/nmake/" style="font-size: 13px;">nmake</a> <a href="/tags/npm/" style="font-size: 13px;">npm</a> <a href="/tags/paramiko/" style="font-size: 13px;">paramiko</a> <a href="/tags/partition/" style="font-size: 13.14px;">partition</a> <a href="/tags/pdf/" style="font-size: 13px;">pdf</a> <a href="/tags/perf/" style="font-size: 13px;">perf</a> <a href="/tags/php/" style="font-size: 13px;">php</a> <a href="/tags/php5-fpm/" style="font-size: 13px;">php5-fpm</a> <a href="/tags/php7-fpm/" style="font-size: 13px;">php7-fpm</a> <a href="/tags/pip/" style="font-size: 13px;">pip</a> <a href="/tags/pytest/" style="font-size: 13px;">pytest</a> <a href="/tags/python/" style="font-size: 14px;">python</a> <a href="/tags/pythonic/" style="font-size: 13px;">pythonic</a> <a href="/tags/qgis/" style="font-size: 13px;">qgis</a> <a href="/tags/re/" style="font-size: 13px;">re</a> <a href="/tags/replica/" style="font-size: 13.14px;">replica</a> <a href="/tags/roc/" style="font-size: 13px;">roc</a> <a href="/tags/samba/" style="font-size: 13px;">samba</a> <a href="/tags/scp/" style="font-size: 13px;">scp</a> <a href="/tags/seaweedfs/" style="font-size: 13px;">seaweedfs</a> <a href="/tags/sorted/" style="font-size: 13px;">sorted</a> <a href="/tags/spark/" style="font-size: 13.57px;">spark</a> <a href="/tags/ssh/" style="font-size: 13.14px;">ssh</a> <a href="/tags/sudo/" style="font-size: 13px;">sudo</a> <a href="/tags/supervisor/" style="font-size: 13px;">supervisor</a> <a href="/tags/systemtap/" style="font-size: 13px;">systemtap</a> <a href="/tags/time/" style="font-size: 13px;">time</a> <a href="/tags/timeout/" style="font-size: 13px;">timeout</a> <a href="/tags/tmux/" style="font-size: 13px;">tmux</a> <a href="/tags/tn/" style="font-size: 13px;">tn</a> <a href="/tags/tp/" style="font-size: 13px;">tp</a> <a href="/tags/ubuntu/" style="font-size: 13.29px;">ubuntu</a> <a href="/tags/unittest/" style="font-size: 13px;">unittest</a> <a href="/tags/valine/" style="font-size: 13.14px;">valine</a> <a href="/tags/vue/" style="font-size: 13px;">vue</a> <a href="/tags/waline/" style="font-size: 13px;">waline</a> <a href="/tags/websocket/" style="font-size: 13px;">websocket</a> <a href="/tags/zip/" style="font-size: 13px;">zip</a> <a href="/tags/%E4%BA%91/" style="font-size: 13px;">云</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 13px;">人工智能</a> <a href="/tags/%E4%BF%9D%E9%99%A9/" style="font-size: 13px;">保险</a> <a href="/tags/%E5%85%A8%E9%93%BE%E8%B7%AF/" style="font-size: 13px;">全链路</a> <a href="/tags/%E5%87%BD%E6%95%B0/" style="font-size: 13px;">函数</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 13.29px;">分布式</a> <a href="/tags/%E5%88%86%E6%94%AF%E7%AD%96%E7%95%A5/" style="font-size: 13px;">分支策略</a> <a href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" style="font-size: 13px;">单例模式</a> <a href="/tags/%E5%8D%95%E6%B5%8B/" style="font-size: 13.29px;">单测</a> <a href="/tags/%E5%8E%8B%E6%B5%8B/" style="font-size: 13.14px;">压测</a> <a href="/tags/%E5%90%8E%E5%8F%B0/" style="font-size: 13px;">后台</a> <a href="/tags/%E5%90%8E%E5%8F%B0%E5%85%B3%E7%B3%BB/" style="font-size: 13px;">后台关系</a> <a href="/tags/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/" style="font-size: 13px;">域名解析</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 13.71px;">大数据</a> <a href="/tags/%E5%A4%B4%E6%96%87%E4%BB%B6/" style="font-size: 13px;">头文件</a> <a href="/tags/%E5%AD%98%E5%82%A8/" style="font-size: 13px;">存储</a> <a href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" style="font-size: 13px;">性能分析</a> <a href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" style="font-size: 13.86px;">性能测试</a> <a href="/tags/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" style="font-size: 13.14px;">持续集成</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 13px;">排序</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 13px;">插件</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 13px;">教程</a> <a href="/tags/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/" style="font-size: 13px;">斐波那契数列</a> <a href="/tags/%E6%97%A5%E6%9C%9F/" style="font-size: 13px;">日期</a> <a href="/tags/%E6%97%B6%E9%97%B4/" style="font-size: 13px;">时间</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 13.43px;">测试</a> <a href="/tags/%E7%81%AB%E7%84%B0%E5%9B%BE/" style="font-size: 13px;">火焰图</a> <a href="/tags/%E7%94%B5%E5%BD%B1/" style="font-size: 13px;">电影</a> <a href="/tags/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/" style="font-size: 13px;">百度网盘</a> <a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 13px;">监控</a> <a href="/tags/%E7%9F%A9%E9%98%B5/" style="font-size: 13px;">矩阵</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13px;">算法</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83/" style="font-size: 13px;">网络环境</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" style="font-size: 13.29px;">自动驾驶</a> <a href="/tags/%E8%A1%8C%E6%94%BF%E5%8C%BA/" style="font-size: 13px;">行政区</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 13.14px;">设计模式</a> <a href="/tags/%E8%AF%8D%E4%BA%91/" style="font-size: 13px;">词云</a> <a href="/tags/%E8%AF%AD%E6%B3%95%E7%B3%96/" style="font-size: 13px;">语法糖</a> <a href="/tags/%E8%B1%86%E7%93%A3/" style="font-size: 13px;">豆瓣</a> <a href="/tags/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" style="font-size: 13px;">责任链模式</a> <a href="/tags/%E9%80%92%E5%BD%92/" style="font-size: 13px;">递归</a> <a href="/tags/%E9%81%93%E6%A0%BC%E6%8B%89%E6%96%AF/" style="font-size: 13px;">道格拉斯</a> <a href="/tags/%E9%97%AD%E5%8C%85/" style="font-size: 13px;">闭包</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">22</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Hexo/">Hexo</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/20/Hexo-%E6%9B%B4%E6%8D%A2valine%E8%AF%84%E8%AE%BA%E5%88%B0waline/" class="title">Hexo-更换valine评论到waline</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-20T05:51:24.000Z" itemprop="datePublished">2022-11-20</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Hexo/">Hexo</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/20/Hexo-%E8%A7%A3%E5%86%B3Valine%E8%AF%84%E8%AE%BA%E4%B8%8D%E6%98%BE%E7%A4%BA%E7%9A%84%E9%97%AE%E9%A2%98/" class="title">Hexo-解决Valine评论不显示的问题</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-20T05:27:32.000Z" itemprop="datePublished">2022-11-20</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/11/19/ToB%E4%B8%9A%E5%8A%A1%E7%90%86%E8%A7%A3/" class="title">ToB业务理解</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-19T06:16:47.000Z" itemprop="datePublished">2022-11-19</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/15/%E5%8E%8B%E6%B5%8B-%E5%9F%BA%E4%BA%8EK6%E7%9A%84web%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%92%8C%E5%AE%9E%E6%97%B6%E7%9B%91%E6%8E%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="title">压测-基于K6的web性能测试和实时监控解决方案</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-15T08:38:42.000Z" itemprop="datePublished">2022-11-15</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/14/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6-GeoJson%E5%AD%A6%E4%B9%A0/" class="title">自动驾驶-GeoJson学习</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-14T08:50:42.000Z" itemprop="datePublished">2022-11-14</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
  <aside class="sidebar sidebar-toc collapse   in  " id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E7%94%9F%E6%80%81"><span class="toc-number">2.</span> <span class="toc-text">整体生态</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E6%A0%87%E6%9A%B4%E9%9C%B2"><span class="toc-number">2.1.</span> <span class="toc-text">指标暴露</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E6%A0%87%E6%8A%93%E5%8F%96"><span class="toc-number">2.2.</span> <span class="toc-text">指标抓取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E6%A0%87%E5%AD%98%E5%82%A8%E5%92%8C%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.3.</span> <span class="toc-text">指标存储和查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6"><span class="toc-number">2.4.</span> <span class="toc-text">监控告警</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C"><span class="toc-number">3.1.</span> <span class="toc-text">服务注册</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%9B%B4%E6%96%B0"><span class="toc-number">3.2.</span> <span class="toc-text">配置更新</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E6%A0%87%E6%8A%93%E5%8F%96%E5%92%8C%E5%AD%98%E5%82%A8"><span class="toc-number">3.3.</span> <span class="toc-text">指标抓取和存储</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Metric%E6%8C%87%E6%A0%87"><span class="toc-number">4.</span> <span class="toc-text">Metric指标</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.1.</span> <span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E6%A0%87%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.2.</span> <span class="toc-text">指标类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E6%A0%87%E5%AF%BC%E5%87%BA"><span class="toc-number">4.3.</span> <span class="toc-text">指标导出</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PromQL"><span class="toc-number">5.</span> <span class="toc-text">PromQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9E%AC%E6%97%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.1.</span> <span class="toc-text">瞬时查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.</span> <span class="toc-text">范围查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="toc-number">5.3.</span> <span class="toc-text">内置函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Grafana%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">6.</span> <span class="toc-text">Grafana可视化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6-1"><span class="toc-number">7.</span> <span class="toc-text">监控告警</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">8.</span> <span class="toc-text">参考文献</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-监控-Prometheus-Grafana实战" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      监控-Prometheus+Grafana实战
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2022/11/09/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/" class="article-date">
	  <time datetime="2022-11-09T03:46:47.000Z" itemprop="datePublished">2022-11-09</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/Grafana/" rel="tag">Grafana</a>, <a class="article-tag-link-link" href="/tags/Prometheus/" rel="tag">Prometheus</a>, <a class="article-tag-link-link" href="/tags/%E7%9B%91%E6%8E%A7/" rel="tag">监控</a>
  </span>


        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


	<span class="article-read hidden-xs">
    	<i class="icon icon-eye-fill" aria-hidden="true"></i>
    	<span id="/2022/11/09/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/" class="leancloud_visitors"  data-flag-title="监控-Prometheus+Grafana实战">
			<span class="leancloud-visitors-count">0</span>
		</span>
    </span>

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2022/11/09/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 5.9k(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 23(分)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>本文介绍了如何使用Prometheus+Grafana这个监控解决方案。</p>
<span id="more"></span>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Prometheus是古希腊神话里泰坦族的一名神明，名字的意思是”先见之明”，下图中是Prometheus被宙斯惩罚，饱受肝脏日食夜长之苦。<br>下面就是我们所了解的Prometheus，下面是其官网封面图引导语：From metrics to insight，从指标到洞察力，通过指标去洞察你的系统，为我们的系统提供指标收集和监控的开源解决方案。也就是说，Prometheus是一个数据监控的解决方案，让我们能随时掌握系统运行的状态，快速定位问题和排除故障。<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img.png"></p>
<p>Prometheus发展速度很快，12年开发完成，16年加入CNCF，成为继K8s之后第二个CNCF托管的项目，目前Github 42k的🌟，而且社区很活跃，维护频率很高，基本稳定在 1个月1个小版本的迭代速度</p>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_1.png"></p>
<h1 id="整体生态"><a href="#整体生态" class="headerlink" title="整体生态"></a>整体生态</h1><p>Prometheus提供了从指标暴露，到指标抓取、存储和可视化，以及最后的监控告警等一系列组件。<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_2.png"></p>
<h2 id="指标暴露"><a href="#指标暴露" class="headerlink" title="指标暴露"></a>指标暴露</h2><p>每一个被Prometheus监控的服务都是一个Job，Prometheus为这些Job提供了官方的SDK ，利用这个SDK可以自定义并导出自己的业务指标，也可以使用Prometheus官方提供的各种常用组件和中间件的Exporter（比如常用的MySQL，Consul等等）。对于短时间执行的脚本任务或者不好直接Pull指标的服务，Prometheus提供了PushGateWay网关给这些任务将服务指标主动推Push到网关，Prometheus再从这个网关里Pull指标。</p>
<h2 id="指标抓取"><a href="#指标抓取" class="headerlink" title="指标抓取"></a>指标抓取</h2><p>上面提到了Push和Pull，其实这是两种指标抓取模型。</p>
<ul>
<li>Pull模型：监控服务主动拉取被监控服务的指标，被监控服务一般通过主动暴露metrics端口或者通过Exporter的方式暴露指标，监控服务依赖服务发现模块发现被监控服务，从而去定期的抓取指标<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_3.png"></li>
<li>Push模型：被监控服务主动将指标推送到监控服务，可能需要对指标做协议适配，必须得符合监控服务要求的指标格式，对于Prometheus中的指标抓取，采用的是Pull模型，默认是一分钟去拉取一次指标，通过Prometheus.yaml配置文件中的scrape_interval配置项配置，Prometheus对外都是用的Pull模型，一个是Pull Exporter的暴露的指标，一个是Pull PushGateway暴露的指标。<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_4.png"></li>
</ul>
<h2 id="指标存储和查询"><a href="#指标存储和查询" class="headerlink" title="指标存储和查询"></a>指标存储和查询</h2><p>指标抓取后会存储在内置的时序数据库中，Prometheus也提供了PromQL查询语言给我们做指标的查询，我们可以在Prometheus的WebUI上通过PromQL，可视化查询我们的指标，也可以很方便的接入第三方的可视化工具，例如grafana。</p>
<h2 id="监控告警"><a href="#监控告警" class="headerlink" title="监控告警"></a>监控告警</h2><p>prometheus提供了alertmanageer基于promql来做系统的监控告警，当promql查询出来的指标超过我们定义的阈值时，prometheus会发送一条告警信息到alertmanager，manager会将告警下发到配置好的邮箱或者微信。</p>
<h1 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h1><p>Prometheus的从被监控服务的注册到指标抓取到指标查询的流程分为五个步骤：<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_5.png"></p>
<h2 id="服务注册"><a href="#服务注册" class="headerlink" title="服务注册"></a>服务注册</h2><p>被监控服务在Prometheus中是一个Job存在，被监控服务的所有实例在Prometheus中是一个target的存在，所以被监控服务的注册就是在Prometheus中注册一个Job和其所有的target，这个注册分为：</p>
<ul>
<li>静态注册</li>
<li>动态注册<br>静态注册：静态的将服务的IP和抓取指标的端口号配置在Prometheus yaml文件的scrape_configs配置下<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scrape_configs:</span><br><span class="line">- job_name: &quot;prometheus&quot;</span><br><span class="line">  static_configs:</span><br><span class="line">  - targets: [&quot;localhost:9090&quot;]</span><br></pre></td></tr></table></figure></li>
</ul>
<p>以上就是注册了一个名为prometheus的服务，这个服务下有一个实例，暴露的抓取地址是localhost:9090 动态注册：动态注册就是在Prometheus yaml文件的scrape_configs配置下配置服务发现的地址和服务名，Prometheus会去该地址，根据你提供的服务名动态发现实例列表，在Prometheus中，支持consul，DNS，文件，K8s等多种服务发现机制。 基于consul的服务发现：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- job_name: &quot;node_export_consul&quot;</span><br><span class="line">  metrics_path: /node_metrics</span><br><span class="line">  scheme: http</span><br><span class="line">  consul_sd_configs:</span><br><span class="line">  - server: localhost:8500</span><br><span class="line">  services:</span><br><span class="line">  - node_exporter</span><br></pre></td></tr></table></figure>
<p>我们consul的地址就是：localhost:8500，服务名是node_exporter，在这个服务下有一个exporter实例： localhost:9600</p>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_6.png"></p>
<p>注意：如果是动态注册，最好加上这两配置，静态注册指标拉取的路径会默认的帮我们指定为 metrics_path:&#x2F;metrics，所以如果暴露的指标抓取路径不同或者是动态的服务注册，最好加上这两个配置。不然会报错“INVALID“ is not a valid start token，演示下，百度了一下，这里可能是数据格式不统一导致</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">metrics_path: /node_metrics</span><br><span class="line">scheme: http</span><br></pre></td></tr></table></figure>

<p>最后可以在webUI中查看发现的实例：<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_7.png"><br>目前，Prometheus支持多达二十多种服务发现协议：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;azure_sd_config&gt;</span><br><span class="line">&lt;consul_sd_config&gt;</span><br><span class="line">&lt;digitalocean_sd_config&gt;</span><br><span class="line">&lt;docker_sd_config&gt;</span><br><span class="line">&lt;dockerswarm_sd_config&gt;</span><br><span class="line">&lt;dns_sd_config&gt;</span><br><span class="line">&lt;ec2_sd_config&gt;</span><br><span class="line">&lt;openstack_sd_config&gt;</span><br><span class="line">&lt;file_sd_config&gt;</span><br><span class="line">&lt;gce_sd_config&gt;</span><br><span class="line">&lt;hetzner_sd_config&gt;</span><br><span class="line">&lt;http_sd_config&gt;</span><br><span class="line">&lt;kubernetes_sd_config&gt;</span><br><span class="line">&lt;kuma_sd_config&gt;</span><br><span class="line">&lt;lightsail_sd_config&gt;</span><br><span class="line">&lt;linode_sd_config&gt;</span><br><span class="line">&lt;marathon_sd_config&gt;</span><br><span class="line">&lt;nerve_sd_config&gt;</span><br><span class="line">&lt;serverset_sd_config&gt;</span><br><span class="line">&lt;triton_sd_config&gt;</span><br><span class="line">&lt;eureka_sd_config&gt;</span><br><span class="line">&lt;scaleway_sd_config&gt;</span><br><span class="line">&lt;static_config&gt;</span><br></pre></td></tr></table></figure>

<h2 id="配置更新"><a href="#配置更新" class="headerlink" title="配置更新"></a>配置更新</h2><p>在更新完Prometheus的配置文件后，我们需要更新我们的配置到程序内存里，这里的更新方式有两种，第一种简单粗暴，就是重启Prometheus，第二种是动态更新的方式。如何实现动态的更新Prometheus配置。<br>第一步：首先要保证启动Prometheus的时候带上启动参数：–web.enable-lifecycle</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">prometheus --config.file=/usr/local/etc/prometheus.yml --web.enable-lifecycle</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第二步：去更新我们的Prometheus配置 第三步：更新完配置后，我们可以通过Post请求的方式，动态更新配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -v --request POST &#x27;http://localhost:9090/-/reload&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>原理： Prometheus在web模块中，注册了一个handler</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if o.EnableLifecycle &#123;</span><br><span class="line">   router.Post(&quot;/-/quit&quot;, h.quit)</span><br><span class="line">   router.Put(&quot;/-/quit&quot;, h.quit)</span><br><span class="line">   router.Post(&quot;/-/reload&quot;, h.reload)  // reload配置</span><br><span class="line">   router.Put(&quot;/-/reload&quot;, h.reload)   </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>通过h.reload这个handler方法实现：这个handler就是往一个channle中发送一个信号：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func (h *Handler) reload(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class="line">   rc := make(chan error)</span><br><span class="line">   h.reloadCh &lt;- rc    // 发送一个信号到channe了中</span><br><span class="line">   if err := &lt;-rc; err != nil &#123;</span><br><span class="line">      http.Error(w, fmt.Sprintf(&quot;failed to reload config: %s&quot;, err), http.StatusInternalServerError)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在main函数中会去监听这个channel，只要有监听到信号，就会做配置的reload，重新将新配置加载到内存中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">case rc := &lt;-webHandler.Reload():</span><br><span class="line">   if err := reloadConfig(cfg.configFile, cfg.enableExpandExternalLabels, cfg.tsdb.EnableExemplarStorage, logger, noStepSubqueryInterval, reloaders...); err != nil &#123;</span><br><span class="line">      level.Error(logger).Log(&quot;msg&quot;, &quot;Error reloading config&quot;, &quot;err&quot;, err)</span><br><span class="line">      rc &lt;- err</span><br><span class="line">   &#125; else &#123;</span><br><span class="line">      rc &lt;- nil</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="指标抓取和存储"><a href="#指标抓取和存储" class="headerlink" title="指标抓取和存储"></a>指标抓取和存储</h2><p>Prometheus对指标的抓取采取主动Pull的方式，即周期性的请求被监控服务暴露的metrics接口或者是PushGateway，从而获取到Metrics指标，默认时间是15s抓取一次，配置项如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">global:</span><br><span class="line"> scrape_interval: 15s</span><br></pre></td></tr></table></figure>

<p>抓取到的指标会被以时间序列的形式保存在内存中，并且定时刷到磁盘上，默认是两个小时回刷一次。并且为了防止Prometheus 发生崩溃或重启时能够恢复数据，Prometheus也提供了类似MySQL中binlog一样的预写日志，当Prometheus崩溃重启时，会读这个预写日志来恢复数据。</p>
<h1 id="Metric指标"><a href="#Metric指标" class="headerlink" title="Metric指标"></a>Metric指标</h1><h2 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h2><p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_8.png"><br>Prometheus采集的所有指标都是以时间序列的形式进行存储，每一个时间序列有三部分组成：</p>
<ul>
<li>指标名和指标标签集合：metric_name{&lt;label1&#x3D;v1&gt;,&lt;label2&#x3D;v2&gt;….}，指标名：表示这个指标是监控哪一方面的状态，比如http_request_total表示：请求数量；指标标签，描述这个指标有哪些维度，比如http_request_total这个指标，有请求状态码code &#x3D; 200&#x2F;400&#x2F;500，请求方式：method &#x3D; get&#x2F;post等，实际上指标名称实际上是以标签的形式保存，这个标签是__name__，即：<strong>name</strong>&#x3D;<metric name></metric></li>
<li>时间戳：描述当前时间序列的时间，单位：毫秒</li>
<li>样本值：当前监控指标的具体数值，比如http_request_total的值就是请求数是多少。</li>
</ul>
<p>可以通过查看Prometheus的metrics接口查看所有上报的指标:<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_9.png"></p>
<p>所有的指标也都是通过如下所示的格式来标识的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HELP    // HELP：这里描述的指标的信息，表示这个是一个什么指标，统计什么的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TYPE    // TYPE：这个指标是什么类型的</span></span><br><span class="line">&lt;metric name&gt;&#123;&lt;label name&gt;=&lt;label value&gt;, ...&#125;  value    // 指标的具体格式,&lt;指标名&gt;&#123;标签集合&#125; 指标值</span><br></pre></td></tr></table></figure>

<h2 id="指标类型"><a href="#指标类型" class="headerlink" title="指标类型"></a>指标类型</h2><p>Prometheus底层存储上其实并没有对指标做类型的区分，都是以时间序列的形式存储，但是为了方便用户的使用和理解不同监控指标之间的差异，Prometheus 定义了 4 种不同的指标类型：计数器counter，仪表盘gauge，直方图histogram，摘要summary<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_10.png"></p>
<p>Counter计数器： Counter类型和redis的自增命令一样，只增不减，通过Counter指标可以统计Http请求数量，请求错误数，接口调用次数等单调递增的数据。同时可以结合increase和rate等函数统计变化速率，后续我们会提到这些内置函数。<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_11.png"></p>
<p>Gauge仪表盘： 和Counter不同，Gauge是可增可减的，可以反映一些动态变化的数据，例如当前内存占用，CPU利用，Gc次数等动态可上升可下降的数据，在Prometheus上通过Gauge，可以不用经过内置函数直观的反映数据的变化情况，如下图表示堆可分配的空间大小：  上面两种是数值指标，代表数据的变化情况，Histogram和Summary是统计类型的指标，表示数据的分布情况 Histogram直方图： Histogram是一种直方图类型，可以观察到指标在各个不同的区间范围的分布情况，如下图所示：可以观察到请求耗时在各个桶的分布<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_12.png"></p>
<p>有一点要注意的是，Histogram是累计直方图，即每一个桶的是只有上区间，例如下图表示小于0.1毫秒（le&#x3D;”0.1”）的请求数量是18173个，小于0.2毫秒（le&#x3D;”0.2”）的请求是18182个，在le&#x3D;”0.2”这个桶中是包含了le&#x3D;”0.1”这个桶的数据，如果我们要拿到0.1毫秒到0.2毫秒的请求数量，可以通过两个桶想减得到。<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_13.png"></p>
<p>在直方图中，还可以通过histogram_quantile函数求出百分位数，比如P50，P90，P99等数据</p>
<p>Summary摘要 Summary也是用来做统计分析的，和Histogram区别在于，Summary直接存储的就是百分位数，如下所示：可以直观的观察到样本的中位数，P90和P99<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_14.png"></p>
<p>Summary的百分位数是客户端计算好直接让Prometheus抓取的，不需要Prometheus计算，直方图是通过内置函数histogram_quantile在Prometheus服务端计算求出</p>
<h2 id="指标导出"><a href="#指标导出" class="headerlink" title="指标导出"></a>指标导出</h2><p>指标导出有两种方式，一种是使用Prometheus社区提供的定制好的Exporter对一些组件诸如MySQL，Kafka等的指标作导出，也可以利用社区提供的Client来自定义指标导出。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">github.com/prometheus/client_golang/prometheus/promhttp</span><br></pre></td></tr></table></figure>

<p>自定义Prometheus exporter：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">   &quot;net/http&quot;</span><br><span class="line"></span><br><span class="line">   &quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main()  &#123;</span><br><span class="line">   http.Handle(&quot;/metrics&quot;, promhttp.Handler())</span><br><span class="line">   http.ListenAndServe(&quot;:8080&quot;, nil)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问：<a href="http://localhost:8080/metrics%EF%BC%8C%E5%8D%B3%E5%8F%AF%E7%9C%8B%E5%88%B0%E5%AF%BC%E5%87%BA%E7%9A%84%E6%8C%87%E6%A0%87%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E6%B2%A1%E6%9C%89%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BB%BB%E4%BD%95%E7%9A%84%E6%8C%87%E6%A0%87%EF%BC%8C%E4%BD%86%E6%98%AF%E8%83%BD%E7%9C%8B%E5%88%B0%E4%B8%80%E4%BA%9B%E5%86%85%E7%BD%AE%E7%9A%84Go%E7%9A%84%E8%BF%90%E8%A1%8C%E6%97%B6%E6%8C%87%E6%A0%87%E5%92%8Cpromhttp%E7%9B%B8%E5%85%B3%E7%9A%84%E6%8C%87%E6%A0%87%EF%BC%8C%E8%BF%99%E4%B8%AAClient%E9%BB%98%E8%AE%A4%E4%B8%BA%E6%88%91%E4%BB%AC%E6%9A%B4%E9%9C%B2%E7%9A%84%E6%8C%87%E6%A0%87%EF%BC%8Cgo_%EF%BC%9A%E4%BB%A5">http://localhost:8080/metrics，即可看到导出的指标，这里我们没有自定义任何的指标，但是能看到一些内置的Go的运行时指标和promhttp相关的指标，这个Client默认为我们暴露的指标，go_：以</a> go_ 为前缀的指标是关于 Go 运行时相关的指标，比如垃圾回收时间、goroutine 数量等，这些都是 Go 客户端库特有的，其他语言的客户端库可能会暴露各自语言的其他运行时指标。promhttp_：来自 promhttp 工具包的相关指标，用于跟踪对指标请求的处理。</p>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_15.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">   &quot;net/http&quot;</span><br><span class="line"></span><br><span class="line">   &quot;github.com/prometheus/client_golang/prometheus&quot;</span><br><span class="line">   &quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line"></span><br><span class="line">   // 1.定义指标(类型,名字,帮助信息)</span><br><span class="line">   myCounter := prometheus.NewCounter(prometheus.CounterOpts&#123;</span><br><span class="line">      Name: &quot;my_counter_total&quot;,</span><br><span class="line">      Help: &quot;自定义counter&quot;,</span><br><span class="line">   &#125;)</span><br><span class="line">   // 2.注册指标</span><br><span class="line">   prometheus.MustRegister(myCounter)</span><br><span class="line">   // 3.设置指标值</span><br><span class="line">   myCounter.Add(23)</span><br><span class="line"></span><br><span class="line">   http.Handle(&quot;/metrics&quot;, promhttp.Handler())</span><br><span class="line">   http.ListenAndServe(&quot;:8080&quot;, nil)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行：<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_16.png"></p>
<p>模拟下在业务中上报接口请求量</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">   &quot;fmt&quot;</span><br><span class="line">   &quot;net/http&quot;</span><br><span class="line"></span><br><span class="line">   &quot;github.com/prometheus/client_golang/prometheus&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var (</span><br><span class="line">   MyCounter prometheus.Counter</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// init 注册指标</span><br><span class="line">func init() &#123;</span><br><span class="line">   // 1.定义指标（类型，名字，帮助信息）</span><br><span class="line">   MyCounter = prometheus.NewCounter(prometheus.CounterOpts&#123;</span><br><span class="line">      Name: &quot;my_counter_total&quot;,</span><br><span class="line">      Help: &quot;自定义counter&quot;,</span><br><span class="line">   &#125;)</span><br><span class="line">   // 2.注册指标</span><br><span class="line">   prometheus.MustRegister(MyCounter)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Sayhello</span><br><span class="line">func Sayhello(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class="line">   // 接口请求量递增</span><br><span class="line">   MyCounter.Inc()</span><br><span class="line">   fmt.Fprintf(w, &quot;Hello Wrold!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main.go：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">   &quot;net/http&quot;</span><br><span class="line"></span><br><span class="line">   &quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line"></span><br><span class="line">   http.Handle(&quot;/metrics&quot;, promhttp.Handler())</span><br><span class="line">   http.HandleFunc(&quot;/counter&quot;,Sayhello)</span><br><span class="line">   http.ListenAndServe(&quot;:8080&quot;, nil)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一开始启动时，指标counter是0<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_17.png"></p>
<p>调用：&#x2F;counter接口后，指标数据发生了变化，这样就可以简单实现了接口请求数的统计<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_18.png"></p>
<p>对于其他指标定义方式是一样的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">var (</span><br><span class="line">   MyCounter prometheus.Counter</span><br><span class="line">   MyGauge prometheus.Gauge</span><br><span class="line">   MyHistogram prometheus.Histogram</span><br><span class="line">   MySummary prometheus.Summary</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// init 注册指标</span><br><span class="line">func init() &#123;</span><br><span class="line">   // 1.定义指标（类型，名字，帮助信息）</span><br><span class="line">   MyCounter = prometheus.NewCounter(prometheus.CounterOpts&#123;</span><br><span class="line">      Name: &quot;my_counter_total&quot;,</span><br><span class="line">      Help: &quot;自定义counter&quot;,</span><br><span class="line">   &#125;)</span><br><span class="line">   // 定义gauge类型指标</span><br><span class="line">   MyGauge = prometheus.NewGauge(prometheus.GaugeOpts&#123;</span><br><span class="line">      Name: &quot;my_gauge_num&quot;,</span><br><span class="line">      Help: &quot;自定义gauge&quot;,</span><br><span class="line">   &#125;)</span><br><span class="line">   // 定义histogram</span><br><span class="line">   MyHistogram = prometheus.NewHistogram(prometheus.HistogramOpts&#123;</span><br><span class="line">      Name: &quot;my_histogram_bucket&quot;,</span><br><span class="line">      Help: &quot;自定义histogram&quot;,</span><br><span class="line">      Buckets: []float64&#123;0.1,0.2,0.3,0.4,0.5&#125;,   // 需要指定桶</span><br><span class="line">   &#125;)</span><br><span class="line">   // 定义Summary</span><br><span class="line">   MySummary = prometheus.NewSummary(prometheus.SummaryOpts&#123;</span><br><span class="line">      Name: &quot;my_summary_bucket&quot;,</span><br><span class="line">      Help: &quot;自定义summary&quot;,</span><br><span class="line">      // 这部分可以算好后在set</span><br><span class="line">      Objectives: map[float64]float64&#123;</span><br><span class="line">         0.5: 0.05,</span><br><span class="line">         0.9: 0.01,   </span><br><span class="line">         0.99: 0.001, </span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">   // 2.注册指标</span><br><span class="line">   prometheus.MustRegister(MyCounter)</span><br><span class="line">   prometheus.MustRegister(MyGauge)</span><br><span class="line">   prometheus.MustRegister(MyHistogram)</span><br><span class="line">   prometheus.MustRegister(MySummary)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_19.png"></p>
<p>上面的指标都是没有设置标签的，我们一般的指标都是带有标签的，如何设置指标的标签呢？ 如果我要设置带标签的counter类型指标，只需要将原来的NewCounter方法替换为NewCounterVec方法即可，并且传入标签集合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MyCounter *prometheus.CounterVec</span><br><span class="line">// 1.定义指标（类型，名字，帮助信息）</span><br><span class="line">MyCounter = prometheus.NewCounterVec(</span><br><span class="line">   prometheus.CounterOpts&#123;</span><br><span class="line">   Name: &quot;my_counter_total&quot;,</span><br><span class="line">   Help: &quot;自定义counter&quot;,</span><br><span class="line">   &#125;,</span><br><span class="line">   // 标签集合</span><br><span class="line">   []string&#123;&quot;label1&quot;,&quot;label2&quot;&#125;,</span><br><span class="line">)</span><br><span class="line">// 带标签的set指标值</span><br><span class="line">MyCounter.With(prometheus.Labels&#123;&quot;label1&quot;:&quot;1&quot;,&quot;label2&quot;:&quot;2&quot;&#125;).Inc()</span><br></pre></td></tr></table></figure>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_20.png"></p>
<p>其他同理</p>
<h1 id="PromQL"><a href="#PromQL" class="headerlink" title="PromQL"></a>PromQL</h1><p>刚刚提到了Prometheus中指标有哪些类型以及如何导出我们的指标，现在指标导出到Prometheus了，利用其提供的PromQL可以查询我们导出的指标 PromQL是Prometheus为我们提供的函数式的查询语言，查询表达式有四种类型：</p>
<ul>
<li>字符串：只作为某些内置函数的参数出现</li>
<li>标量：单一的数字值，可以是函数参数，也可以是函数的返回结果</li>
<li>瞬时向量：某一时刻的时序数据</li>
<li>区间向量：某一时间区间内的时序数据集合</li>
</ul>
<h2 id="瞬时查询"><a href="#瞬时查询" class="headerlink" title="瞬时查询"></a>瞬时查询</h2><p>直接通过指标名即可进行查询，查询结果是当前指标最新的时间序列，比如查询Gc累积消耗的时间：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go_gc_duration_seconds_count</span><br></pre></td></tr></table></figure>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_21.png"></p>
<p>我们可以看到查询出来有多个同名指标结果 可以用{}做标签过滤查询：比如我们想查指定实例的指标</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go_gc_duration_seconds_count&#123;instance=&quot;127.0.0.1:9600&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_22.png"></p>
<p>而且也支持则表达式，通过&#x3D;~指定正则表达式，如下所示：查询所有instance是localhost开头的指标</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go_gc_duration_seconds_count&#123;instance=~&quot;localhost.*&quot;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_23.png"></p>
<h2 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h2><p>范围查询的结果集就是区间向量，可以通过[]指定时间来做范围查询<br>查询5分钟内的Gc累积消耗时间</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go_gc_duration_seconds_count&#123;&#125;[5m]</span><br></pre></td></tr></table></figure>

<p>注意：这里范围查询第一个点并不一定精确到刚刚好5分钟前的那个时序样本点，他是以5分钟作为一个区间，寻找这个区间的第一个点到最后一个样本点。</p>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_24.png"></p>
<p>时间单位：<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_25.png"></p>
<p>d：天，h：小时，m：分钟，ms：毫秒，s：秒，w：周，y：年 同样支持类似SQL中的offset查询，如下：查询一天前当前5分钟前的时序数据集</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go_gc_duration_seconds_count&#123;&#125;[5m] offset 1d</span><br></pre></td></tr></table></figure>

<h2 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h2><p>Prometheus内置了很多函数，这里主要记录下常用的几个函数的使用： rate和irate函数： rate函数可以用来求指标的平均变化速率</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate函数=时间区间前后两个点的差 / 时间范围</span><br></pre></td></tr></table></figure>
<p>一般rate函数可以用来求某个时间区间内的请求速率，也就是我们常说的QPS<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_26.png"></p>
<p>但是rate函数只是算出来了某个时间区间内的平均速率，没办法反映突发变化，假设在一分钟的时间区间里，前50秒的请求量都是0到10左右，但是最后10秒的请求量暴增到100以上，这时候算出来的值可能无法很好的反映这个峰值变化。这个问题可以通过irate函数解决，irate函数求出来的就是瞬时变化率</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">时间区间内最后两个样本点的差 / 最后两个样本点的时间差</span><br></pre></td></tr></table></figure>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_27.png"></p>
<p>可以通过图像看下两者的区别：irate函数的图像峰值变化大，rate函数变化较为平缓 rate函数：<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_28.png"></p>
<p>irate函数：</p>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_29.png"></p>
<p>聚合函数：Sum() by() without() 也是上边的例子，我们在求指定接口的QPS的时候，可能会出现多个实例的QPS的计算结果，如下是存在多个接口，三个服务的QPS</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(demo_api_request_duration_seconds_count&#123;job=&quot;demo&quot;, method=&quot;GET&quot;, status=&quot;200&quot;&#125;[5m])</span><br></pre></td></tr></table></figure>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_30.png"></p>
<p>利用sum函数可以将三个QPS聚合，即可得到整个服务该接口的QPS：其实Sum就是将指标值做相加<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_31.png"></p>
<p>但是这样直接的相加太笼统抽象了，可以配合by和without函数在sum的时候，基于某些标签分组，类似SQL中的group by 例如，我可以根据请求接口标签分组：这样拿到的就是具体接口的QPS</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(rate(demo_api_request_duration_seconds_count&#123;job=&quot;demo&quot;, method=&quot;GET&quot;, status=&quot;200&quot;&#125;[5m])) by(path)</span><br></pre></td></tr></table></figure>

<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_32.png"></p>
<p>也可以不根据接口路径分组：通过without指定</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(rate(demo_api_request_duration_seconds_count&#123;job=&quot;demo&quot;, method=&quot;GET&quot;, status=&quot;200&quot;&#125;[5m])) without(path)</span><br></pre></td></tr></table></figure>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_33.png"></p>
<p>可以通过histogram_quantile函数做数据统计：可以用来统计百分位数：第一个参数是百分位，第二个histogram指标，这样计算出来的就是中位数，即P50</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">histogram_quantile(0.5,go_gc_pauses_seconds_total_bucket)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_34.png"></p>
<p>分享之前和同事一起发现的坑： 在刚刚写的自定义exporter上新增几个histogram的样本点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MyHistogram.Observe(0.3)</span><br><span class="line">MyHistogram.Observe(0.4)</span><br><span class="line">MyHistogram.Observe(0.5)</span><br></pre></td></tr></table></figure>

<p>histogram的桶设置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MyHistogram = prometheus.NewHistogram(prometheus.HistogramOpts&#123;</span><br><span class="line">   Name: &quot;my_histogram_bucket&quot;,</span><br><span class="line">   Help: &quot;自定义histogram&quot;,</span><br><span class="line">   Buckets: []float64&#123;0,2.5,5,7.5,10&#125;,    // 需要指定桶</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>如果这样的话，所有指标都会直接进入到第一个桶，即0到2.5这个桶，如果我要计算中位数，那么这个中位数按照数学公式来算的话，肯定是在0到2.5之间的，而且肯定是0.3到0.5之间。 我用histogram_quantile函数计算下：计算结果是1.25，其实已经不对了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">histogram_quantile(0.5,my_histogram_bucket_bucket) </span><br></pre></td></tr></table></figure>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_35.png"></p>
<p>我的指标都是不大于1的，为啥算出来的P50和P99都这么离谱呢？ 这是因为Prometheus他是不保存你具体的指标数值的，他会帮你把指标放到具体的桶，但是他不会保存你指标的值，计算的分位数是一个预估的值，怎么预估呢？就是假设每个桶内的样本分布是均匀的，线性分布来计算的，比如刚刚的P50，其实就是算排在第50%位置的样本值，因为刚刚所有的数据都落在了第一个桶，那么他在计算的时候就会假定这个50%值在第一个桶的中点，他就会假定这个数就是0.5 2.5，P99就是第一个桶的99%的位置，他就会假定这个数就是0.99 2.5 导致这个误差较大的原因就是我们的bucket设置的不合理。 重新定义桶：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 定义histogram</span><br><span class="line">MyHistogram = prometheus.NewHistogram(prometheus.HistogramOpts&#123;</span><br><span class="line">   Name: &quot;my_histogram_bucket&quot;,</span><br><span class="line">   Help: &quot;自定义histogram&quot;,</span><br><span class="line">   Buckets: []float64&#123;0.1,0.2,0.3,0.4,0.5&#125;,   // 需要指定桶</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>上报数据：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MyHistogram.Observe(0.1)</span><br><span class="line">MyHistogram.Observe(0.3)</span><br><span class="line">MyHistogram.Observe(0.4)</span><br></pre></td></tr></table></figure>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_36.png"></p>
<p>重新计算P50，P99<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_37.png"></p>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_38.png"></p>
<p>桶设置的越合理，计算的误差越小</p>
<h1 id="Grafana可视化"><a href="#Grafana可视化" class="headerlink" title="Grafana可视化"></a>Grafana可视化</h1><p>除了可以利用Prometheus提供的webUI可视化我们的指标外，还可以接入Grafana来做指标的可视化。<br>第一步，对接数据源：<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_39.png"></p>
<p>配置好prometheus的地址：</p>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_40.png"></p>
<p>第二步：创建仪表盘<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_41.png"></p>
<p>编辑仪表盘<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_42.png"></p>
<p>在metrics处编写PromQL即可完成查询和可视化<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_43.png"></p>
<p>仪表盘编辑完后，可以导出对应的json文件，方便下次导入同样的仪表盘</p>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_44.png"></p>
<p><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_45.png"></p>
<h1 id="监控告警-1"><a href="#监控告警-1" class="headerlink" title="监控告警"></a>监控告警</h1><p>AlertManager是prometheus提供的告警信息下发组件，包含了对告警信息的分组，下发，静默等策略 配置完成后可以在webui上看到对应的告警策略信息。告警规则也是基于PromQL进行定制的。 编写告警配置：当Http_srv这个服务挂了，Prometheus采集不到指标，并且持续时间1分钟，就会触发告警</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">groups:</span><br><span class="line">- name: simulator-alert-rule</span><br><span class="line">  rules:</span><br><span class="line">  - alert: HttpSimulatorDown</span><br><span class="line">    expr: sum(up&#123;job=&quot;http_srv&quot;&#125;) == 0 </span><br><span class="line">    for: 1m</span><br><span class="line">    labels:</span><br><span class="line">      severity: critical</span><br></pre></td></tr></table></figure>

<p>在prometheus.yml中配置告警配置文件，需要配置上alertmanager的地址和告警文件的地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Alertmanager configuration</span></span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">  - static_configs:</span><br><span class="line">    - targets: [&#x27;localhost:9093&#x27;]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Load rules once and periodically evaluate them according to the global <span class="string">&#x27;evaluation_interval&#x27;</span>.</span></span><br><span class="line">rule_files:</span><br><span class="line">    - &quot;alert_rules.yml&quot;</span><br><span class="line">    #- &quot;first_rules.yml&quot;</span><br></pre></td></tr></table></figure>

<p>配置告警信息，例如告警发送地址，告警内容模版，分组策略等都在alertmanager的配置文件中配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">global:</span><br><span class="line">  smtp_smarthost: &#x27;smtp.qq.com:465&#x27;</span><br><span class="line">  smtp_from: &#x27;xxxx@qq.com&#x27;</span><br><span class="line">  smtp_auth_username: &#x27;xxxx@qq.com&#x27;</span><br><span class="line">  smtp_auth_password: &#x27;xxxx&#x27;</span><br><span class="line">  smtp_require_tls: false</span><br><span class="line"></span><br><span class="line">route:</span><br><span class="line">  group_interval: 1m</span><br><span class="line">  repeat_interval: 1m</span><br><span class="line">  receiver: &#x27;mail-receiver&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> group_by             //采用哪个标签作为分组</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> group_wait           //分组等待的时间，收到报警不是立马发送出去，而是等待一段时间，看看同一组中是否有其他报警，如果有一并发送</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> group_interval       //告警时间间隔</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> repeat_interval      //重复告警时间间隔，可以减少发送告警的频率</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> receiver             //接收者是谁</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> routes               //子路由配置</span></span><br><span class="line">receivers:</span><br><span class="line">- name: &#x27;mail-receiver&#x27;</span><br><span class="line">  email_configs:</span><br><span class="line">    - to: &#x27;xxxx@qq.com&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当我kill进程：<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_46.png"></p>
<p>prometheus已经触发告警：<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_47.png"></p>
<p>在等待1分钟，如果持续还是符合告警策略，则状态为从pending变为 FIRING会发送邮件到我的邮箱<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_48.png"><br>此时我的邮箱收到了一条告警消息<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_49.png"></p>
<p>alertmanager也支持对告警进行静默，在alertmanager的WEBUI中配置即可<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_50.png"></p>
<p>间隔了4分钟，没有收到告警，静默生效<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_51.png"></p>
<p>一个小时没有收到告警信息<br><img src="http://cdn.yuleweici.com/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/img_52.png"></p>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p><a href="https://developer.aliyun.com/article/786418">Pull or Push？监控系统如何选型-阿里云开发者社区</a><br><a href="https://segmentfault.com/a/1190000040792832">为go应用添加prometheus监控指标 - SegmentFault 思否</a><br><a href="https://github.com/prometheus/client_golang">GitHub - prometheus&#x2F;client_golang: Prometheus instrumentation library for Go applications</a><br><a href="https://p8s.io/docs/">Material for MkDocs - Prometheus 入门到实战</a><br><a href="https://www.dockone.io/article/347688">终于有人把Prometheus入门讲明白了 - DockOne.io</a><br><a href="https://www.qikqiak.com/post/alertmanager-of-prometheus-in-practice/">Prometheus报警AlertManager实战-阳明的博客|Kubernetes|Istio|Prometheus|Python|Golang|云原生</a><br><a href="https://songjiayang.gitbooks.io/prometheus/content/qa/hotreload.html">如何热加载更新配置?</a><br><a href="https://www.youtube.com/watch?v=qB40kqhTyYM&t=2261s">技术分享：Prometheus是怎么存储数据的</a><br><a href="https://www.youtube.com/watch?v=SOTxSSiLtuA&t=141s">Prometheus 架构设计</a><br><a href="https://www.aneasystone.com/archives/2018/11/prometheus-in-action.html">实战 Prometheus 搭建监控系统</a></p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://vwin.github.io/2022/11/09/%E7%9B%91%E6%8E%A7-Prometheus-Grafana%E5%AE%9E%E6%88%98/" title="监控-Prometheus+Grafana实战" target="_blank" rel="external">http://vwin.github.io/2022/11/09/监控-Prometheus-Grafana实战/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/vwin" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/vwin" target="_blank"><span class="text-dark">will</span><small class="ml-1x">Software Development Engineer in Test &amp; Devops Engineer</small></a></h3>
        <div>测试开发架构师 &amp;&amp; 工程效能专家</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2022/11/14/%E5%90%8E%E5%8F%B0%E6%B5%8B%E8%AF%95%E5%85%A5%E9%97%A8-%E5%A6%82%E4%BD%95%E5%81%9A%E5%90%8E%E5%8F%B0%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" title="后台测试入门-如何做后台性能测试"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2022/11/04/Go-%E5%8D%95%E6%B5%8B/" title="Go-单测"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn " data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">    <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/vwin" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://yuleweici.com/yuleweici/" target="_blank" title="Link" data-toggle=tooltip data-placement=top><i class="icon icon-link"></i></a></li>
        
        <li><a href="mailto:crazyboyspecial@qq.com" target="_blank" title="Email" data-toggle=tooltip data-placement=top><i class="icon icon-email"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        &copy; 2022 V
        
        <!-- <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div> -->
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   
    
  <!-- <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script> -->
  <!-- <script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script> -->
  <!-- <script src="//cdn.jsdelivr.net/npm/valine"></script> -->
  <script src="https://unpkg.com/@waline/client@v2/dist/waline.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"/>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  // new Valine({
  //   el: '#vcomments',
  //   verify: false,
  //   notify: false,
  //   appId: 'kYGZ6VfUgySmlSPFebJoXAD5-MdYXbMMI',
  //   appKey: 'EkbmuElfV0UIfgK2uCGwvUiU',
  //   placeholder: '有任何问题可以留言哦~',
  //   avatar: 'monsterid',
  //   meta: meta,
  //   pageSize: '10' || 10,
  //   serverURLs: 'https://kYGZ6VfU.api.lncldglobal.com',
  //   visitor: true
  // });
  Waline.init({
      el: '#comments',
      serverURL: 'https://hexo-waline-henna.vercel.app',
  });
  </script>

     



  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script>
  <script>
  //利用 FancyBox 实现点击图片放大
  $(document).ready(function() {
    $('article img').not('[hidden]').not('.panel-body img').each(function() {
      var $image = $(this);
      var imageCaption = $image.attr('alt');
      var $imageWrapLink = $image.parent('a');
      if ($imageWrapLink.length < 1) {
        var src = this.getAttribute('src');
        var idx = src.lastIndexOf('?');
        if (idx != -1) {
          src = src.substring(0, idx);
        }
        $imageWrapLink = $image.wrap('<a href="' + src + '"></a>').parent('a');
      }
      $imageWrapLink.attr('data-fancybox', 'images');
      if (imageCaption) {
        $imageWrapLink.attr('data-caption', imageCaption);
      }
    });
    $().fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
    });
  });
  </script>





</body>
</html>