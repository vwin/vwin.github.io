<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  <meta name="baidu-site-verification" content="code-w6zMFQOLpu" />
  <meta name="referrer" content="strict-origin-when-cross-origin">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=yes,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>CPP-单测 | 予乐</title>
  <meta name="description" content="单测系列-C++总结在C++中如何做单测，本文介绍了单测是什么以及C++常用的单测框架和工具">
<meta property="og:type" content="article">
<meta property="og:title" content="CPP-单测">
<meta property="og:url" content="http://vwin.github.io/2022/11/01/CPP-%E5%8D%95%E6%B5%8B/index.html">
<meta property="og:site_name" content="V&#39;s BLOG">
<meta property="og:description" content="单测系列-C++总结在C++中如何做单测，本文介绍了单测是什么以及C++常用的单测框架和工具">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://cdn.yuleweici.com/CPP-%E5%8D%95%E6%B5%8B/img.png">
<meta property="og:image" content="http://cdn.yuleweici.com/CPP-%E5%8D%95%E6%B5%8B/img_2.png">
<meta property="article:published_time" content="2022-11-01T06:58:57.000Z">
<meta property="article:modified_time" content="2022-11-20T08:58:24.211Z">
<meta property="article:author" content="V">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="单测">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://cdn.yuleweici.com/CPP-%E5%8D%95%E6%B5%8B/img.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://vwin.github.io/2022/11/01/CPP-%E5%8D%95%E6%B5%8B/index.html">
  
    <link rel="alternate" href="/atom.xml" title="V&#39;s BLOG" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
    <link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet">
  
  
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8082412711ea4c547c7fdf0e87eb19fb";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>  
<meta name="generator" content="Hexo 6.0.0"></head>


<body class="main-center theme-purple" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/vwin" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">will</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Software Development Engineer in Test &amp; Devops Engineer</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Beijing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-bookmark">
          <a href="/bookmark">
            
            <i class="icon icon-book"></i>
            
            <span class="menu-title">书签</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/vwin" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://yuleweici.com/yuleweici/" target="_blank" title="Link" data-toggle=tooltip data-placement=top><i class="icon icon-link"></i></a></li>
        
        <li><a href="mailto:crazyboyspecial@qq.com" target="_blank" title="Email" data-toggle=tooltip data-placement=top><i class="icon icon-email"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验.<br><a style='color:red' target="_blank" href="https://yuleweici.com/yuleweici-vuepress/">博客-Vuepress</a><br><a style='color:green' target="_blank" href="http://yuleweici.com/yuleweici-docsify/#/">博客-Docsify</a> </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E4%BD%9C/">工作</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a><span class="category-list-count">60</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AI%E8%AF%84%E6%B5%8B/" rel="tag">AI评测</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CI/" rel="tag">CI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Conan/" rel="tag">Conan</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Derrick/" rel="tag">Derrick</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Devops/" rel="tag">Devops</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/" rel="tag">Go</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Grafana/" rel="tag">Grafana</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IaaS/" rel="tag">IaaS</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Iaas/" rel="tag">Iaas</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Prometheus/" rel="tag">Prometheus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/QPS/" rel="tag">QPS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TPS/" rel="tag">TPS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI%E8%87%AA%E5%8A%A8%E5%8C%96/" rel="tag">UI自动化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aio/" rel="tag">aio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/airtest/" rel="tag">airtest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bio/" rel="tag">bio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bootstrap/" rel="tag">bootstrap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/broker/" rel="tag">broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/buffer/" rel="tag">buffer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/" rel="tag">c++</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cached/" rel="tag">cached</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/celery/" rel="tag">celery</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmake/" rel="tag">cmake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cnpm/" rel="tag">cnpm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/consumer/" rel="tag">consumer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/date/" rel="tag">date</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/datetime/" rel="tag">datetime</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/describe/" rel="tag">describe</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dict/" rel="tag">dict</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/element-ui/" rel="tag">element ui</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/" rel="tag">flask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fn/" rel="tag">fn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fp/" rel="tag">fp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/free/" rel="tag">free</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/geojson/" rel="tag">geojson</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github-pages/" rel="tag">github pages</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gunicorn/" rel="tag">gunicorn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/" rel="tag">hadoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/" rel="tag">ios</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdk/" rel="tag">jdk</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jmeter/" rel="tag">jmeter</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jre/" rel="tag">jre</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/json/" rel="tag">json</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jupyter-notebook/" rel="tag">jupyter notebook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k6/" rel="tag">k6</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/" rel="tag">kafka</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka-topic-sh/" rel="tag">kafka-topic.sh</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda/" rel="tag">lambda</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/laravel/" rel="tag">laravel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/list/" rel="tag">list</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/locust/" rel="tag">locust</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/makefile/" rel="tag">makefile</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/metaclass/" rel="tag">metaclass</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mfs/" rel="tag">mfs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/next/" rel="tag">next</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nio/" rel="tag">nio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nmake/" rel="tag">nmake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/paramiko/" rel="tag">paramiko</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/partition/" rel="tag">partition</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pdf/" rel="tag">pdf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/perf/" rel="tag">perf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php5-fpm/" rel="tag">php5-fpm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php7-fpm/" rel="tag">php7-fpm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pip/" rel="tag">pip</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pytest/" rel="tag">pytest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pythonic/" rel="tag">pythonic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qgis/" rel="tag">qgis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/re/" rel="tag">re</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/replica/" rel="tag">replica</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/roc/" rel="tag">roc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/samba/" rel="tag">samba</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scp/" rel="tag">scp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/seaweedfs/" rel="tag">seaweedfs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sorted/" rel="tag">sorted</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/" rel="tag">spark</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sudo/" rel="tag">sudo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/supervisor/" rel="tag">supervisor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/systemtap/" rel="tag">systemtap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/time/" rel="tag">time</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/timeout/" rel="tag">timeout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tmux/" rel="tag">tmux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tn/" rel="tag">tn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tp/" rel="tag">tp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unittest/" rel="tag">unittest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/valine/" rel="tag">valine</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/waline/" rel="tag">waline</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/websocket/" rel="tag">websocket</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zip/" rel="tag">zip</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91/" rel="tag">云</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BF%9D%E9%99%A9/" rel="tag">保险</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A8%E9%93%BE%E8%B7%AF/" rel="tag">全链路</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BD%E6%95%B0/" rel="tag">函数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E6%94%AF%E7%AD%96%E7%95%A5/" rel="tag">分支策略</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="tag">单例模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E6%B5%8B/" rel="tag">单测</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%8B%E6%B5%8B/" rel="tag">压测</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E5%8F%B0/" rel="tag">后台</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E5%8F%B0%E5%85%B3%E7%B3%BB/" rel="tag">后台关系</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/" rel="tag">域名解析</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%B4%E6%96%87%E4%BB%B6/" rel="tag">头文件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%98%E5%82%A8/" rel="tag">存储</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" rel="tag">性能分析</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag">性能测试</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" rel="tag">持续集成</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">排序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%92%E4%BB%B6/" rel="tag">插件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%99%E7%A8%8B/" rel="tag">教程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/" rel="tag">斐波那契数列</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E6%9C%9F/" rel="tag">日期</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%B6%E9%97%B4/" rel="tag">时间</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%81%AB%E7%84%B0%E5%9B%BE/" rel="tag">火焰图</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%B5%E5%BD%B1/" rel="tag">电影</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/" rel="tag">百度网盘</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%91%E6%8E%A7/" rel="tag">监控</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%A9%E9%98%B5/" rel="tag">矩阵</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83/" rel="tag">网络环境</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" rel="tag">自动驾驶</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A1%8C%E6%94%BF%E5%8C%BA/" rel="tag">行政区</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%8D%E4%BA%91/" rel="tag">词云</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%AD%E6%B3%95%E7%B3%96/" rel="tag">语法糖</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B1%86%E7%93%A3/" rel="tag">豆瓣</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" rel="tag">责任链模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%92%E5%BD%92/" rel="tag">递归</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%81%93%E6%A0%BC%E6%8B%89%E6%96%AF/" rel="tag">道格拉斯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%97%AD%E5%8C%85/" rel="tag">闭包</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/AI%E8%AF%84%E6%B5%8B/" style="font-size: 13px;">AI评测</a> <a href="/tags/C/" style="font-size: 13.29px;">C++</a> <a href="/tags/CI/" style="font-size: 13px;">CI</a> <a href="/tags/Conan/" style="font-size: 13px;">Conan</a> <a href="/tags/Derrick/" style="font-size: 13px;">Derrick</a> <a href="/tags/Devops/" style="font-size: 13px;">Devops</a> <a href="/tags/Go/" style="font-size: 13px;">Go</a> <a href="/tags/Grafana/" style="font-size: 13px;">Grafana</a> <a href="/tags/HTML/" style="font-size: 13px;">HTML</a> <a href="/tags/Hexo/" style="font-size: 13px;">Hexo</a> <a href="/tags/IaaS/" style="font-size: 13.29px;">IaaS</a> <a href="/tags/Iaas/" style="font-size: 13.14px;">Iaas</a> <a href="/tags/Jenkins/" style="font-size: 13.14px;">Jenkins</a> <a href="/tags/Prometheus/" style="font-size: 13px;">Prometheus</a> <a href="/tags/Python/" style="font-size: 13.14px;">Python</a> <a href="/tags/QPS/" style="font-size: 13px;">QPS</a> <a href="/tags/TPS/" style="font-size: 13px;">TPS</a> <a href="/tags/UI%E8%87%AA%E5%8A%A8%E5%8C%96/" style="font-size: 13px;">UI自动化</a> <a href="/tags/Ubuntu/" style="font-size: 13px;">Ubuntu</a> <a href="/tags/aio/" style="font-size: 13px;">aio</a> <a href="/tags/airtest/" style="font-size: 13px;">airtest</a> <a href="/tags/bio/" style="font-size: 13px;">bio</a> <a href="/tags/bootstrap/" style="font-size: 13px;">bootstrap</a> <a href="/tags/broker/" style="font-size: 13px;">broker</a> <a href="/tags/buffer/" style="font-size: 13px;">buffer</a> <a href="/tags/c/" style="font-size: 13.14px;">c++</a> <a href="/tags/cached/" style="font-size: 13px;">cached</a> <a href="/tags/celery/" style="font-size: 13px;">celery</a> <a href="/tags/cmake/" style="font-size: 13px;">cmake</a> <a href="/tags/cnpm/" style="font-size: 13px;">cnpm</a> <a href="/tags/consumer/" style="font-size: 13px;">consumer</a> <a href="/tags/date/" style="font-size: 13px;">date</a> <a href="/tags/datetime/" style="font-size: 13px;">datetime</a> <a href="/tags/describe/" style="font-size: 13px;">describe</a> <a href="/tags/dict/" style="font-size: 13px;">dict</a> <a href="/tags/docker/" style="font-size: 13px;">docker</a> <a href="/tags/element-ui/" style="font-size: 13px;">element ui</a> <a href="/tags/flask/" style="font-size: 13px;">flask</a> <a href="/tags/fn/" style="font-size: 13px;">fn</a> <a href="/tags/fp/" style="font-size: 13px;">fp</a> <a href="/tags/free/" style="font-size: 13px;">free</a> <a href="/tags/geojson/" style="font-size: 13px;">geojson</a> <a href="/tags/git/" style="font-size: 13px;">git</a> <a href="/tags/github/" style="font-size: 13px;">github</a> <a href="/tags/github-pages/" style="font-size: 13px;">github pages</a> <a href="/tags/go/" style="font-size: 13px;">go</a> <a href="/tags/gunicorn/" style="font-size: 13px;">gunicorn</a> <a href="/tags/hadoop/" style="font-size: 13px;">hadoop</a> <a href="/tags/hexo/" style="font-size: 13.43px;">hexo</a> <a href="/tags/http/" style="font-size: 13px;">http</a> <a href="/tags/ios/" style="font-size: 13px;">ios</a> <a href="/tags/jdk/" style="font-size: 13px;">jdk</a> <a href="/tags/jmeter/" style="font-size: 13.29px;">jmeter</a> <a href="/tags/jre/" style="font-size: 13px;">jre</a> <a href="/tags/json/" style="font-size: 13px;">json</a> <a href="/tags/jupyter-notebook/" style="font-size: 13px;">jupyter notebook</a> <a href="/tags/k6/" style="font-size: 13px;">k6</a> <a href="/tags/kafka/" style="font-size: 13.14px;">kafka</a> <a href="/tags/kafka-topic-sh/" style="font-size: 13px;">kafka-topic.sh</a> <a href="/tags/lambda/" style="font-size: 13.14px;">lambda</a> <a href="/tags/laravel/" style="font-size: 13px;">laravel</a> <a href="/tags/linux/" style="font-size: 13.86px;">linux</a> <a href="/tags/list/" style="font-size: 13px;">list</a> <a href="/tags/locust/" style="font-size: 13.14px;">locust</a> <a href="/tags/makefile/" style="font-size: 13px;">makefile</a> <a href="/tags/metaclass/" style="font-size: 13px;">metaclass</a> <a href="/tags/mfs/" style="font-size: 13px;">mfs</a> <a href="/tags/mysql/" style="font-size: 13px;">mysql</a> <a href="/tags/next/" style="font-size: 13.14px;">next</a> <a href="/tags/nio/" style="font-size: 13px;">nio</a> <a href="/tags/nmake/" style="font-size: 13px;">nmake</a> <a href="/tags/npm/" style="font-size: 13px;">npm</a> <a href="/tags/paramiko/" style="font-size: 13px;">paramiko</a> <a href="/tags/partition/" style="font-size: 13.14px;">partition</a> <a href="/tags/pdf/" style="font-size: 13px;">pdf</a> <a href="/tags/perf/" style="font-size: 13px;">perf</a> <a href="/tags/php/" style="font-size: 13px;">php</a> <a href="/tags/php5-fpm/" style="font-size: 13px;">php5-fpm</a> <a href="/tags/php7-fpm/" style="font-size: 13px;">php7-fpm</a> <a href="/tags/pip/" style="font-size: 13px;">pip</a> <a href="/tags/pytest/" style="font-size: 13px;">pytest</a> <a href="/tags/python/" style="font-size: 14px;">python</a> <a href="/tags/pythonic/" style="font-size: 13px;">pythonic</a> <a href="/tags/qgis/" style="font-size: 13px;">qgis</a> <a href="/tags/re/" style="font-size: 13px;">re</a> <a href="/tags/replica/" style="font-size: 13.14px;">replica</a> <a href="/tags/roc/" style="font-size: 13px;">roc</a> <a href="/tags/samba/" style="font-size: 13px;">samba</a> <a href="/tags/scp/" style="font-size: 13px;">scp</a> <a href="/tags/seaweedfs/" style="font-size: 13px;">seaweedfs</a> <a href="/tags/sorted/" style="font-size: 13px;">sorted</a> <a href="/tags/spark/" style="font-size: 13.57px;">spark</a> <a href="/tags/ssh/" style="font-size: 13.14px;">ssh</a> <a href="/tags/sudo/" style="font-size: 13px;">sudo</a> <a href="/tags/supervisor/" style="font-size: 13px;">supervisor</a> <a href="/tags/systemtap/" style="font-size: 13px;">systemtap</a> <a href="/tags/time/" style="font-size: 13px;">time</a> <a href="/tags/timeout/" style="font-size: 13px;">timeout</a> <a href="/tags/tmux/" style="font-size: 13px;">tmux</a> <a href="/tags/tn/" style="font-size: 13px;">tn</a> <a href="/tags/tp/" style="font-size: 13px;">tp</a> <a href="/tags/ubuntu/" style="font-size: 13.29px;">ubuntu</a> <a href="/tags/unittest/" style="font-size: 13px;">unittest</a> <a href="/tags/valine/" style="font-size: 13.14px;">valine</a> <a href="/tags/vue/" style="font-size: 13px;">vue</a> <a href="/tags/waline/" style="font-size: 13px;">waline</a> <a href="/tags/websocket/" style="font-size: 13px;">websocket</a> <a href="/tags/zip/" style="font-size: 13px;">zip</a> <a href="/tags/%E4%BA%91/" style="font-size: 13px;">云</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 13px;">人工智能</a> <a href="/tags/%E4%BF%9D%E9%99%A9/" style="font-size: 13px;">保险</a> <a href="/tags/%E5%85%A8%E9%93%BE%E8%B7%AF/" style="font-size: 13px;">全链路</a> <a href="/tags/%E5%87%BD%E6%95%B0/" style="font-size: 13px;">函数</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 13.29px;">分布式</a> <a href="/tags/%E5%88%86%E6%94%AF%E7%AD%96%E7%95%A5/" style="font-size: 13px;">分支策略</a> <a href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" style="font-size: 13px;">单例模式</a> <a href="/tags/%E5%8D%95%E6%B5%8B/" style="font-size: 13.29px;">单测</a> <a href="/tags/%E5%8E%8B%E6%B5%8B/" style="font-size: 13.14px;">压测</a> <a href="/tags/%E5%90%8E%E5%8F%B0/" style="font-size: 13px;">后台</a> <a href="/tags/%E5%90%8E%E5%8F%B0%E5%85%B3%E7%B3%BB/" style="font-size: 13px;">后台关系</a> <a href="/tags/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/" style="font-size: 13px;">域名解析</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 13.71px;">大数据</a> <a href="/tags/%E5%A4%B4%E6%96%87%E4%BB%B6/" style="font-size: 13px;">头文件</a> <a href="/tags/%E5%AD%98%E5%82%A8/" style="font-size: 13px;">存储</a> <a href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" style="font-size: 13px;">性能分析</a> <a href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" style="font-size: 13.86px;">性能测试</a> <a href="/tags/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" style="font-size: 13.14px;">持续集成</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 13px;">排序</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 13px;">插件</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 13px;">教程</a> <a href="/tags/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/" style="font-size: 13px;">斐波那契数列</a> <a href="/tags/%E6%97%A5%E6%9C%9F/" style="font-size: 13px;">日期</a> <a href="/tags/%E6%97%B6%E9%97%B4/" style="font-size: 13px;">时间</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 13.43px;">测试</a> <a href="/tags/%E7%81%AB%E7%84%B0%E5%9B%BE/" style="font-size: 13px;">火焰图</a> <a href="/tags/%E7%94%B5%E5%BD%B1/" style="font-size: 13px;">电影</a> <a href="/tags/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/" style="font-size: 13px;">百度网盘</a> <a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 13px;">监控</a> <a href="/tags/%E7%9F%A9%E9%98%B5/" style="font-size: 13px;">矩阵</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13px;">算法</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83/" style="font-size: 13px;">网络环境</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" style="font-size: 13.29px;">自动驾驶</a> <a href="/tags/%E8%A1%8C%E6%94%BF%E5%8C%BA/" style="font-size: 13px;">行政区</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 13.14px;">设计模式</a> <a href="/tags/%E8%AF%8D%E4%BA%91/" style="font-size: 13px;">词云</a> <a href="/tags/%E8%AF%AD%E6%B3%95%E7%B3%96/" style="font-size: 13px;">语法糖</a> <a href="/tags/%E8%B1%86%E7%93%A3/" style="font-size: 13px;">豆瓣</a> <a href="/tags/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" style="font-size: 13px;">责任链模式</a> <a href="/tags/%E9%80%92%E5%BD%92/" style="font-size: 13px;">递归</a> <a href="/tags/%E9%81%93%E6%A0%BC%E6%8B%89%E6%96%AF/" style="font-size: 13px;">道格拉斯</a> <a href="/tags/%E9%97%AD%E5%8C%85/" style="font-size: 13px;">闭包</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">22</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Hexo/">Hexo</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/20/Hexo-%E6%9B%B4%E6%8D%A2valine%E8%AF%84%E8%AE%BA%E5%88%B0waline/" class="title">Hexo-更换valine评论到waline</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-20T05:51:24.000Z" itemprop="datePublished">2022-11-20</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Hexo/">Hexo</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/20/Hexo-%E8%A7%A3%E5%86%B3Valine%E8%AF%84%E8%AE%BA%E4%B8%8D%E6%98%BE%E7%A4%BA%E7%9A%84%E9%97%AE%E9%A2%98/" class="title">Hexo-解决Valine评论不显示的问题</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-20T05:27:32.000Z" itemprop="datePublished">2022-11-20</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/11/19/ToB%E4%B8%9A%E5%8A%A1%E7%90%86%E8%A7%A3/" class="title">ToB业务理解</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-19T06:16:47.000Z" itemprop="datePublished">2022-11-19</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/15/%E5%8E%8B%E6%B5%8B-%E5%9F%BA%E4%BA%8EK6%E7%9A%84web%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%92%8C%E5%AE%9E%E6%97%B6%E7%9B%91%E6%8E%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="title">压测-基于K6的web性能测试和实时监控解决方案</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-15T08:38:42.000Z" itemprop="datePublished">2022-11-15</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/14/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6-GeoJson%E5%AD%A6%E4%B9%A0/" class="title">自动驾驶-GeoJson学习</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-14T08:50:42.000Z" itemprop="datePublished">2022-11-14</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
  <aside class="sidebar sidebar-toc collapse   in  " id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">1.</span> <span class="toc-text">单元测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.</span> <span class="toc-text">单元测试是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-number">1.2.</span> <span class="toc-text">单元测试的意义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E7%BC%96%E5%86%99%E7%9A%84%E5%8E%9F%E5%88%99"><span class="toc-number">1.3.</span> <span class="toc-text">单元测试用例编写的原则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%AE%BA%E5%8E%9F%E5%88%99"><span class="toc-number">1.3.1.</span> <span class="toc-text">理论原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E7%BA%A6%E5%8E%9F%E5%88%99"><span class="toc-number">1.3.2.</span> <span class="toc-text">规约原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A1%E9%87%8F%E5%8E%9F%E5%88%99"><span class="toc-number">1.3.3.</span> <span class="toc-text">衡量原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.</span> <span class="toc-text">单元测试用例设计方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E8%8C%83-%E8%A7%84%E6%A0%BC-%E5%AF%BC%E5%87%BA%E6%B3%95"><span class="toc-number">1.4.1.</span> <span class="toc-text">规范(规格)导出法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%89%E4%BB%B7%E7%B1%BB%E5%88%92%E5%88%86%E6%B3%95"><span class="toc-number">1.4.2.</span> <span class="toc-text">等价类划分法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%B9%E7%95%8C%E5%80%BC%E5%88%86%E6%9E%90%E6%B3%95"><span class="toc-number">1.4.3.</span> <span class="toc-text">边界值分析法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%B7%AF%E5%BE%84%E6%B5%8B%E8%AF%95%E6%B3%95"><span class="toc-number">1.4.4.</span> <span class="toc-text">基本路径测试法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8C-%E5%8D%95%E6%B5%8B%E6%A1%86%E6%9E%B6"><span class="toc-number">2.</span> <span class="toc-text">常用C++单测框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84C-%E5%8D%95%E6%B5%8B%E5%AF%B9%E6%AF%94"><span class="toc-number">2.1.</span> <span class="toc-text">常用的C++单测对比</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Google-Test"><span class="toc-number">3.</span> <span class="toc-text">Google Test</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">3.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%AD%E8%A8%80"><span class="toc-number">3.2.</span> <span class="toc-text">断言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%96%AD%E8%A8%80"><span class="toc-number">3.2.1.</span> <span class="toc-text">基本断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E6%AF%94%E8%BE%83%E5%9E%8B%E6%96%AD%E8%A8%80"><span class="toc-number">3.2.2.</span> <span class="toc-text">普通比较型断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83%E5%9E%8B%E6%96%AD%E8%A8%80"><span class="toc-number">3.2.3.</span> <span class="toc-text">C字符串比较型断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%AE%E7%82%B9%E6%95%B0%E6%AF%94%E8%BE%83%E5%9E%8B%E6%96%AD%E8%A8%80"><span class="toc-number">3.2.4.</span> <span class="toc-text">浮点数比较型断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%8E%E7%A1%AE%E7%9A%84%E6%88%90%E5%8A%9F%E5%92%8C%E5%A4%B1%E8%B4%A5"><span class="toc-number">3.2.5.</span> <span class="toc-text">明确的成功和失败</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E6%96%AD%E8%A8%80"><span class="toc-number">3.2.6.</span> <span class="toc-text">异常断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B7%B2%E6%9C%89%E5%B8%83%E5%B0%94%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.7.</span> <span class="toc-text">使用已有布尔函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">3.3.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%A4%B9%E5%85%B7%EF%BC%9A%E5%A4%9A%E4%B8%AA%E6%B5%8B%E8%AF%95%E6%9C%89%E5%85%B1%E6%9C%89%E7%9A%84%E6%95%B0%E6%8D%AE%E9%85%8D%E7%BD%AE"><span class="toc-number">3.4.</span> <span class="toc-text">测试夹具：多个测试有共有的数据配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Catch-2"><span class="toc-number">4.</span> <span class="toc-text">Catch 2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#REQUIRE"><span class="toc-number">4.1.</span> <span class="toc-text">REQUIRE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SECTIONS"><span class="toc-number">4.2.</span> <span class="toc-text">SECTIONS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE"><span class="toc-number">4.3.</span> <span class="toc-text">标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E7%82%B9%E6%80%BB%E7%BB%93"><span class="toc-number">4.4.</span> <span class="toc-text">特点总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CppUTest"><span class="toc-number">5.</span> <span class="toc-text">CppUTest</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#main%E5%92%8Ctest"><span class="toc-number">5.1.</span> <span class="toc-text">main和test</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%AD%E8%A8%80-1"><span class="toc-number">5.2.</span> <span class="toc-text">断言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">5.3.</span> <span class="toc-text">特点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Google-Mock"><span class="toc-number">6.</span> <span class="toc-text">Google Mock</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Fake%E3%80%81Mock%E3%80%81Stub"><span class="toc-number">6.1.</span> <span class="toc-text">Fake、Mock、Stub</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E4%BE%8B%E5%AD%90%EF%BC%9AMock-Turtle"><span class="toc-number">6.2.</span> <span class="toc-text">简单例子：Mock Turtle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E6%B5%8B%E8%AF%95%E4%B8%AD%E4%BD%BF%E7%94%A8Mock"><span class="toc-number">6.3.</span> <span class="toc-text">在测试中使用Mock</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E6%9C%9F%E6%9C%9B"><span class="toc-number">6.4.</span> <span class="toc-text">指定期望</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">6.4.1.</span> <span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%B9%E9%85%8D%EF%BC%9A%E5%93%AA%E6%AC%A1%E8%B0%83%E7%94%A8"><span class="toc-number">6.4.2.</span> <span class="toc-text">参数匹配：哪次调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%95%B0%EF%BC%9A%E8%A2%AB%E8%B0%83%E7%94%A8%E5%87%A0%E6%AC%A1"><span class="toc-number">6.4.3.</span> <span class="toc-text">基数：被调用几次</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%EF%BC%9A%E8%AF%A5%E5%81%9A%E4%BB%80%E4%B9%88"><span class="toc-number">6.4.4.</span> <span class="toc-text">行为：该做什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E9%A2%84%E6%9C%9F"><span class="toc-number">6.4.5.</span> <span class="toc-text">使用多个预期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sequence"><span class="toc-number">6.4.6.</span> <span class="toc-text">Sequence</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A"><span class="toc-number">6.5.</span> <span class="toc-text">更多</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%83%85%E6%99%AF%E7%A4%BA%E4%BE%8B"><span class="toc-number">7.</span> <span class="toc-text">情景示例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">7.1.</span> <span class="toc-text">项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E6%B5%8B%E8%AF%95"><span class="toc-number">7.2.</span> <span class="toc-text">普通测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95-Mock"><span class="toc-number">7.3.</span> <span class="toc-text">简单 Mock</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web%E8%AF%B7%E6%B1%82"><span class="toc-number">7.4.</span> <span class="toc-text">Web请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE"><span class="toc-number">7.5.</span> <span class="toc-text">数据库访问</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#FAQ"><span class="toc-number">8.</span> <span class="toc-text">FAQ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%BA%90%E6%96%87%E4%BB%B6%E5%BA%94%E8%AF%A5%E6%94%BE%E5%9C%A8%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%80%E4%B9%88%E4%BD%8D%E7%BD%AE%EF%BC%9F"><span class="toc-number">8.1.</span> <span class="toc-text">单元测试源文件应该放在项目的什么位置？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Google-Mock%E5%8F%AA%E8%83%BDMock%E8%99%9A%E5%87%BD%E6%95%B0%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%88%91%E6%83%B3Mock%E9%9D%9E%E8%99%9A%E5%87%BD%E6%95%B0%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F"><span class="toc-number">8.2.</span> <span class="toc-text">Google Mock只能Mock虚函数，如果我想Mock非虚函数怎么办？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Google-Test%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E4%B8%AD%E8%AF%B4%E6%B5%8B%E6%B5%8B%E8%AF%95%E5%A5%97%E4%BB%B6%E5%90%8D%E7%A7%B0%E3%80%81%E6%B5%8B%E8%AF%95%E5%A4%B9%E5%85%B7%E5%90%8D%E7%A7%B0%E3%80%81%E6%B5%8B%E8%AF%95%E5%90%8D%E7%A7%B0%E4%B8%AD%E4%B8%8D%E5%BA%94%E8%AF%A5%E5%87%BA%E7%8E%B0%E4%B8%8B%E5%88%92%E7%BA%BF-%E3%80%82%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">8.3.</span> <span class="toc-text">Google Test官方文档中说测测试套件名称、测试夹具名称、测试名称中不应该出现下划线_。为什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%BE%93%E5%87%BA%E9%87%8C%E6%9C%89%E5%BE%88%E5%A4%9AUninteresting-mock-function-call%E8%AD%A6%E5%91%8A%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F"><span class="toc-number">8.4.</span> <span class="toc-text">测试输出里有很多Uninteresting mock function call警告怎么办？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%95%E6%B5%8B%E8%A6%86%E7%9B%96%E7%8E%87"><span class="toc-number">9.</span> <span class="toc-text">单测覆盖率</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%EF%BC%9F"><span class="toc-number">9.1.</span> <span class="toc-text">什么是代码覆盖率？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%B5%8B%E9%87%8F%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%EF%BC%9F"><span class="toc-number">9.2.</span> <span class="toc-text">为什么要测量代码覆盖率？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E7%9A%84%E6%8C%87%E6%A0%87%E7%A7%8D%E7%B1%BB"><span class="toc-number">9.3.</span> <span class="toc-text">代码覆盖率的指标种类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F"><span class="toc-number">9.4.</span> <span class="toc-text">代码覆盖率是如何工作的？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E4%B8%BB%E6%B5%81%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E5%B7%A5%E5%85%B7"><span class="toc-number">9.5.</span> <span class="toc-text">当前主流代码覆盖率工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%EF%BC%8C%E4%B8%8D%E8%A6%81%E9%AB%98%E4%BC%B0%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%8C%87%E6%A0%87"><span class="toc-number">9.6.</span> <span class="toc-text">最后，不要高估代码覆盖率指标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-%E8%A6%86%E7%9B%96%E7%8E%87"><span class="toc-number">9.7.</span> <span class="toc-text">C++覆盖率</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gcov-%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84"><span class="toc-number">9.7.1.</span> <span class="toc-text">Gcov 是如何工作的</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91"><span class="toc-number">9.7.1.1.</span> <span class="toc-text">编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6"><span class="toc-number">9.7.1.2.</span> <span class="toc-text">运行可执行文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%8A%A5%E5%91%8A"><span class="toc-number">9.7.1.3.</span> <span class="toc-text">生成报告</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B6%E5%B0%BE"><span class="toc-number">9.7.1.4.</span> <span class="toc-text">收尾</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">10.</span> <span class="toc-text">结语</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5%E5%B0%8F%E7%BB%93"><span class="toc-number">10.1.</span> <span class="toc-text">实践小结</span></a></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-CPP-单测" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      CPP-单测
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2022/11/01/CPP-%E5%8D%95%E6%B5%8B/" class="article-date">
	  <time datetime="2022-11-01T06:58:57.000Z" itemprop="datePublished">2022-11-01</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/C/" rel="tag">C++</a>, <a class="article-tag-link-link" href="/tags/%E5%8D%95%E6%B5%8B/" rel="tag">单测</a>
  </span>


        

	<span class="article-read hidden-xs">
    	<i class="icon icon-eye-fill" aria-hidden="true"></i>
    	<span id="/2022/11/01/CPP-%E5%8D%95%E6%B5%8B/" class="leancloud_visitors"  data-flag-title="CPP-单测">
			<span class="leancloud-visitors-count">0</span>
		</span>
    </span>

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2022/11/01/CPP-%E5%8D%95%E6%B5%8B/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 12k(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 47(分)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>单测系列-C++<br>总结在C++中如何做单测，本文介绍了单测是什么以及C++常用的单测框架和工具</p>
<span id="more"></span>
<h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><h2 id="单元测试是什么"><a href="#单元测试是什么" class="headerlink" title="单元测试是什么"></a>单元测试是什么</h2><p>单元是应用的最小可测试部件。在过程化编程中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是方法，包括基类、超类、抽象类等中的方法。单元测试就是软件开发中对最小单位进行正确性检验的测试工作。<br>不同地方对单元测试有的定义可能会有所不同，但有一些基本共识：</p>
<ol>
<li>单元测试是比较底层的，关注代码的局部而不是整体。 </li>
<li>单元测试是开发人员在写代码时候写的。 </li>
<li>单元测试需要比其他测试运行得快。</li>
</ol>
<h2 id="单元测试的意义"><a href="#单元测试的意义" class="headerlink" title="单元测试的意义"></a>单元测试的意义</h2><ul>
<li>提高代码质量。代码测试都是为了帮助开发人员发现问题从而解决问题，提高代码质量。 </li>
<li>尽早发现问题。问题越早发现，解决的难度和成本就越低。 </li>
<li>保证重构正确性。随着功能的增加，重构（修改老代码）几乎是无法避免的。很多时候我们不敢重构的原因，就是担心其它模块因为依赖它而不工作。有了单元测试，只要在改完代码后运行一下单测就知道改动对整个系统的影响了，从而可以让我们放心的重构代码。 </li>
<li>简化调试过程。单元测试让我们可以轻松地知道是哪一部分代码出了问题。 </li>
<li>简化集成过程。由于各个单元已经被测试，在集成过程中进行的后续测试会更加容易。 </li>
<li>优化代码设计。编写测试用例会迫使开发人员仔细思考代码的设计和必须完成的工作，有利于开发人员加深对代码功能的理解，从而形成更合理的设计和结构。 </li>
<li>单元测试是最好的文档。单元测试覆盖了接口的所有使用方法，是最好的示例代码。而真正的文档包括注释很有可能和代码不同步，并且看不懂。</li>
</ul>
<h2 id="单元测试用例编写的原则"><a href="#单元测试用例编写的原则" class="headerlink" title="单元测试用例编写的原则"></a>单元测试用例编写的原则</h2><h3 id="理论原则"><a href="#理论原则" class="headerlink" title="理论原则"></a>理论原则</h3><ul>
<li>快。单元测试是回归测试，可以在开发过程的任何时候运行，因此运行速度必须快 </li>
<li>一致性。代码没有改变的情况下，每次运行得结果应该保持确定且一致 </li>
<li>原子性。结果只有两种情况：Pass &#x2F; Fail </li>
<li>用例独立。执行顺序不影响；用例间没有状态共享或者依赖关系；用例没有副作用（执行前后环境状态一致） </li>
<li>单一职责。一个用例只负责一个场景 </li>
<li>隔离。功能可能依赖于数据库、web访问、环境变量、系统时间等；一个单元可能依赖于另一部分代码，用例应该解除这些依赖 </li>
<li>可读性。用例的名称、变量名等应该具有可读性，直接表现出该测试的目标 </li>
<li>自动化。单元测试需要全自动执行。测试程序不应该有用户输入；测试结果应该能直接被电脑获取，不应该由人来判断。</li>
</ul>
<h3 id="规约原则"><a href="#规约原则" class="headerlink" title="规约原则"></a>规约原则</h3><p>在实际编写代码过程中，不同的团队会有不同团队的风格，只要团队内部保持有一定的规约即可，比如：</p>
<ul>
<li>单元测试文件名必须以xxx_test.go命名 </li>
<li>方法必须是TestXxx开头，建议风格保持一致（驼峰或者下划线） </li>
<li>方法参数必须 t *testing.T </li>
<li>测试文件和被测试文件必须在一个包中</li>
</ul>
<h3 id="衡量原则"><a href="#衡量原则" class="headerlink" title="衡量原则"></a>衡量原则</h3><p>单元测试是要写额外的代码的，这对开发同学的也是一个不小的工作负担，在一些项目中，我们合理的评估单元测试的编写，我认为我们不能走极端，当然理论上来说全写肯定时好的，但是从成本，效率上来说我们必须做出权衡，衡量原则如下：</p>
<ul>
<li>优先编写核心组件和逻辑模块的测试用例 </li>
<li>逻辑类似的组件如果存在多个，优先编写其中一种逻辑组件的测试用例 </li>
<li>发现Bug时一定先编写测试用例进行Debug </li>
<li>关键util工具类要编写测试用例，这些util工具适用的很频繁，所以这个原则也叫做热点原则，和第1点相呼应。 </li>
<li>测试用户应该独立，一个文件对应一个，而且不同的测试用例之间不要互相依赖。 </li>
<li>测试用例的保持更新</li>
</ul>
<h2 id="单元测试用例设计方法"><a href="#单元测试用例设计方法" class="headerlink" title="单元测试用例设计方法"></a>单元测试用例设计方法</h2><h3 id="规范-规格-导出法"><a href="#规范-规格-导出法" class="headerlink" title="规范(规格)导出法"></a>规范(规格)导出法</h3><p>规范(规格)导出法将需求”翻译“成测试用例。</p>
<p>例如，一个函数的设计需求如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">函数：一个计算平方根的函数 </span><br><span class="line">输入： 实数 </span><br><span class="line">输出： 实数 </span><br><span class="line">要求： 当输入一个0或者比0大的实数时，返回其正的平方根； 当输入一个小于0的实数时，显示错误信息“平方根非法—输入之小于0”，并返回0； </span><br><span class="line">库函数printf()可以用来输出错误信息。</span><br></pre></td></tr></table></figure>

<p>在这个规范中有3个陈述，可以用两个测试用例来对应:</p>
<table>
<thead>
<tr>
<th>编号</th>
<th>用例</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>输入4，输出2</td>
</tr>
<tr>
<td>2</td>
<td>输入-1，输出0</td>
</tr>
</tbody></table>
<h3 id="等价类划分法"><a href="#等价类划分法" class="headerlink" title="等价类划分法"></a>等价类划分法</h3><p>等价类划分法假定某一特定的等价类中的所有值对于测试目的来说是等价的，所以在每个等价类中找一个之作为测试用例。</p>
<p>按照 [输入条件][有效等价类][无效等价类] 建立等价类表，列出所有划分出的等价类</p>
<ul>
<li>为每一个等价类规定一个唯一的编号 </li>
<li>设计一个新的测试用例，使其尽可能多地覆盖尚未被覆盖地有效等价类。重复这一步，直到所有的有效等价类都被覆盖为止 </li>
<li>设计一个新的测试用例，使其仅覆盖一个尚未被覆盖的无效等价类。重复这一步，直到所有的无效等价类都被覆盖为止</li>
</ul>
<p>例如，注册邮箱时要求用6~18个字符，可使用字母、数字、下划线，需以字母开头。</p>
<table>
<thead>
<tr>
<th>有效等价类</th>
<th>无效等价类</th>
</tr>
</thead>
<tbody><tr>
<td>6~18个字符（1）</td>
<td>少于6个字符（2）<br>多余18个字符（3）<br>空（4）</td>
</tr>
<tr>
<td>包含字母、数字、下划线（5）</td>
<td>除字母、数字、下划线的特殊字符（6）<br>非打印字符（7）<br>中文字符 （8）</td>
</tr>
<tr>
<td>以字母开头（9）</td>
<td>以数字或下划线开头（10）</td>
</tr>
</tbody></table>
<p>测试用例</p>
<table>
<thead>
<tr>
<th>编号</th>
<th>输入数据</th>
<th>覆盖等价类</th>
<th>预期结果</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>test_111</td>
<td>（1）、（5）、（9）</td>
<td>合法输入</td>
</tr>
<tr>
<td>2</td>
<td>t_11</td>
<td>（2）、（5）、（9）</td>
<td>非法输入</td>
</tr>
<tr>
<td>3</td>
<td>testtesttest_12345678</td>
<td>（3）、（5）、（9）</td>
<td>非法输入</td>
</tr>
<tr>
<td>4</td>
<td>NULL</td>
<td>（4）</td>
<td>非法输入</td>
</tr>
<tr>
<td>5</td>
<td>test!@1111</td>
<td>（1）、（6）、（9）</td>
<td>非法输入</td>
</tr>
<tr>
<td>6</td>
<td>test 1111</td>
<td>（1）、（7）、（9）</td>
<td>非法输入</td>
</tr>
<tr>
<td>7</td>
<td>test测试1111</td>
<td>（1）、（8）、（9）</td>
<td>非法输入</td>
</tr>
<tr>
<td>8</td>
<td>_test111</td>
<td>（1）、（5）、（10）</td>
<td>非法输入</td>
</tr>
</tbody></table>
<h3 id="边界值分析法"><a href="#边界值分析法" class="headerlink" title="边界值分析法"></a>边界值分析法</h3><p>边界值分析法使用与等价类测试方法相同的等价类划分，只是边界值分析假定 错误更多地存在于两个划分的边界上。<br>边界值测试在软件变得复杂的时候也会变得不实用。边界值测试对于非向量类型的值(如枚举类型的值)也没有意义。<br>例如，和4.1相同的需求，划分(ii)的边界为0和最大正实数；划分(i)的边界为最小负实数和0。由此得到以下测试用例：</p>
<ul>
<li>输入 {最小负实数} </li>
<li>输入 {绝对值很小的负数} </li>
<li>输入 0 </li>
<li>输入 {绝对值很小的正数} </li>
<li>输入 {最大正实数}</li>
</ul>
<h3 id="基本路径测试法"><a href="#基本路径测试法" class="headerlink" title="基本路径测试法"></a>基本路径测试法</h3><p>基本路径测试法是在程序控制流图的基础上，通过分析控制构造的环路复杂性，导出基本可执行路径集合，从而设计测试用例的方法。设计出的测试用例要保证在测试中程序的每个可执行语句至少执行一次。<br>基本路径测试法的基本步骤：</p>
<ul>
<li>程序的控制流图：描述程序控制流的一种图示方法。 </li>
<li>程序圈复杂度：McCabe复杂性度量。从程序的环路复杂性可导出程序基本路径集合中的独立路径条数，这是确定程序中每个可执行语句至少执行一次所必须的测试用例数目的上界。 </li>
<li>导出测试用例：根据圈复杂度和程序结构设计用例数据输入和预期结果。 </li>
<li>准备测试用例：确保基本路径集中的每一条路径的执行。</li>
</ul>
<h1 id="常用C-单测框架"><a href="#常用C-单测框架" class="headerlink" title="常用C++单测框架"></a>常用C++单测框架</h1><h2 id="常用的C-单测对比"><a href="#常用的C-单测对比" class="headerlink" title="常用的C++单测对比"></a>常用的C++单测对比</h2><table>
<thead>
<tr>
<th>编号</th>
<th>Google test</th>
<th>Catch 2</th>
<th>CppUTest</th>
</tr>
</thead>
<tbody><tr>
<td>特点</td>
<td>成熟、兼容性好<br>简洁、有效率<br>常用、学习资源多</td>
<td>框架只有一个catch.hpp、集成轻松<br>有Given-When-Then分区，适合BDD行为驱动开发<br>无自带Mock框架</td>
<td>可以检测内存泄露<br>输出更简洁<br>适合在嵌入式系统项目中使用</td>
</tr>
<tr>
<td>Mock框架</td>
<td>Google Mock</td>
<td>无自带Mock框架</td>
<td>CppUMock</td>
</tr>
<tr>
<td>推荐指数</td>
<td>★★★★★</td>
<td>★★★☆☆</td>
<td>★★☆☆☆</td>
</tr>
</tbody></table>
<p>一般情况下，我们推荐使用Google Test搭配Google Mock。如果项目有特殊需求或更适合其他框架，也可以考虑。<br>根据实际使用频率，在以下部分，Google Test和Google Mock的介绍更为详细；对于其他框架，这里介绍它们的主要特点， 具体使用方法，可以查阅各自文档。</p>
<h1 id="Google-Test"><a href="#Google-Test" class="headerlink" title="Google Test"></a>Google Test</h1><p>Google Test是目前比较成熟而且最常用的C++单元测试框架之一。</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li>断言（Assertions） 是检查条件是否为真的语句。断言的结果可能是成功或者失败， 而失败又分为非致命失败或致命失败。如果发生致命失败，测试进程将中止当前运行，否则它将继续运行。 </li>
<li>测试（Test） 使用断言来验证被测试代码的行为。如果测试崩溃或断言失败，则测试失败；否则测试成功。 </li>
<li>测试套件（Test Suite） 包含一个或多个测试（Test）。当测试套件中的多个测试需要共享通用对象和子例程时， 可以将它们放入测试夹具（Test Fixture）。 </li>
<li>测试程序（Test Program） 可以包含多个测试套件。</li>
</ul>
<h2 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h2><ul>
<li>Google Test中，断言（Assertions） 是类似函数调用的宏。断言失败时，googletest会输出断言的源文件和 行号位置以及失败消息；我们还可以提供自定义失败消息，该消息将附加到googletest消息中。 </li>
<li>断言成对出现（ASSERT_*和EXPECT_*），它们测试的对象相同，但对当前运行有不同的影响。ASSERT_*版本失败时 会产生致命故障，并中止当前函数（不一定是整个TEST）运行。EXPECT_*版本会产生非致命故障，不会停止当前函数运行。 通常EXPECT_*是首选，因为可以在测试中报告多个故障。但是如果在断言失败时继续执行没有意义，则应使用ASSERT_*。 </li>
<li>要提供自定义失败消息，只需使用&lt;&lt; 运算符或此类运算符的序列将其流式传输到宏中即可 。一个例子：<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ASSERT_EQ</span>(x.<span class="built_in">size</span>(), y.<span class="built_in">size</span>()) &lt;&lt; <span class="string">&quot;x和y长度不同&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; x.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">	<span class="built_in">EXPECT_EQ</span>(x[i], y[i]) &lt;&lt; <span class="string">&quot;x和y元素存在不同：&quot;</span> &lt;&lt; i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
以下是一些最常用的断言，如果需要查阅其他断言，可以前往googletest的官方文档。</li>
</ul>
<h3 id="基本断言"><a href="#基本断言" class="headerlink" title="基本断言"></a>基本断言</h3><p><code>condition</code> 是返回<code>true</code>&#x2F;<code>false</code>的变量、布尔表达式、函数调用等，以下断言对其进行验证。</p>
<table>
<thead>
<tr>
<th>失败时中断执行的断言</th>
<th>失败时不中断执行的断言</th>
<th>断言成功情况</th>
</tr>
</thead>
<tbody><tr>
<td>ASSERT_TRUE(condition);</td>
<td>EXPECT_TRUE(condition);</td>
<td>condition为真</td>
</tr>
<tr>
<td>ASSERT_FALSE(condition);</td>
<td>EXPECT_FALSE(condition);</td>
<td>condition为假</td>
</tr>
</tbody></table>
<p>例如：在<code>ASSERT_TRUE(condition)</code>中，当<code>condition</code>为<code>true</code>时，符合断言，不影响执行；当<code>condition</code><br>为<code>false</code>时，不符合断言，且由于是<code>ASSERT</code>，当前执行中断。</p>
<h3 id="普通比较型断言"><a href="#普通比较型断言" class="headerlink" title="普通比较型断言"></a>普通比较型断言</h3><p><code>val1</code>和<code>val2</code>是两个可用<code>==</code>、<code>!=</code>、<code>&gt;</code>、<code>&lt;</code>等运算符进行比较的值，以下断言对其进行比较。</p>
<table>
<thead>
<tr>
<th>失败时中断执行的断言</th>
<th>失败时不中断执行的断言</th>
<th>断言成功情况</th>
</tr>
</thead>
<tbody><tr>
<td>ASSERT_EQ(val1, val2);</td>
<td>EXPECT_EQ(val1, val2);</td>
<td>val1 &#x3D;&#x3D; val2</td>
</tr>
<tr>
<td>ASSERT_NE(val1, val2);</td>
<td>EXPECT_NE(val1, val2);</td>
<td>val1 !&#x3D; val2</td>
</tr>
<tr>
<td>ASSERT_LT(val1, val2);</td>
<td>EXPECT_LT(val1, val2);</td>
<td>val1 &lt; val2</td>
</tr>
<tr>
<td>ASSERT_LE(val1, val2);</td>
<td>EXPECT_LE(val1, val2);</td>
<td>val1 &lt;&#x3D; val2</td>
</tr>
<tr>
<td>ASSERT_GT(val1, val2);</td>
<td>EXPECT_GT(val1, val2);</td>
<td>val1 &gt; val2</td>
</tr>
<tr>
<td>ASSERT_GE(val1, val2);</td>
<td>EXPECT_GE(val1, val2);</td>
<td>val1 &gt;&#x3D; val2</td>
</tr>
</tbody></table>
<p>例如：在<code>ASSERT_GT(val1, val2)</code>中，只有当<code>val1 &gt; val2</code>时，符合断言，不影响执行；当<code>val1 &lt;= val2</code>时，<br>不符合断言，且由于是<code>ASSERT</code>，当前执行中断。</p>
<h3 id="C字符串比较型断言"><a href="#C字符串比较型断言" class="headerlink" title="C字符串比较型断言"></a>C字符串比较型断言</h3><p><code>str1</code>和<code>str2</code>是两个C字符串，以下断言对它们的值进行比较；如果要比较两个<code>std::string</code>对象，直接用之前<br>提到的<code>EXPECT_NE</code>，<code>EXPECT_NE</code>等。</p>
<table>
<thead>
<tr>
<th>失败时中断执行的断言</th>
<th>失败时不中断执行的断言</th>
<th>断言成功情况</th>
</tr>
</thead>
<tbody><tr>
<td>ASSERT_STREQ(str1,str2);</td>
<td>EXPECT_STREQ(str1,str2);</td>
<td>这两个C字符串具有相同的内容</td>
</tr>
<tr>
<td>ASSERT_STRNE(str1,str2);</td>
<td>EXPECT_STRNE(str1,str2);</td>
<td>两个C字符串的内容不同</td>
</tr>
<tr>
<td>ASSERT_STRCASEEQ(str1,str2);</td>
<td>EXPECT_STRCASEEQ(str1,str2);</td>
<td>忽略大小写，两个C字符串的内容相同</td>
</tr>
<tr>
<td>ASSERT_STRCASENE(str1,str2);</td>
<td>EXPECT_STRCASENE(str1,str2)</td>
<td>忽略大小写，两个C字符串的内容不同</td>
</tr>
</tbody></table>
<p>例如：<code>char *str1 = &quot;ABC&quot;;``char *str2 = &quot;ABC&quot;;</code>，<code>EXPECT_STREQ(str1, str2);</code>断言通过，<br>因为它们的内容一样；而<code>EXPECT_EQ(str1, str2);</code>断言失败，因为它们的地址不一样。</p>
<p>注意：一个<code>NULL</code>指针和一个空字符串<code>&quot;&quot;</code>是不同的。</p>
<h3 id="浮点数比较型断言"><a href="#浮点数比较型断言" class="headerlink" title="浮点数比较型断言"></a>浮点数比较型断言</h3><p><code>val1</code>和<code>val2</code>是两个浮点数，以下断言对其进行比较。</p>
<table>
<thead>
<tr>
<th>失败时中断执行的断言</th>
<th>失败时不中断执行的断言</th>
<th>断言成功情况</th>
</tr>
</thead>
<tbody><tr>
<td>ASSERT_FLOAT_EQ(val1, val2);</td>
<td>EXPECT_FLOAT_EQ(val1, val2);</td>
<td>这两个float值几乎相等</td>
</tr>
<tr>
<td>ASSERT_DOUBLE_EQ(val1, val2);</td>
<td>EXPECT_DOUBLE_EQ(val1, val2);</td>
<td>这两个double值几乎相等</td>
</tr>
</tbody></table>
<p>以下断言可以选择可接受的误差范围：</p>
<table>
<thead>
<tr>
<th>失败时中断执行的断言</th>
<th>失败时不中断执行的断言</th>
<th>断言成功情况</th>
</tr>
</thead>
<tbody><tr>
<td>ASSERT_NEAR(val1, val2, abs_error);</td>
<td>EXPECT_NEAR(val1, val2, abs_error);</td>
<td>val1和val2的差的绝对值不超过abs_error</td>
</tr>
</tbody></table>
<h3 id="明确的成功和失败"><a href="#明确的成功和失败" class="headerlink" title="明确的成功和失败"></a>明确的成功和失败</h3><ul>
<li>明确生成成功：</li>
<li><code>SUCCEED();</code> 生成一个成功，但这不代表整个测试就成功了。</li>
<li>明确生成失败：</li>
<li><code>FAIL();</code> 生成致命错误</li>
<li><code>ADD_FAILURE();</code> 生成非致命错误。</li>
<li><code>ADD_FAILURE_AT(&quot;file_path&quot;,line_number);</code> 生成非致命错误，输出文件名和行号。</li>
</ul>
<p>例如：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(condition) &#123;</span><br><span class="line">	<span class="built_in">SUCCEED</span>();</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="built_in">FAIL</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果上等同于</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ASSERT_TRUE</span>(condition);</span><br></pre></td></tr></table></figure>
<p>只是<code>ASSERT_TRUE</code>失败时可以输出<code>condition</code>的具体值。当但我们需要验证的<code>condition</code>很复杂时，<br>或者需要很多个<code>if..else...</code>分支来验证彼此互斥的情况以保证覆盖到每一种可能性时，<code>SUCCEED()</code>、<code>FAIL()</code>等<br>明确的成功&#x2F;失败可能是更好的选择。</p>
<h3 id="异常断言"><a href="#异常断言" class="headerlink" title="异常断言"></a>异常断言</h3><p>这些断言验证一段代码（<code>statement</code>）是否抛出（或不抛出）给定类型的异常：</p>
<table>
<thead>
<tr>
<th>失败时中断执行的断言</th>
<th>失败时不中断执行的断言</th>
<th>断言成功情况</th>
</tr>
</thead>
<tbody><tr>
<td>ASSERT_THROW(statement, exception_type);</td>
<td>EXPECT_THROW(statement, exception_type);</td>
<td>statement抛出给定类型的异常</td>
</tr>
<tr>
<td>ASSERT_ANY_THROW(statement);</td>
<td>EXPECT_ANY_THROW(statement);</td>
<td>statement抛出任何类型的异常</td>
</tr>
<tr>
<td>ASSERT_NO_THROW(statement);</td>
<td>EXPECT_NO_THROW(statement);</td>
<td>statement不抛出任何异常</td>
</tr>
</tbody></table>
<h3 id="使用已有布尔函数"><a href="#使用已有布尔函数" class="headerlink" title="使用已有布尔函数"></a>使用已有布尔函数</h3><p>当<code>predN</code>是一个有<code>N</code>个参数，返回布尔值的函数时，以下断言可以获取更好的错误信息。</p>
<table>
<thead>
<tr>
<th>失败时中断执行的断言</th>
<th>失败时不中断执行的断言</th>
<th>断言成功情况</th>
</tr>
</thead>
<tbody><tr>
<td>ASSERT_PRED1(pred1, val1);</td>
<td>EXPECT_PRED1(pred1, val1);</td>
<td>pred1(val1)为真</td>
</tr>
<tr>
<td>ASSERT_PRED2(pred2, val1, val2);</td>
<td>EXPECT_PRED2(pred2, val1, val2);</td>
<td>pred2(val1, val2)为真</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<p>例如：<code>isComparable(Object o1, Object o2)</code>是一个返回布尔值的函数。我们可以有以下选择，<br>都能达到验证函数调用结果的目的：</p>
<ol>
<li><code>ASSERT_TRUE(isComparable(obj1, obj2));</code></li>
<li><code>ASSERT_PRED2(isComparable, obj1, obj2);</code><br>　　区别在于：当断言失败时，<code>ASSERT_TRUE</code>只会告知函数最后的返回值是<code>false</code>；而<code>ASSERT_TRUE</code>同时<br>会输出<code>val1</code>、<code>val2</code>的值。</li>
</ol>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>创建一个测试的步骤：</p>
<ol>
<li>使用<code>TEST()</code>宏定义和命名测试功能。</li>
<li>在<code>TEST()</code>宏内，构造出达到测试状态的函数、变量</li>
<li>使用断言指定函数、变量期望的返回值、值。<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">TEST</span>(MessageTestSuite, BodyLengthNegative) &#123;</span><br><span class="line">	... 构造 ...</span><br><span class="line">	... 断言 ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><code>TEST()</code>第一个参数是Test Suite的名称，第二个参数是Test Suite内的Test名称。这两个名称都必须是有效的<br>C++标识符，并且它们不应包含任何下划线（<code>_</code>）。测试的全名包括Test Suite名和Test名。来自不同Test Suite的<br>测试可以具有相同的Test名。它们都不是变量，也不是字符串。</p>
<p>在上面的例子中，这个测试的名称是<code>BodyLengthNegative</code>，Test Suite的名称是<code>MessageTestSuite</code>。</p>
<h2 id="测试夹具：多个测试有共有的数据配置"><a href="#测试夹具：多个测试有共有的数据配置" class="headerlink" title="测试夹具：多个测试有共有的数据配置"></a>测试夹具：多个测试有共有的数据配置</h2><p>如果多个测试有共有的数据配置，可以使用<strong>测试夹具（Test Fixture）</strong>将共用部分提取出来重复利用。</p>
<p>要创建一个测试夹具：</p>
<ol>
<li>创建一个继承<code>::testing::Test</code>的类。从<code>protected</code>开始这个类，因为我们要从子类访问夹具成员。</li>
<li>在类内部，声明计划使用的任何对象。</li>
<li>如有必要，编写默认的<code>constructor</code>或<code>SetUp()</code>函数为每个测试准备对象。</li>
<li>如有必要，编写一个<code>destructor</code>或<code>TearDown()</code>函数以释放在<code>SetUp()</code>中分配的任何资源。</li>
<li>如有必要，定义一些共享的类函数</li>
</ol>
<p>当使用测试夹具是，需要使用<code>TEST_F()</code>而不是<code>TEST()</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestFixtureName</span> : <span class="keyword">public</span> ::testing::Test &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">SetUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">TearDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">SomeFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line">	SomeObject object;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST_F</span>(TestFixtureName, TestName1) &#123;</span><br><span class="line">	... 构造 ...</span><br><span class="line">	... 断言 ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST_F</span>(TestFixtureName, TestName2) &#123;</span><br><span class="line">	... 构造 ...</span><br><span class="line">	... 断言 ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那上面这个例子来说，对于每个<code>TEST_F()</code>测试，googletest将在运行时</p>
<ol>
<li>创建一个新的<strong>测试夹具（Test Fixture）</strong>对象</li>
<li>通过<code>SetUp()</code>对其进行初始化</li>
<li>运行该<code>TEST_F()</code>测试</li>
<li>通过调用进行清理<code>TearDown()</code></li>
<li>然后删除该<strong>测试夹具（Test Fixture）</strong>对象</li>
</ol>
<p>所以，虽然多个<code>TEST_F</code>共用同一部分代码，但共同代码会每个<code>TEST_F</code>都独立执行一次。同一测试套件中的不同测试具有不同的测试夹具对象。一个测试对<strong>测试夹具</strong>所做的任何更改均不会影响其他测试。</p>
<h1 id="Catch-2"><a href="#Catch-2" class="headerlink" title="Catch 2"></a>Catch 2</h1><p>Catch2 仅有头部文件（header only），所以它的第一个优点是可以轻易地放入任何项目中进行使用。只需要 <code>#include &quot;catch.hpp&quot;</code> 就可以在当前文件使用 Catch</p>
<h2 id="REQUIRE"><a href="#REQUIRE" class="headerlink" title="REQUIRE"></a>REQUIRE</h2><p>Catch的基础使用方法也很简单。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> CATCH_CONFIG_MAIN  <span class="comment">// This tells Catch to provide a main() - only do this in one cpp file</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;catch.hpp&quot;</span></span></span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">int</span> <span class="title">Factorial</span><span class="params">( <span class="type">unsigned</span> <span class="type">int</span> number )</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> number &lt;= <span class="number">1</span> ? number : <span class="built_in">Factorial</span>(number<span class="number">-1</span>)*number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST_CASE</span>( <span class="string">&quot;Factorials are computed&quot;</span>, <span class="string">&quot;[factorial]&quot;</span> ) &#123;   </span><br><span class="line">	<span class="built_in">REQUIRE</span>( <span class="built_in">Factorial</span>(<span class="number">0</span>) == <span class="number">1</span> );    </span><br><span class="line">	<span class="built_in">REQUIRE</span>( <span class="built_in">Factorial</span>(<span class="number">1</span>) == <span class="number">1</span> );    </span><br><span class="line">	<span class="built_in">REQUIRE</span>( <span class="built_in">Factorial</span>(<span class="number">2</span>) == <span class="number">2</span> );    </span><br><span class="line">	<span class="built_in">REQUIRE</span>( <span class="built_in">Factorial</span>(<span class="number">3</span>) == <span class="number">6</span> );    </span><br><span class="line">	<span class="built_in">REQUIRE</span>( <span class="built_in">Factorial</span>(<span class="number">10</span>) == <span class="number">3628800</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SECTIONS"><a href="#SECTIONS" class="headerlink" title="SECTIONS"></a>SECTIONS</h2><p>Catch的SECTION相当于GTEST里夹具（fixture）的功能。对每一个SECTION，TEST_CASE 都从头开始执行。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">TEST_CASE</span>( <span class="string">&quot;vectors can be sized and resized&quot;</span>, <span class="string">&quot;[vector]&quot;</span> ) &#123;</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">v</span><span class="params">( <span class="number">5</span> )</span></span>;    </span><br><span class="line">    <span class="built_in">REQUIRE</span>( v.<span class="built_in">size</span>() == <span class="number">5</span> );    </span><br><span class="line">    <span class="built_in">REQUIRE</span>( v.<span class="built_in">capacity</span>() &gt;= <span class="number">5</span> );    </span><br><span class="line">    <span class="built_in">SECTION</span>( <span class="string">&quot;resizing bigger changes size and capacity&quot;</span> ) </span><br><span class="line">        v.<span class="built_in">resize</span>( <span class="number">10</span> );        </span><br><span class="line">        <span class="built_in">REQUIRE</span>( v.<span class="built_in">size</span>() == <span class="number">10</span> );        </span><br><span class="line">        <span class="built_in">REQUIRE</span>( v.<span class="built_in">capacity</span>() &gt;= <span class="number">10</span> );    </span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="built_in">SECTION</span>( <span class="string">&quot;resizing smaller changes size not capacity&quot;</span> )&#123;</span><br><span class="line">        v.<span class="built_in">resize</span>( <span class="number">0</span> );        </span><br><span class="line">        <span class="built_in">REQUIRE</span>( v.<span class="built_in">size</span>() == <span class="number">0</span> );        </span><br><span class="line">        <span class="built_in">REQUIRE</span>( v.<span class="built_in">capacity</span>() &gt;= <span class="number">5</span> );    </span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="built_in">SECTION</span>( <span class="string">&quot;reserving bigger changes capacity not size&quot;</span> ) &#123; </span><br><span class="line">        v.<span class="built_in">reserve</span>( <span class="number">10</span> );        </span><br><span class="line">        <span class="built_in">REQUIRE</span>( v.<span class="built_in">size</span>() == <span class="number">5</span> );        </span><br><span class="line">        <span class="built_in">REQUIRE</span>( v.<span class="built_in">capacity</span>() &gt;= <span class="number">10</span> );    </span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="built_in">SECTION</span>( <span class="string">&quot;reserving smaller does not change size&quot;</span> ) &#123;</span><br><span class="line">        v.<span class="built_in">reserve</span>( <span class="number">0</span> );        </span><br><span class="line">        <span class="built_in">REQUIRE</span>( v.<span class="built_in">size</span>() == <span class="number">5</span> );        </span><br><span class="line">        <span class="built_in">REQUIRE</span>( v.<span class="built_in">capacity</span>() &gt;= <span class="number">5</span> );    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h2><p>Catch提供标签特性。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">TEST_CASE</span>( <span class="string">&quot;A&quot;</span>, <span class="string">&quot;[widget]&quot;</span> ) &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"><span class="built_in">TEST_CASE</span>( <span class="string">&quot;B&quot;</span>, <span class="string">&quot;[widget]&quot;</span> ) &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"><span class="built_in">TEST_CASE</span>( <span class="string">&quot;C&quot;</span>, <span class="string">&quot;[gadget]&quot;</span> ) &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"><span class="built_in">TEST_CASE</span>( <span class="string">&quot;D&quot;</span>, <span class="string">&quot;[widget][gadget]&quot;</span> ) &#123; <span class="comment">/* ... */</span> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&quot;[widget]&quot;</code> 选取 A、B、D.</li>
<li><code>&quot;[gadget]&quot;</code> 选取 C、D.</li>
<li><code>&quot;[widget][gadget]&quot;</code> 只选取 D</li>
<li><code>&quot;[widget],[gadget]&quot;</code> 所有A、B、C、D.</li>
<li>还有一些特殊标签指定特殊行为</li>
</ul>
<h2 id="特点总结"><a href="#特点总结" class="headerlink" title="特点总结"></a>特点总结</h2><ul>
<li>框架只有一个<code>catch.hpp</code>、集成轻松</li>
<li>有Given-When-Then分区，适合BDD行为驱动开发</li>
<li>无自带Mock框架</li>
</ul>
<h1 id="CppUTest"><a href="#CppUTest" class="headerlink" title="CppUTest"></a>CppUTest</h1><h2 id="main和test"><a href="#main和test" class="headerlink" title="main和test"></a>main和test</h2><p>main.cpp:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CppUTest/CommandLineTestRunner.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> ac, <span class="type">char</span>** av)</span></span>&#123;    </span><br><span class="line">	<span class="keyword">return</span> CommandLineTestRunner::<span class="built_in">RunAllTests</span>(ac, av);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>test.cpp:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CppUTest/TestHarness.h&quot;</span></span></span><br><span class="line"><span class="built_in">TEST_GROUP</span>(FirstTestGroup)&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span></span>&#123;      </span><br><span class="line">        <span class="comment">// Init stuff   </span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">teardown</span><span class="params">()</span></span>&#123;      </span><br><span class="line">        <span class="comment">// Uninit stuff   </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST</span>(FirstTestGroup, FirstTest)&#123;</span><br><span class="line">    <span class="built_in">FAIL</span>(<span class="string">&quot;Fail me!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">TEST</span>(FirstTestGroup, SecondTest)&#123;</span><br><span class="line">    <span class="built_in">STRCMP_EQUAL</span>(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="断言-1"><a href="#断言-1" class="headerlink" title="断言"></a>断言</h2><ul>
<li><code>CHECK(boolean condition)</code>检查任何布尔结果。</li>
<li><code>CHECK_TEXT(boolean condition, text)</code>检查任何布尔结果，并在失败时输出文本。</li>
<li><code>CHECK_FALSE(condition)</code>检查任何布尔结果</li>
<li><code>CHECK_EQUAL(expected, actual)</code>使用<code>==</code>检查实体之间的相等性。因此，如果有一个支持<code>operator==()</code>的类，则可以使用此宏比较两个实例。</li>
<li><code>CHECK_COMPARE(first, relop, second)</code>检查在两个实体之间是否存在关系运算符。失败时，打印两个操作数求和的结果。</li>
<li><code>CHECK_THROWS(expected_exception, expression)</code>检查表达式是否抛出<code>expected_exception</code>（例如<code>std::exception</code>）。<code>CHECK_THROWS</code>仅在使用标准C ++库（默认）构建CppUTest时可用。</li>
<li><code>STRCMP_EQUAL(expected, actual)</code>使用<code>strcmp()</code>检查<code>const char *</code>字符串是否相等。</li>
<li><code>STRNCMP_EQUAL(expected, actual, length)</code>使用<code>strncmp()</code>检查<code>const char *</code>字符串是否相等。</li>
<li><code>STRCMP_NOCASE_EQUAL(expected, actual)</code>不考虑大小写，检查<code>const char *</code>字符串是否相等。</li>
</ul>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li>可以检测内存泄露</li>
<li>输出更简洁</li>
<li>使用在嵌入式系统项目中使用</li>
</ul>
<h1 id="Google-Mock"><a href="#Google-Mock" class="headerlink" title="Google Mock"></a>Google Mock</h1><p>Google Mock一般来说和Google Test搭配使用，但Google Test也可以和其他Mock框架一起使用。<br>本部分是Google Mock基础常用的用法，如需要特殊用法，请查阅Google Mock官方文档。</p>
<h2 id="Fake、Mock、Stub"><a href="#Fake、Mock、Stub" class="headerlink" title="Fake、Mock、Stub"></a>Fake、Mock、Stub</h2><ul>
<li>Fake对象<strong>有</strong>具体的实现，但采取一些捷径，比如用内存替代真实的数据库读取。</li>
<li>Stub对象<strong>没有</strong>具体的实现，只是返回提前准备好的数据。</li>
<li>Mock对象和Stub类似，只是在测试中需要调用时，针对某种输入指定期望的行为。Mock和Stub的区别是，<br>Mock除了返回数据还可以指定期望以验证行为。</li>
</ul>
<h2 id="简单例子：Mock-Turtle"><a href="#简单例子：Mock-Turtle" class="headerlink" title="简单例子：Mock Turtle"></a>简单例子：Mock Turtle</h2><p>Turtle类:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Turtle</span> &#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">Turtle</span>() &#123;&#125;;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">PenUp</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">PenDown</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Forward</span><span class="params">(<span class="type">int</span> distance)</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Turn</span><span class="params">(<span class="type">int</span> degrees)</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">GoTo</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">GetX</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">GetY</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>MockTurtle类:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;gmock/gmock.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MockTurtle</span> : <span class="keyword">public</span> Turtle &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	...</span><br><span class="line">	<span class="built_in">MOCK_METHOD</span>(<span class="type">void</span>, PenUp, (), (<span class="keyword">override</span>));</span><br><span class="line">	<span class="built_in">MOCK_METHOD</span>(<span class="type">void</span>, PenDown, (), (<span class="keyword">override</span>));</span><br><span class="line">	<span class="built_in">MOCK_METHOD</span>(<span class="type">void</span>, Forward, (<span class="type">int</span> distance), (<span class="keyword">override</span>));</span><br><span class="line">	<span class="built_in">MOCK_METHOD</span>(<span class="type">void</span>, Turn, (<span class="type">int</span> degrees), (<span class="keyword">override</span>));</span><br><span class="line">	<span class="built_in">MOCK_METHOD</span>(<span class="type">void</span>, GoTo, (<span class="type">int</span> x, <span class="type">int</span> y), (<span class="keyword">override</span>));</span><br><span class="line">	<span class="built_in">MOCK_METHOD</span>(<span class="type">int</span>, GetX, (), (<span class="type">const</span>, <span class="keyword">override</span>));</span><br><span class="line">	<span class="built_in">MOCK_METHOD</span>(<span class="type">int</span>, GetY, (), (<span class="type">const</span>, <span class="keyword">override</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>创建Mock类的步骤：</p>
<ol>
<li><p><code>MockTurtle</code>继承<code>Turtle</code></p>
</li>
<li><p>找到<code>Turtle</code>的一个虚函数</p>
</li>
<li><p>在<code>public:</code>的部分中，写一个<code>MOCK_METHOD();</code></p>
</li>
<li><p>将虚函数函数签名复制进<code>MOCK_METHOD();</code>中，加两个逗号：一个在返回类型和函数名之间另一个在函数名和参数列表之间</p>
<p>例如：<code>void PenDown()</code>有三部分：<code>void</code>、<code>PenDown</code>和<code>()</code>，这三部分就是<code>MOCK_METHOD</code>的前三个参数</p>
</li>
<li><p>如果要模拟<code>const</code>方法，添加一个包含<code>(const) </code>的第4个参数（必须带括号）。</p>
</li>
<li><p>建议添加<code>override</code>关键字。所以对于<code>const</code>方法，第四个参数变为<code>(const, override)</code>，对于非<code>const</code>方法，第四个参数变为<code>(override)</code>。这不是强制性的。</p>
</li>
<li><p>重复步骤直至完成要模拟的所有虚拟函数。</p>
</li>
</ol>
<h2 id="在测试中使用Mock"><a href="#在测试中使用Mock" class="headerlink" title="在测试中使用Mock"></a>在测试中使用Mock</h2><p>在测试中使用Mock的步骤：</p>
<ol>
<li>从<code>testing</code>名称空间导入<code>gmock.h</code>的函数名（每个文件只需要执行一次）。</li>
<li>创建一些Mock对象。</li>
<li>指定对它们的期望（方法将被调用多少次？带有什么参数？每次应该做什么（对参数做什么、返回什么值）？等等）。</li>
<li>使用Mock对象；可以使用googletest断言检查结果。如果mock函数的调用超出预期或参数错误，将会立即收到错误消息。</li>
<li>当Mock对象被销毁时，gMock自动检查对模拟的所有期望是否得到满足。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;path/to/mock-turtle.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;gmock/gmock.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;gtest/gtest.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> ::testing::AtLeast;                         	<span class="comment">// #1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST</span>(PainterTest, CanDrawSomething) &#123;</span><br><span class="line">	MockTurtle turtle;                              <span class="comment">// #2</span></span><br><span class="line">	<span class="built_in">EXPECT_CALL</span>(turtle, <span class="built_in">PenDown</span>())                  <span class="comment">// #3</span></span><br><span class="line">		.<span class="built_in">Times</span>(<span class="built_in">AtLeast</span>(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">	<span class="function">Painter <span class="title">painter</span><span class="params">(&amp;turtle)</span></span>;                       <span class="comment">// #4</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">EXPECT_TRUE</span>(painter.<span class="built_in">DrawCircle</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>));      <span class="comment">// #5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，我们期望<code>turtle</code>的<code>PenDown()</code>至少被调用一次。如果在<code>turtle</code>对象被销毁时，<code>PenDown()</code>还没有被调用或者调用两次或以上，测试会失败。</p>
<h2 id="指定期望"><a href="#指定期望" class="headerlink" title="指定期望"></a>指定期望</h2><p><code>EXPECT_CALL</code>（指定期望）是使用Google Mock的核心。<code>EXPECT_CALL</code>的作用是两方面的：</p>
<ol>
<li><p>告诉这个Mock（假）方法如何模仿原始方法：</p>
<p>我们在<code>EXPECT_CALL</code>中告诉Google Mock，某个对象的某个方法被第一次调用时，会修改某个参数，会返回某个值；第二次调用时，会修改某个参数，会返回某个值…….</p>
</li>
<li><p>验证被调用的情况</p>
<p>我们在<code>EXPECT_CALL</code>中告诉Google Mock，某个对象的某个方法总共会被调用N次（或大于N次、小于N次）。如果最终次数不符合预期，会导致测试失败。</p>
</li>
</ol>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">EXPECT_CALL</span>(mock_object, <span class="built_in">method</span>(matchers))</span><br><span class="line">	.<span class="built_in">Times</span>(cardinality)</span><br><span class="line">	.<span class="built_in">WillOnce</span>(action)</span><br><span class="line">	.<span class="built_in">WillRepeatedly</span>(action);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>mock_object</code> 是对象</li>
<li><code>method(matchers)</code> 用于匹配相应的函数调用</li>
<li><code>cardinality</code> 指定基数（被调用次数情况）</li>
<li><code>action</code> 指定被调用时的行为</li>
</ul>
<p>例子：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ::testing::Return;</span><br><span class="line">...</span><br><span class="line"><span class="built_in">EXPECT_CALL</span>(turtle, <span class="built_in">GetX</span>())</span><br><span class="line">	.<span class="built_in">Times</span>(<span class="number">5</span>)</span><br><span class="line">	.<span class="built_in">WillOnce</span>(<span class="built_in">Return</span>(<span class="number">100</span>))</span><br><span class="line">	.<span class="built_in">WillOnce</span>(<span class="built_in">Return</span>(<span class="number">150</span>))</span><br><span class="line">	.<span class="built_in">WillRepeatedly</span>(<span class="built_in">Return</span>(<span class="number">200</span>));</span><br></pre></td></tr></table></figure>

<p>这个<code>EXPECT_CALL()</code>指定的期望是：在<code>turtle</code>这个Mock对象销毁之前，<code>turtle</code>的<code>getX()</code>函数会被调用五次。第一次返回<code>100</code>，第二次返回<code>150</code>，第三次及以后都返回<code>200</code>。指定期望后，5次对<code>getX</code>的调用会有这些行为。但如果最终调用次数不为5次，则测试失败。</p>
<h3 id="参数匹配：哪次调用"><a href="#参数匹配：哪次调用" class="headerlink" title="参数匹配：哪次调用"></a>参数匹配：哪次调用</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ::testing::_;</span><br><span class="line"><span class="keyword">using</span> ::testing::Ge;</span><br><span class="line"><span class="comment">// 只与Forward(100)匹配</span></span><br><span class="line"><span class="built_in">EXPECT_CALL</span>(turtle, <span class="built_in">Forward</span>(<span class="number">100</span>));</span><br><span class="line"><span class="comment">// 与GoTo(x,y)匹配, 只要x&gt;=50</span></span><br><span class="line"><span class="built_in">EXPECT_CALL</span>(turtle, <span class="built_in">GoTo</span>(<span class="built_in">Ge</span>(<span class="number">50</span>), _));</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_</code>相当于“任何”。</li>
<li><code>100</code>相当于<code>Eq(100)</code>。</li>
<li><code>Ge(50)</code>指参数大于或等于50。</li>
<li>如果不关心参数，只写函数名就可以。比如<code>EXPECT_CALL(turtle, GoTo);</code>。</li>
</ul>
<h3 id="基数：被调用几次"><a href="#基数：被调用几次" class="headerlink" title="基数：被调用几次"></a>基数：被调用几次</h3><p>用<code>Times(m)</code>，<code>Times(AtLeast(n))</code>等来指定期待的调用次数。</p>
<p><code>Times</code>可以被省略。比如整个<code>EXPECT_CALL</code>只有一个<code>WillOnce(action)</code>相当于也说明了调用次数只能为1。</p>
<h3 id="行为：该做什么"><a href="#行为：该做什么" class="headerlink" title="行为：该做什么"></a>行为：该做什么</h3><p>常用模式：如果需要指定前几次调用的特殊情况，并且之后的调用情况相同。使用一系列<code>WillOnce()</code>之后有<code>WillRepeatedly()</code></p>
<p>除了用来指定调用返回值的<code>Return()</code>，Google Mock中常用行为中还有：<code>SetArgPointee&lt;N&gt;(value)</code>，<br><code>SetArgPointee</code>将第<code>N</code>个指针参数（从0开始）指向的变量赋值为<code>value</code>。</p>
<p>比如<code>void getObject(Object* response)&#123;...&#125;</code>的<code>EXPECT_CALL</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object* a = new Object;</span><br><span class="line">EXPECT_CALL(object, request)</span><br><span class="line">	.WillOnce(SetArgPointee&lt;1&gt;(*a));</span><br></pre></td></tr></table></figure>
<p>就修改了传入的指针<code>response</code>，使其指向了一个我们新创建的对象。</p>
<p>如果有多个行为，应该使用<code>DoAll(a1, a2, ..., an)</code>。<code>DoAll</code>执行所有<code>n</code>个action并返回<code>an</code>的结果。</p>
<h3 id="使用多个预期"><a href="#使用多个预期" class="headerlink" title="使用多个预期"></a>使用多个预期</h3><p>例子：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ::testing::_;</span><br><span class="line">...</span><br><span class="line"><span class="built_in">EXPECT_CALL</span>(turtle, <span class="built_in">Forward</span>(_))		<span class="comment">// #1</span></span><br><span class="line">	.<span class="built_in">Times</span>(<span class="number">3</span>);  	</span><br><span class="line"><span class="built_in">EXPECT_CALL</span>(turtle, <span class="built_in">Forward</span>(<span class="number">10</span>))  	<span class="comment">// #2</span></span><br><span class="line">	.<span class="built_in">Times</span>(<span class="number">2</span>);</span><br><span class="line">...mock对象函数被调用...</span><br><span class="line">	<span class="comment">//Forward(10);						// 与#2匹配</span></span><br><span class="line">	<span class="comment">//Forward(20);						// 与#1匹配</span></span><br></pre></td></tr></table></figure>

<p>正常情况下，Google Mock以倒序搜索预期：如果和多个<code>EXPECT_CALL</code>都可以匹配，只有之前的，<br>距离调用最近的一个<code>EXPECT_CALL()</code>会被匹配。例如：</p>
<ul>
<li>连续三次调用<code>Forward(10)</code>会生错误因为它和#2匹配。</li>
<li>连续三次调用<code>Forward(20)</code>不会有错误因为它和#1匹配。</li>
</ul>
<p>一旦匹配，该预期会被一直绑定，即使执行次数达到上限之后，还是是生效的，这就是为什么三次调用<br><code>Forward(10)</code>超过了2号<code>EXPECT_CALL</code>的上限时，不会去试图绑定1号<code>EXPECT_CALL</code>而是报错的原因。</p>
<p>为了明确地让某一个<code>EXPECT_CALL</code>“退休”，可以加上<code>RetiresOnSaturation()</code>，例子：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ::testing::Return;</span><br><span class="line"></span><br><span class="line"><span class="built_in">EXPECT_CALL</span>(turtle, <span class="built_in">GetX</span>())		<span class="comment">// #1</span></span><br><span class="line">	.<span class="built_in">WillOnce</span>(<span class="built_in">Return</span>(<span class="number">10</span>))</span><br><span class="line">	.<span class="built_in">RetiresOnSaturation</span>();</span><br><span class="line"><span class="built_in">EXPECT_CALL</span>(turtle, <span class="built_in">GetX</span>())		<span class="comment">// #2</span></span><br><span class="line">	.<span class="built_in">WillOnce</span>(<span class="built_in">Return</span>(<span class="number">20</span>))</span><br><span class="line">	.<span class="built_in">RetiresOnSaturation</span>();</span><br><span class="line"></span><br><span class="line">turtle.<span class="built_in">GetX</span>()					<span class="comment">// 与#2匹配，返回20，然后#2“退休”</span></span><br><span class="line">turtle.<span class="built_in">GetX</span>()					<span class="comment">// 与#1匹配，返回10</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，第一次<code>GetX()</code>调用和#2匹配，返回<code>20</code>，然后这个<code>EXPECT_CALL</code>就“退休”了；<br>第二次<code>GetX()</code>调用和#1匹配，返回<code>10</code></p>
<h3 id="Sequence"><a href="#Sequence" class="headerlink" title="Sequence"></a>Sequence</h3><p>可以用sequence来指定期望匹配的顺序。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ::testing::Return;</span><br><span class="line"><span class="keyword">using</span> ::testing::Sequence;</span><br><span class="line">Sequence s1, s2;</span><br><span class="line">...</span><br><span class="line"><span class="built_in">EXPECT_CALL</span>(foo, <span class="built_in">Reset</span>())</span><br><span class="line">    .<span class="built_in">InSequence</span>(s1, s2)</span><br><span class="line">    .<span class="built_in">WillOnce</span>(<span class="built_in">Return</span>(<span class="literal">true</span>));</span><br><span class="line"><span class="built_in">EXPECT_CALL</span>(foo, <span class="built_in">GetSize</span>())</span><br><span class="line">    .<span class="built_in">InSequence</span>(s1)</span><br><span class="line">    .<span class="built_in">WillOnce</span>(<span class="built_in">Return</span>(<span class="number">1</span>));</span><br><span class="line"><span class="built_in">EXPECT_CALL</span>(foo, <span class="built_in">Describe</span>(<span class="built_in">A</span>&lt;<span class="type">const</span> <span class="type">char</span>*&gt;()))</span><br><span class="line">    .<span class="built_in">InSequence</span>(s2)</span><br><span class="line">    .<span class="built_in">WillOnce</span>(<span class="built_in">Return</span>(<span class="string">&quot;dummy&quot;</span>));</span><br></pre></td></tr></table></figure>
<p><img src="http://cdn.yuleweici.com/CPP-%E5%8D%95%E6%B5%8B/img.png" alt="sequence"></p>
<p>在上面的例子中，创建了两个Sequence <code>s1</code>和<code>s2</code>，属于<code>s1</code>的有<code>Reset()</code>和<code>GetSize()</code>，<br>所以<code>Reset()</code>必须在<code>GetSize()</code>之前执行。属于<code>s2</code>的有<code>Reset()</code>和<code>Describe(A&lt;const char*&gt;())</code>，<br>所以<code>Reset()</code>必须在<code>Describe(A&lt;const char*&gt;())</code>之前执行。所以，<code>Reset()</code>必须在<code>GetSize()</code><br>和<code>Describe()</code>之前执行。而<code>GetSize()</code>和<code>Describe()</code>这两者之间没有顺序约束。</p>
<p>如果需要指定很多期望的顺序，有另一种用法：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ::testing::InSequence;</span><br><span class="line">&#123;</span><br><span class="line">  InSequence seq;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">EXPECT_CALL</span>(...)...;</span><br><span class="line">  <span class="built_in">EXPECT_CALL</span>(...)...;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">EXPECT_CALL</span>(...)...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这种用法中，scope中（大括号中）的期望必须遵守严格的顺序。</p>
<h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2><ul>
<li><a href="https://github.com/google/googletest/blob/master/googlemock/docs/cheat_sheet.md">Google Mock Cheat Sheet</a></li>
<li><a href="https://github.com/google/googletest/blob/master/googlemock/docs/cook_book.md">Google Mock Cook Book</a></li>
</ul>
<h1 id="情景示例"><a href="#情景示例" class="headerlink" title="情景示例"></a>情景示例</h1><p>在这部分，我们用一个示例项目来演示，如何在不同情景中使用<br>Google Test和Google Mock写单元测试用例。</p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>示例项目是一个C++命令行聊天室软件，包含服务器和客户端。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── README.md</span><br><span class="line">├── client_main.cpp</span><br><span class="line">├── server_main.cpp</span><br><span class="line">├── include</span><br><span class="line">│   ├── chat_client.hpp</span><br><span class="line">│   ├── chat_message.hpp</span><br><span class="line">│   ├── chat_participant.hpp</span><br><span class="line">│   ├── chat_room.hpp</span><br><span class="line">│   ├── chat_server.hpp</span><br><span class="line">│   ├── chat_session.hpp</span><br><span class="line">│   ├── http_request.hpp</span><br><span class="line">│   ├── http_request_impl.hpp</span><br><span class="line">│   ├── message_dao.hpp</span><br><span class="line">│   └── message_dao_impl.hpp</span><br><span class="line">├── src</span><br><span class="line">│   ├── chat_client.cpp</span><br><span class="line">│   ├── chat_message.cpp</span><br><span class="line">│   ├── chat_room.cpp</span><br><span class="line">│   ├── chat_server.cpp</span><br><span class="line">│   ├── chat_session.cpp</span><br><span class="line">│   ├── http_request_impl.cpp</span><br><span class="line">│   └── message_dao_impl.cpp</span><br><span class="line">└── tests</span><br><span class="line">    ├── chat_message_unittest.cpp</span><br><span class="line">    └── chat_room_unittest.cpp</span><br></pre></td></tr></table></figure>

<h2 id="普通测试"><a href="#普通测试" class="headerlink" title="普通测试"></a>普通测试</h2><p>如果被测试的函数不包含外部依赖，用Google Test基础的用法就可以完成用例编写。</p>
<p>原函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">chat_message::body_length</span><span class="params">(std::<span class="type">size_t</span> new_length)</span> </span>&#123;</span><br><span class="line">    body_length_ = new_length;</span><br><span class="line">    <span class="keyword">if</span> (body_length_ &gt; <span class="number">512</span>)</span><br><span class="line">        body_length_ = <span class="number">512</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个函数很简单。就是给<code>body_length_</code>赋值但是有最大值限制。测试用例可以这样写：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">TEST</span>(ChatMessageTest, BodyLengthNegative) &#123;</span><br><span class="line">    chat_message c;</span><br><span class="line">    c.<span class="built_in">body_length</span>(<span class="number">-50</span>);</span><br><span class="line">    <span class="built_in">EXPECT_EQ</span>(<span class="number">512</span>, c.<span class="built_in">body_length</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST</span>(ChatMessageTest, BodyLength0) &#123;</span><br><span class="line">    chat_message c;</span><br><span class="line">    c.<span class="built_in">body_length</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">EXPECT_EQ</span>(<span class="number">0</span>, c.<span class="built_in">body_length</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST</span>(ChatMessageTest, BodyLength100) &#123;</span><br><span class="line">    chat_message c;</span><br><span class="line">    c.<span class="built_in">body_length</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="built_in">EXPECT_EQ</span>(<span class="number">100</span>, c.<span class="built_in">body_length</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST</span>(ChatMessageTest, BodyLength512) &#123;</span><br><span class="line">    chat_message c;</span><br><span class="line">    c.<span class="built_in">body_length</span>(<span class="number">512</span>);</span><br><span class="line">    <span class="built_in">EXPECT_EQ</span>(<span class="number">512</span>, c.<span class="built_in">body_length</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST</span>(ChatMessageTest, BodyLength513) &#123;</span><br><span class="line">    chat_message c;</span><br><span class="line">    c.<span class="built_in">body_length</span>(<span class="number">513</span>);</span><br><span class="line">    <span class="built_in">EXPECT_EQ</span>(<span class="number">512</span>, c.<span class="built_in">body_length</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到，对于这类函数，用例编写很直接简单，步骤都是构造变量，再用合适的Google Test的<br>宏来验证变量值或者函数调用返回值。</p>
<h2 id="简单-Mock"><a href="#简单-Mock" class="headerlink" title="简单 Mock"></a>简单 Mock</h2><p>原函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void chat_room::leave(chat_participant_ptr participant) &#123;</span><br><span class="line">    participants_.erase(participant);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>participants_ </code> 的类型是 <code>std::set&lt;chat_participant_ptr&gt;</code>。这个函数的目的很明显，将一个<code>participant</code>从<code>set</code>中移除。</p>
<p>真实地创建一个聊天参与者<code>participant</code>对象可以条件比较苛刻或者成本比较高。为了有效率地验证这个函数，我们可以新建一些Mock的<code>chat_participant_ptr</code>而不用严格地去创建真实的<code>participant</code>对象。</p>
<p><code>chat_participant</code>对象：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class chat_participant &#123;</span><br><span class="line">public:</span><br><span class="line">    virtual ~chat_participant() &#123;&#125;</span><br><span class="line">    virtual void deliver(const chat_message &amp;msg) = 0;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Mock对象：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class mock_chat_participant : public chat_participant &#123;</span><br><span class="line">public:</span><br><span class="line">    MOCK_METHOD(void, deliver, (const chat_message &amp;msg), (override));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>测试用例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">TEST(ChatRoomTest, leave) &#123;</span><br><span class="line">    auto p1 = std::make_shared&lt;mock_chat_participant&gt;();	//新建第一个Mock指针</span><br><span class="line">    auto p2 = std::make_shared&lt;mock_chat_participant&gt;();	//新建第二个Mock指针</span><br><span class="line">    auto p3 = std::make_shared&lt;mock_chat_participant&gt;();	//新建第三个Mock指针</span><br><span class="line">    auto p4 = std::make_shared&lt;mock_chat_participant&gt;();	//新建第四个Mock指针</span><br><span class="line">    chat_room cr;											//新建待测试对象chat_room</span><br><span class="line">    cr.join(p1);</span><br><span class="line">    cr.join(p2);</span><br><span class="line">    cr.join(p3);</span><br><span class="line">    cr.join(p4);</span><br><span class="line">    EXPECT_EQ(cr.participants().size(), 4);</span><br><span class="line">    cr.leave(p4);</span><br><span class="line">    EXPECT_EQ(cr.participants().size(), 3);</span><br><span class="line">    cr.leave(p4);</span><br><span class="line">    EXPECT_EQ(cr.participants().size(), 3);</span><br><span class="line">    cr.leave(p2);</span><br><span class="line">    EXPECT_EQ(cr.participants().size(), 2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Web请求"><a href="#Web请求" class="headerlink" title="Web请求"></a>Web请求</h2><p><code>chat_room</code>中有一个<code>log()</code>，依赖网络请求。原函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::string <span class="title">chat_room::log</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::string* response;</span><br><span class="line">    <span class="keyword">this</span>-&gt;requester-&gt;<span class="built_in">execute</span>(<span class="string">&quot;request&quot;</span>,response);		<span class="comment">// web访问，结果存在response指针中</span></span><br><span class="line">    <span class="keyword">return</span> *response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在单元测试中，我们只关心被测试部分的逻辑。为了测试这个函数，我们不应该创建真实的<code>requester</code>，应该使用mock。</p>
<p><code>http_request</code>对象：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">http_request</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">http_request</span>()&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">execute</span><span class="params">(std::string request, std::string* response)</span></span>=<span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Mock对象：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">mock_http_request</span> : <span class="keyword">public</span> http_request &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MOCK_METHOD</span>(<span class="type">bool</span>, execute, (std::string request, std::string * response), (<span class="keyword">override</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>测试用例：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">TEST</span>(ChatRoomTest, log) &#123;</span><br><span class="line">    testing::NiceMock&lt;mock_message_dao&gt; mock_dao;	<span class="comment">//在下一部分会提到mock_message_dao</span></span><br><span class="line">    mock_http_request mock_requester;				<span class="comment">//Mock对象</span></span><br><span class="line">    std::string response = <span class="string">&quot;response&quot;</span>;				<span class="comment">//期待调用函数的第二个参数将指向这个string对象</span></span><br><span class="line">    <span class="built_in">EXPECT_CALL</span>(mock_requester, execute)</span><br><span class="line">    	.<span class="built_in">WillRepeatedly</span>(							<span class="comment">//每次调用都会（WillRepeatedly）执行</span></span><br><span class="line">    		testing::<span class="built_in">DoAll</span>(							<span class="comment">//每次执行包含多个行为</span></span><br><span class="line">    			testing::<span class="built_in">SetArgPointee</span>&lt;<span class="number">1</span>&gt;(response),<span class="comment">//将传入参数指针变量response指向response</span></span><br><span class="line">    			testing::<span class="built_in">Return</span>(<span class="literal">true</span>)));			<span class="comment">//返回值为true</span></span><br><span class="line">    chat_room cr </span><br><span class="line">    	= <span class="built_in">chat_room</span>(&amp;mock_dao, &amp;mock_requester);	<span class="comment">//将mock对象通过chat_room的constructor注入</span></span><br><span class="line">    <span class="built_in">EXPECT_EQ</span>(cr.<span class="built_in">log</span>(),<span class="string">&quot;response&quot;</span>);					<span class="comment">//调用和Google Test断言</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数据库访问"><a href="#数据库访问" class="headerlink" title="数据库访问"></a>数据库访问</h2><p><code>chat_room</code>对象会将聊天者发送的消息存储在redis数据库中。当新用户加入时，<code>chat_room</code>对象从数据库<br>获取所有历史消息发送给该新用户。</p>
<p><code>join()</code>函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">chat_room::join</span><span class="params">(chat_participant_ptr participant)</span> </span>&#123;</span><br><span class="line">    participants_.<span class="built_in">insert</span>(participant);</span><br><span class="line">    std::vector&lt;std::string&gt; recent_msg_strs = </span><br><span class="line">    	<span class="keyword">this</span>-&gt;dao-&gt;<span class="built_in">get_messages</span>(); 			<span class="comment">//从数据库中获取历史消息</span></span><br><span class="line">    <span class="keyword">for</span> (std::string recent_msg_str: recent_msg_strs) &#123;</span><br><span class="line">										    <span class="comment">//将每一个消息发送给该聊天参与者	</span></span><br><span class="line">        <span class="keyword">auto</span> msg = <span class="built_in">chat_message</span>();</span><br><span class="line">        msg.<span class="built_in">set_body_string</span>(recent_msg_str);</span><br><span class="line">        participant-&gt;<span class="built_in">deliver</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>message_dao</code>对象：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">message_dao</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">message_dao</span>()&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">add_message</span><span class="params">(std::string m)</span></span>=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::vector&lt;std::string&gt; <span class="title">get_messages</span><span class="params">()</span></span>=<span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Mock对象：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">mock_message_dao</span> : <span class="keyword">public</span> message_dao &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MOCK_METHOD</span>(<span class="type">bool</span>, add_message, (std::string m), (<span class="keyword">override</span>));</span><br><span class="line">    <span class="built_in">MOCK_METHOD</span>(std::vector&lt;std::string&gt;, get_messages, (), (<span class="keyword">override</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>测试用例：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">TEST</span>(ChatRoomTest, join) &#123;</span><br><span class="line">    mock_message_dao mock_dao;				<span class="comment">//创建mock对象（需要注入chat_room）</span></span><br><span class="line">    http_request_impl requester;			<span class="comment">//创建web访问对象（也需要注入chat_room）</span></span><br><span class="line">    <span class="keyword">auto</span> mock_p1 = std::<span class="built_in">make_shared</span>&lt;mock_chat_participant&gt;();</span><br><span class="line">    										<span class="comment">//创建participant的mock指针</span></span><br><span class="line">    <span class="built_in">EXPECT_CALL</span>(mock_dao, get_messages)</span><br><span class="line">    	.<span class="built_in">WillOnce</span>(testing::<span class="built_in">Return</span>(std::vector&lt;std::string&gt;&#123;<span class="string">&quot;test_msg_body_1&quot;</span>, <span class="string">&quot;test_msg_body_2&quot;</span>, <span class="string">&quot;test_msg_body_3&quot;</span>&#125;));</span><br><span class="line">    										<span class="comment">//指定get_messages调用的返回值</span></span><br><span class="line">    <span class="built_in">EXPECT_CALL</span>(*mock_p1, deliver).<span class="built_in">Times</span>(<span class="number">3</span>);</span><br><span class="line">    										<span class="comment">//指定deliver调用的次数</span></span><br><span class="line">    chat_room cr = <span class="built_in">chat_room</span>(&amp;mock_dao, &amp;requester);</span><br><span class="line">    										<span class="comment">//创建chat_room对象，注入dao和requester</span></span><br><span class="line">    cr.<span class="built_in">join</span>(mock_p1);						<span class="comment">//调用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先创建mock对象，再指定函数调用的预期，最后指向被测试函数。我们可以看到，<code>mock_dao</code>指定了<code>get_messages</code>的<br>返回值时一个长度为3的vector，所以有3条消息会被deliver。</p>
<h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><h2 id="单元测试源文件应该放在项目的什么位置？"><a href="#单元测试源文件应该放在项目的什么位置？" class="headerlink" title="单元测试源文件应该放在项目的什么位置？"></a>单元测试源文件应该放在项目的什么位置？</h2><p>一般来说，我们会在根目录创建一个<code>tests</code>文件夹，里面放单元测试部分的源代码，从而不会和被测试代码混在一起。</p>
<p>如果需要和其他测试（如接口测试、压力测试）等区分开来，可以</p>
<ol>
<li>把<code>tests</code>改成<code>unittests</code>、<code>utests</code>等，或者</li>
<li>在<code>tests</code>创建不同子文件夹存放不同类型的测试代码。</li>
</ol>
<h2 id="Google-Mock只能Mock虚函数，如果我想Mock非虚函数怎么办？"><a href="#Google-Mock只能Mock虚函数，如果我想Mock非虚函数怎么办？" class="headerlink" title="Google Mock只能Mock虚函数，如果我想Mock非虚函数怎么办？"></a>Google Mock只能Mock虚函数，如果我想Mock非虚函数怎么办？</h2><p>由于Google Mock（及其他大部分Mock框架）通过继承来动态重载机制的限制，一般来说Google Mock只能Mock虚函数。如果要mock非虚函数，官方文档提供这几种思路：</p>
<ol>
<li>Mock类和原类没有继承关系，在测试对象使用函数模板。在测试中，测试对象接受Mock类。</li>
<li>创建一个接口（抽象类），原类继承自这个接口（抽象类）。在测试中Mock这个接口（抽象类）。</li>
</ol>
<p>这两种方法，都需要对代码进行一定的修改或重构。如果不想修改被测试代码。可以考虑使用hook技术替换被mock的部分从而mock一般函数。</p>
<p>使用<code>TMock</code>对非虚函数mock的例子：</p>
<p>mock函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="keyword">include</span> <span class="string">&quot;tmock.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MockClass</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//注册mock类</span></span><br><span class="line">    <span class="built_in">TMOCK_CLASS</span>(MockClass);</span><br><span class="line">    <span class="comment">//声明mock类函数，TMOCK_METHOD&#123;n&#125;第一个参数与attach_func_lib第一个参数相同，其余参考与MOCK_METHOD&#123;n&#125;一致。</span></span><br><span class="line">    <span class="built_in">TMOCK_METHOD1</span>(<span class="string">&quot;original&quot;</span>, original, <span class="built_in">uint32_t</span>(<span class="type">const</span> <span class="type">char</span> * str_file_md5) )</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>单测中应用<code>tmock</code>的方法和Google Mock基本一致。但在结束的时候需要使用<code>TMOCK_CLEAR</code>清除exception，<br>detach hook的函数，防止干扰其他单元测试。</p>
<h2 id="Google-Test官方文档中说测测试套件名称、测试夹具名称、测试名称中不应该出现下划线-。为什么？"><a href="#Google-Test官方文档中说测测试套件名称、测试夹具名称、测试名称中不应该出现下划线-。为什么？" class="headerlink" title="Google Test官方文档中说测测试套件名称、测试夹具名称、测试名称中不应该出现下划线_。为什么？"></a>Google Test官方文档中说测测试套件名称、测试夹具名称、测试名称中不应该出现下划线<code>_</code>。为什么？</h2><p><code>TEST(TestSuiteName, TestName)</code>生成名为<code>TestSuiteName_TestName_Test</code>的类。</p>
<p>下划线<code>_</code>是特殊的，因为C ++保留以下内容供编译器和标准库使用。所以开头和结尾有下划线很容易让生成的类的标识符不合法。</p>
<p>另一方面，下划线可能让不同测试生成相同的类。比如<code>TEST（Time，Flies_Like_An_Arrow）&#123;...&#125; </code>和<code>TEST（Time_Flies，Like_An_Arrow）&#123;...&#125; </code>都生成名为<code>Time_Flies_Like_An_Arrow_Test</code>的类。</p>
<h2 id="测试输出里有很多Uninteresting-mock-function-call警告怎么办？"><a href="#测试输出里有很多Uninteresting-mock-function-call警告怎么办？" class="headerlink" title="测试输出里有很多Uninteresting mock function call警告怎么办？"></a>测试输出里有很多<code>Uninteresting mock function call</code>警告怎么办？</h2><p>创建的Mock的对象的某些调用如果没有相应匹配的<code>EXPECT_CALL</code>，Google Mock会生成这个警告。</p>
<p>为了去除这个警告，可以使用<code>NiceMock</code>。比如如果原本使用<code>MockFoo nice_foo;</code>新建mock对象的话，可以改成<code>NiceMock&lt;MockFoo&gt; nice_foo;</code>。<code>NiceMock&lt;MockFoo&gt;</code>是<code>MockFoo</code>的子类。</p>
<h1 id="单测覆盖率"><a href="#单测覆盖率" class="headerlink" title="单测覆盖率"></a>单测覆盖率</h1><p>使用 Gcov 和 LCOV 度量 C&#x2F;C++ 项目的代码覆盖率</p>
<h2 id="什么是代码覆盖率？"><a href="#什么是代码覆盖率？" class="headerlink" title="什么是代码覆盖率？"></a>什么是代码覆盖率？</h2><p>代码覆盖率是对整个测试过程中被执行的代码的衡量，它能测量源代码中的哪些语句在测试中被执行，哪些语句尚未被执行。</p>
<h2 id="为什么要测量代码覆盖率？"><a href="#为什么要测量代码覆盖率？" class="headerlink" title="为什么要测量代码覆盖率？"></a>为什么要测量代码覆盖率？</h2><p>众所周知，测试可以提高软件版本的质量和可预测性。但是，你知道你的单元测试甚至是你的功能测试实际测试代码的效果如何吗？是否还需要更多的测试？</p>
<p>这些是代码覆盖率可以试图回答的问题。总之，出于以下原因我们需要测量代码覆盖率：</p>
<ul>
<li>了解我们的测试用例对源代码的测试效果 </li>
<li>了解我们是否进行了足够的测试 </li>
<li>在软件的整个生命周期内保持测试质量<br>注：代码覆盖率不是灵丹妙药，覆盖率测量不能替代良好的代码审查和优秀的编程实践。</li>
</ul>
<p>通常，我们应该采用合理的覆盖目标，力求在代码覆盖率在所有模块中实现均匀覆盖，而不是只看最终数字的是否高到令人满意。</p>
<p>举例：假设代码覆盖率只在某一些模块代码覆盖率很高，但在一些关键模块并没有足够的测试用例覆盖，那样虽然代码覆盖率很高，但并不能说明产品质量就很高。</p>
<h2 id="代码覆盖率的指标种类"><a href="#代码覆盖率的指标种类" class="headerlink" title="代码覆盖率的指标种类"></a>代码覆盖率的指标种类</h2><p>代码覆盖率工具通常使用一个或多个标准来确定你的代码在被自动化测试后是否得到了执行，常见的覆盖率报告中看到的指标包括：</p>
<ul>
<li>函数覆盖率：定义的函数中有多少被调用 </li>
<li>语句覆盖率：程序中的语句有多少被执行 </li>
<li>分支覆盖率：有多少控制结构的分支（例如if语句）被执行 </li>
<li>条件覆盖率：有多少布尔子表达式被测试为真值和假值 </li>
<li>行覆盖率：有多少行的源代码被测试过</li>
</ul>
<h2 id="代码覆盖率是如何工作的？"><a href="#代码覆盖率是如何工作的？" class="headerlink" title="代码覆盖率是如何工作的？"></a>代码覆盖率是如何工作的？</h2><p>代码覆盖率测量主要有以下三种方式：</p>
<ol>
<li><p>Source code instrumentation - 源代码检测<br>将检测语句添加到源代码中，并使用正常的编译工具链编译代码以生成检测的程序集。这是我们常说的插桩，Gcov 是属于这一类的代码覆盖率工具。</p>
</li>
<li><p>Runtime instrumentation - 运行时收集<br>这种方法在代码执行时从运行时环境收集信息以确定覆盖率信息。以我的理解 JaCoCo 和 Coverage 这两个工具的原理属于这一类别。</p>
</li>
<li><p>Intermediate code instrumentation - 中间代码检测</p>
</li>
</ol>
<p>通过添加新的字节码来检测编译后的类文件，并生成一个新的检测类。说实话，我 Google 了很多文章并找到确定的说明哪个工具是属于这一类的。</p>
<p>了解这些工具的基本原理，结合现有的测试用例，有助于正确的选择代码覆盖率工具。比如：</p>
<ul>
<li>产品的源代码只有 E2E（端到端）测试用例，通常只能选择第一类工具，即通过插桩编译出的可执行文件，然后进行测试和结果收集。</li>
<li>产品的源代码有单元测试用例，通常选择第二类工具，即运行时收集。这类工具的执行效率高，易于做持续集成。</li>
</ul>
<h2 id="当前主流代码覆盖率工具"><a href="#当前主流代码覆盖率工具" class="headerlink" title="当前主流代码覆盖率工具"></a>当前主流代码覆盖率工具</h2><p>代码覆盖率的工具有很多，以下是我用过的不同编程语言的代码覆盖率工具。在选择工具时，力求去选择那些开源、流行（活跃）、好用的工具。</p>
<table>
<thead>
<tr>
<th>编程语言</th>
<th>代码覆盖率工具</th>
</tr>
</thead>
<tbody><tr>
<td>C&#x2F;C++</td>
<td>Gcov</td>
</tr>
<tr>
<td>Java</td>
<td>JaCoCo</td>
</tr>
<tr>
<td>JavaScript</td>
<td>Istanbul</td>
</tr>
<tr>
<td>Python</td>
<td>Coverage.py</td>
</tr>
<tr>
<td>Golang</td>
<td>cover</td>
</tr>
</tbody></table>
<h2 id="最后，不要高估代码覆盖率指标"><a href="#最后，不要高估代码覆盖率指标" class="headerlink" title="最后，不要高估代码覆盖率指标"></a>最后，不要高估代码覆盖率指标</h2><p>代码覆盖率不是灵丹妙药，它只是告诉我们有哪些代码没有被测试用例“执行到”而已，高百分比的代码覆盖率不等于高质量的有效测试。</p>
<ul>
<li>首先，高代码覆盖率不足以衡量有效测试。相反，代码覆盖率更准确地给出了代码未被测试程度的度量。这意味着，如果我们的代码覆盖率指标较低，那么我们可以确定代码的重要部分没有经过测试，然而反过来不一定正确。具有高代码覆盖率并不能充分表明我们的代码已经过充分测试。 </li>
<li>其次，100% 的代码覆盖率不应该是我们明确努力的目标之一。这是因为在实现 100% 的代码覆盖率与实际测试重要的代码之间总是需要权衡。虽然可以测试所有代码，但考虑到为了满足覆盖率要求而编写更多无意义测试的趋势，当你接近此限制时，测试的价值也很可能会减少。<br>借 Martin Fowler 在这篇测试覆盖率的文章说的一句话：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">代码覆盖率是查找代码库中未测试部分的有用工具,然而它作为一个数字说明你的测试有多好用处不大。</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="C-覆盖率"><a href="#C-覆盖率" class="headerlink" title="C++覆盖率"></a>C++覆盖率</h2><p>介绍如何使用 Gcov 和 LCOV 对 C&#x2F;C++ 项目进行代码覆盖率的度量。</p>
<p>对于想使用 Gcov 的人，为了说明它是如何工作的，准备了一段示例程序，运行这个程序之前需要先安装 GCC 和 LCOV。</p>
<p>如果没有环境或不想安装，可以直接查看示例仓库的 GitHub 仓库：<a href="https://github.com/vwin/gcov-example">Gcov示例</a></p>
<p>注：主分支 master 下面放的是源码，分支 coverage 下的 out 目录是最终的结果报告。</p>
<p>这是我的测试环境上的 GCC 和 lcov 的版本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2$ gcc --version</span><br><span class="line">Apple clang version 13.1.6 (clang-1316.0.21.2.5)</span><br><span class="line">Target: x86_64-apple-darwin22.1.0</span><br><span class="line">Thread model: posix</span><br><span class="line">InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin</span><br><span class="line"></span><br><span class="line">sh-4.2$ lcov -v</span><br><span class="line">lcov: LCOV version 1.16</span><br></pre></td></tr></table></figure>
<h3 id="Gcov-是如何工作的"><a href="#Gcov-是如何工作的" class="headerlink" title="Gcov 是如何工作的"></a>Gcov 是如何工作的</h3><p>Gcov 工作流程图<br><img src="http://cdn.yuleweici.com/CPP-%E5%8D%95%E6%B5%8B/img_2.png" alt="gcov流程"></p>
<p>主要分三步：</p>
<ol>
<li>在 GCC 编译的时加入特殊的编译选项，生成可执行文件，和 *.gcno； </li>
<li>运行（测试）生成的可执行文件，生成了 *.gcda 数据文件； </li>
<li>有了 *.gcno 和 *.gcda，通过源码生成 gcov 文件，最后生成代码覆盖率报告。</li>
</ol>
<p>下面就开始介绍其中每一步具体是怎么做的。</p>
<h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><p>第一步编译，这里已经将编译用到的参数和文件都写在了 makefile 里了，只要执行 make 就可以编译了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<p>make 命令的输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2$ make</span><br><span class="line">gcc -fPIC -fprofile-arcs -ftest-coverage -c -Wall -Werror main.c</span><br><span class="line">gcc -fPIC -fprofile-arcs -ftest-coverage -c -Wall -Werror foo.c</span><br><span class="line">gcc -fPIC -fprofile-arcs -ftest-coverage -o main main.o foo.o</span><br></pre></td></tr></table></figure>
<p>通过输出可以看到，这个程序在编译的时候添加了两个编译选项 -fprofile-arcs and -ftest-coverage。在编译成功后，不仅生成了 main and .o 文件，同时还生成了两个 .gcno 文件.</p>
<p>.gcno 记录文件是在加入 GCC 编译选项 -ftest-coverage 后生成的，在编译过程中它包含用于重建基本块图和为块分配源行号的信息。</p>
<p>如果使用的是cmake，则在CMakeLists.txt中加入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -fprofile-arcs -ftest-coverage&quot;)</span><br><span class="line">set(CMAKE_C_FLAGS &quot;$&#123;CMAKE_C_FLAGS&#125; -fprofile-arcs -ftest-coverage&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="运行可执行文件"><a href="#运行可执行文件" class="headerlink" title="运行可执行文件"></a>运行可执行文件</h4><p>在编译完成后，生成了 main 这个可执行文件，运行（测试）它：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./main</span><br></pre></td></tr></table></figure>
<p>运行 main 时输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sh-4.2$ ./main</span><br><span class="line">Start calling foo() ...</span><br><span class="line">when num is equal to 1...</span><br><span class="line">when num is equal to 2...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当运行 main 后，执行结果被记录在了 .gcda 这个数据文件里，查看当前目录下可以看到一共有生成了两个 .gcda 文件，每个源文件都对应一个 .gcda 文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">foo.c  foo.gcda  foo.gcno  foo.h  foo.o  img  main  main.c  main.gcda  main.gcno  main.o  makefile  README.md</span><br><span class="line">.gcda 记录数据文件的生成是因为程序在编译的时候引入了 -fprofile-arcs 选项。它包含弧过渡计数、值分布计数和一些摘要信息。</span><br></pre></td></tr></table></figure>

<h4 id="生成报告"><a href="#生成报告" class="headerlink" title="生成报告"></a>生成报告</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make report</span><br></pre></td></tr></table></figure>

<p>生成报告的输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2$ make report</span><br><span class="line">gcov main.c foo.c</span><br><span class="line">File &#x27;main.c&#x27;</span><br><span class="line">Lines executed:100.00% of 5</span><br><span class="line">Creating &#x27;main.c.gcov&#x27;</span><br><span class="line"></span><br><span class="line">File &#x27;foo.c&#x27;</span><br><span class="line">Lines executed:85.71% of 7</span><br><span class="line">Creating &#x27;foo.c.gcov&#x27;</span><br><span class="line"></span><br><span class="line">Lines executed:91.67% of 12</span><br><span class="line">lcov --capture --directory . --output-file coverage.info</span><br><span class="line">Capturing coverage data from .</span><br><span class="line">Found gcov version: 4.8.5</span><br><span class="line">Scanning . for .gcda files ...</span><br><span class="line">Found 2 data files in .</span><br><span class="line">Processing foo.gcda</span><br><span class="line">geninfo: WARNING: cannot find an entry for main.c.gcov in .gcno file, skipping file!</span><br><span class="line">Processing main.gcda</span><br><span class="line">Finished .info-file creation</span><br><span class="line">genhtml coverage.info --output-directory out</span><br><span class="line">Reading data file coverage.info</span><br><span class="line">Found 2 entries.</span><br><span class="line">Found common filename prefix &quot;/workspace/coco&quot;</span><br><span class="line">Writing .css and .png files.</span><br><span class="line">Generating output.</span><br><span class="line">Processing file gcov-example/main.c</span><br><span class="line">Processing file gcov-example/foo.c</span><br><span class="line">Writing directory view page.</span><br><span class="line">Overall coverage rate:</span><br><span class="line">lines......: 91.7% (11 of 12 lines)</span><br><span class="line">functions..: 100.0% (2 of 2 functions)</span><br></pre></td></tr></table></figure>

<p>执行 make report 来生成 HTML 报告，这条命令的背后实际上主要执行了以下两个步骤：</p>
<ol>
<li>在有了编译和运行时候生成的 .gcno 和 .gcda 文件后，执行命令 gcov main.c foo.c 即可生成 .gcov 代码覆盖率文件。</li>
<li>有了代码覆盖率 .gcov 文件，通过 LCOV 生成可视化代码覆盖率报告。<br>生成 HTML 结果报告的步骤如下：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 生成 coverage.info 数据文件</span></span><br><span class="line">lcov --capture --directory . --output-file coverage.info</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. 根据这个数据文件生成报告</span></span><br><span class="line">genhtml coverage.info --output-directory out</span><br><span class="line"></span><br><span class="line">常用的lcov命令:</span><br><span class="line">1. lcov --extract xx.info &#x27;*/xx&#x27; &#x27;*/yy&#x27; -o res.info  // 只保留xx.info中的xx和yy目录并输出到res.info</span><br><span class="line">2. lcov --remove xx.info &#x27;*/xx&#x27; &#x27;*/yy&#x27; -o res.info //删除xx.info中的xx和yy目录并输出到res.info</span><br><span class="line">3. lcov -a xx.info -a yy.info -o res.info //合并xx.info和yy.info并输出到res.info</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="收尾"><a href="#收尾" class="headerlink" title="收尾"></a>收尾</h4><p>上传过程中所有生成的文件可通过执行 make clean 命令来彻底删除掉。</p>
<p>make clean 命令的输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sh-4.2$ make clean</span><br><span class="line">rm -rf main *.o *.so *.gcno *.gcda *.gcov coverage.info out</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>旁注： 还有另外一个生成 HTML 报告的工具叫 gcovr，使用 Python 开发的，它的报告在显示方式上与 LCOV 略有不同。比如 LCOV 以目录结构显示， gcovr 以文件路径来显示，前者与代码结构一直因此我更倾向于使用前者。</p>
</blockquote>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><h2 id="实践小结"><a href="#实践小结" class="headerlink" title="实践小结"></a>实践小结</h2><p>和GoLang单元测试框架有些区别的是，GoLang自生就提供了自带的测试框架，也有第三方框架进行选择。<br>而C&#x2F;C++&#x2F;php等语言的单元测试框架则需要第三方提供和安装。</p>
<p>框架的使用，无非是一些语法糖的差异和使用的难易程度。不管使用什么语言，什么框架，最关键的是利用单元测试的思路，<br>写出解耦的、可测试的、易于维护的代码，保证代码的质量。</p>
<p>单元测试是一种手段，能够一定程度的改善生产力。凡事有度过犹不及，如果一味的盲目的追求测试覆盖率，<br>忽视了测试代码本身的质量，那么各种无效的单元测试反而带来了沉重的维护负担。因此单测的代码，本身也是代码，<br>也是和项目本身的代码一样，需要重构、维护的（好好写代码）。</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://vwin.github.io/2022/11/01/CPP-%E5%8D%95%E6%B5%8B/" title="CPP-单测" target="_blank" rel="external">http://vwin.github.io/2022/11/01/CPP-单测/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/vwin" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/vwin" target="_blank"><span class="text-dark">will</span><small class="ml-1x">Software Development Engineer in Test &amp; Devops Engineer</small></a></h3>
        <div>测试开发架构师 &amp;&amp; 工程效能专家</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2022/11/03/Python-%E5%8D%95%E6%B5%8B/" title="Python-单测"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2022/10/28/%E4%BA%91IaaS%E6%B5%8B%E8%AF%95%E7%B3%BB%E5%88%97%E4%B8%80%E5%AD%98%E5%82%A8%E6%80%A7%E8%83%BD%E5%8F%8A%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" title="云IaaS测试系列一存储性能及性能测试"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn " data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">    <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/vwin" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://yuleweici.com/yuleweici/" target="_blank" title="Link" data-toggle=tooltip data-placement=top><i class="icon icon-link"></i></a></li>
        
        <li><a href="mailto:crazyboyspecial@qq.com" target="_blank" title="Email" data-toggle=tooltip data-placement=top><i class="icon icon-email"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        &copy; 2022 V
        
        <!-- <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div> -->
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
  <!-- <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script> -->
  <!-- <script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script> -->
  <!-- <script src="//cdn.jsdelivr.net/npm/valine"></script> -->
  <script src="https://unpkg.com/@waline/client@v2/dist/waline.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"/>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  // new Valine({
  //   el: '#vcomments',
  //   verify: false,
  //   notify: false,
  //   appId: 'kYGZ6VfUgySmlSPFebJoXAD5-MdYXbMMI',
  //   appKey: 'EkbmuElfV0UIfgK2uCGwvUiU',
  //   placeholder: '有任何问题可以留言哦~',
  //   avatar: 'monsterid',
  //   meta: meta,
  //   pageSize: '10' || 10,
  //   serverURLs: 'https://kYGZ6VfU.api.lncldglobal.com',
  //   visitor: true
  // });
  Waline.init({
      el: '#comments',
      serverURL: 'https://hexo-waline-henna.vercel.app',
  });
  </script>

     



  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script>
  <script>
  //利用 FancyBox 实现点击图片放大
  $(document).ready(function() {
    $('article img').not('[hidden]').not('.panel-body img').each(function() {
      var $image = $(this);
      var imageCaption = $image.attr('alt');
      var $imageWrapLink = $image.parent('a');
      if ($imageWrapLink.length < 1) {
        var src = this.getAttribute('src');
        var idx = src.lastIndexOf('?');
        if (idx != -1) {
          src = src.substring(0, idx);
        }
        $imageWrapLink = $image.wrap('<a href="' + src + '"></a>').parent('a');
      }
      $imageWrapLink.attr('data-fancybox', 'images');
      if (imageCaption) {
        $imageWrapLink.attr('data-caption', imageCaption);
      }
    });
    $().fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
    });
  });
  </script>





</body>
</html>